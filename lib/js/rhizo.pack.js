/*

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2008 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2011 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2009 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2010 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2009 The Rhizosphere Authors. All Rights Reserved.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
namespace("rhizo.jquery");rhizo.jquery.init=function(a,b,c){rhizo.jquery.initAnimations_(a,b);c&&rhizo.jquery.initMouseWheel_()};
rhizo.jquery.initAnimations_=function(a,b){if(!$.support.greyOut){$.extend($.support,{greyOut:true});(function(c){b?c.fn.extend({move:function(d,e,f){a.noFx?c(this).css(jQuery.extend({top:d,left:e},f)):c(this).animate(jQuery.extend({top:d,left:e},f),{duration:400,queue:false})},fadeIn:function(){c(this).stop(true,true);a.noFx?c(this).css({visibility:"visible",opacity:1}):c(this).css("visibility","visible").animate({opacity:1},400)},fadeOut:function(d){c(this).stop(true,true);if(a.noFx){c(this).css({visibility:"hidden",
opacity:0});d&&d.apply(this)}else c(this).animate({opacity:0},{duration:400,complete:function(){c(this).css("visibility","hidden");d&&d.apply(this)}})},greyOut:function(){c(this).stop(true,true);a.noFx?c(this).css({visibility:"visible",opacity:0.2}):c(this).css("visibility","visible").animate({opacity:0.2},400)}}):c.fn.extend({move:function(d,e,f){c(this).css(jQuery.extend({top:d,left:e},f))},fadeIn:function(){c(this).css({visibility:"visible",opacity:1})},fadeOut:function(d){c(this).css({visibility:"hidden",
opacity:0});d&&d.apply(this)},greyOut:function(){c(this).css("opacity",0.2)}})})(jQuery)}};
rhizo.jquery.initMouseWheel_=function(){if(!$.support.mouseWheel){$.extend($.support,{mouseWheel:true});(function(a){function b(f){var g=f||window.event,h=[].slice.call(arguments,1),j=g.timeStamp||(new Date).getTime();if(j-d<e)return false;d=j;var k=j=0;if(a.browser.webkit){j=g.wheelDeltaX;k=g.wheelDeltaY}else if(a.browser.mozilla)if(g.axis!==undefined&&g.axis===g.HORIZONTAL_AXIS)j=-g.detail;else k=-g.detail;else k=g.wheelDelta;j=j>0?1:j<0?-1:0;k=k>0?1:k<0?-1:0;f=a.event.fix(g);f.type="mousewheel";
h.unshift(f,j,k);return a.event.handle.apply(this,h)}var c=["DOMMouseScroll","mousewheel"],d=0,e=30;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var f=c.length;f;)this.addEventListener(c[--f],b,false);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var f=c.length;f;)this.removeEventListener(c[--f],b,false);else this.onmousewheel=null}};a.fn.extend({mousewheel:function(f){return f?this.bind("mousewheel",f):this.trigger("mousewheel")},unmousewheel:function(f){return this.unbind("mousewheel",
f)}})})(jQuery)}};function namespace(a){a=a.split(".");for(var b=window,c=0;c<a.length;c++){if(typeof b[a[c]]=="undefined")b[a[c]]={};b=b[a[c]]}}namespace("rhizo");rhizo.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a};namespace("rhizo.util");rhizo.util.LOG_E_10=Math.log(10);rhizo.util.log10_=function(a){return Math.log(a)/rhizo.util.LOG_E_10};
rhizo.util.orderOfMagnitude=function(a){if(a==0)return Number.NaN;return Math.floor(Math.round(rhizo.util.log10_(Math.abs(a))*100)/100)};rhizo.util.parseUri=function(a){var b=rhizo.util.parseUri.options_;a=b.parser[b.strictMode?"strict":"loose"].exec(a);for(var c={},d=14;d--;)c[b.key[d]]=a[d]||"";c[b.q.name]={};c[b.key[12]].replace(b.q.parser,function(e,f,g){if(f)c[b.q.name][f]=g});return c};
rhizo.util.parseUri.options_={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};
rhizo.util.urlParams=function(){return rhizo.util.parseUri(document.location.href).queryKey};rhizo.util.buildUrl=function(a,b){var c=a||document.location.href;if(!b)return c;c=rhizo.util.parseUri(c);var d=[c.protocol,"://",c.authority,c.path,"?",c.query];for(var e in b){d.push("&");d.push(e);d.push("=");d.push(encodeURIComponent(b[e]))}if(c.anchor.length>0){d.push("#");d.push(c.anchor)}return d.join("")};
rhizo.util.escapeSelectorToken=function(a){return a.replace(rhizo.util.escapeSelectorToken.regexp_,"\\$1")};rhizo.util.escapeSelectorToken.regexp_=RegExp("([!\"#\\$%&'\\(\\)\\*\\+,\\.\\/:;<=>?@\\[\\\\\\]\\^\\{\\|\\}\\~])","g");namespace("rhizo.selection");
rhizo.selection.SelectionManager=function(a){this.project_=a;this.selectionMap_={};this.project_.eventBus().addPreprocessor("selection",this.onBeforeSelection_,this,true);this.project_.eventBus().subscribe("selection",this.onSelection_,this);this.project_.eventBus().subscribe("model",this.onModelChange_,this)};rhizo.selection.SelectionManager.prototype.getNumSelected=function(){var a=0;for(var b in this.selectionMap_)a++;return a};rhizo.selection.SelectionManager.prototype.isSelected=function(a){return!!this.selectionMap_[a]};
rhizo.selection.SelectionManager.prototype.allSelected=function(){return this.selectionMap_};rhizo.selection.SelectionManager.prototype.allDeselected=function(){for(var a={},b=this.project_.models(),c=b.length-1;c>=0;c--){var d=b[c].id;d in this.selectionMap_||(a[d]=b[d])}return a};rhizo.selection.SelectionManager.prototype.getNumFocused=function(){for(var a=0,b=this.project_.models(),c=b.length-1;c>=0;c--)b[c].isFiltered("__selection__")||a++;return a};
rhizo.selection.SelectionManager.prototype.getNumHidden=function(){for(var a=0,b=this.project_.models(),c=b.length-1;c>=0;c--)b[c].isFiltered("__selection__")&&a++;return a};rhizo.selection.SelectionManager.prototype.allFocused=function(){for(var a={},b=this.project_.models(),c=b.length-1;c>=0;c--)b[c].isFiltered("__selection__")||(a[b[c].id]=b[c]);return a};
rhizo.selection.SelectionManager.prototype.allHidden=function(){for(var a={},b=this.project_.models(),c=b.length-1;c>=0;c--)if(b[c].isFiltered("__selection__"))a[b[c].id]=b[c];return a};rhizo.selection.SelectionManager.prototype.onModelChange_=function(a){if(a.action=="remove")for(var b=0;b<a.models.length;b++)delete this.selectionMap_[a.models[b].id]};
rhizo.selection.SelectionManager.prototype.onBeforeSelection_=function(a,b){switch(a.action){case "selectAll":a.models=this.getAllModelIds_(this.project_.modelsMap());break;case "deselectAll":a.models=this.getAllModelIds_(this.selectionMap_);break;case "select":case "deselect":a.models=this.extendSelection_(a.models);break;case "toggle":var c=a.models;$.isArray(c)||(c=[c]);for(var d=true,e=c.length-1;e>=0;e--)if(!this.isSelected(c[e])){d=false;break}a.models=this.extendSelection_(a.models);a.action=
d?"deselect":"select";break;case "focus":case "hide":if(!a.models||a.models.length==0)a.models=this.getAllModelIds_(this.selectionMap_);else if(this.isIncremental_(a))a.models=this.extendSelection_(a.models);break;case "resetFocus":a.models=this.getAllHiddenModels_();break;default:b(false,"Invalid selection operation: "+a.action);return}b(true)};
rhizo.selection.SelectionManager.prototype.onSelection_=function(a){this.project_.logger().time("SelectionManager::onSelection");switch(a.action){case "select":case "selectAll":this.select_(a.models);break;case "deselect":case "deselectAll":this.deselect_(a.models);break;case "focus":if(a.models.length>0){this.focus_(a.models,this.isIncremental_(a));this.deselect_(this.getAllModelIds_(this.selectionMap_))}break;case "hide":if(a.models.length>0){this.hide_(a.models,this.isIncremental_(a));this.deselect_(this.getAllModelIds_(this.selectionMap_))}break;
case "resetFocus":this.resetFocus_();this.deselect_(this.getAllModelIds_(this.selectionMap_));break}this.project_.logger().timeEnd("SelectionManager::onSelection")};rhizo.selection.SelectionManager.prototype.isIncremental_=function(a){return!("incremental"in a)||!!a.incremental};rhizo.selection.SelectionManager.prototype.getAllModelIds_=function(a){var b=[];for(var c in a)b.push(c);return b};
rhizo.selection.SelectionManager.prototype.getAllHiddenModels_=function(){for(var a=[],b=this.project_.models(),c=b.length-1;c>=0;c--)b[c].isFiltered("__selection__")&&a.push(b[c].id);return a};rhizo.selection.SelectionManager.prototype.extendSelection_=function(a){$.isArray(a)||(a=[a]);for(var b=[],c=0;c<a.length;c++)this.project_.model(a[c])&&Array.prototype.push.apply(b,this.project_.layoutManager().extendSelection(a[c]));return b};
rhizo.selection.SelectionManager.prototype.select_=function(a){for(var b=a.length-1;b>=0;b--)this.selectSingle_(a[b])};rhizo.selection.SelectionManager.prototype.deselect_=function(a){for(var b=a.length-1;b>=0;b--)this.deselectSingle_(a[b])};rhizo.selection.SelectionManager.prototype.selectSingle_=function(a){var b=this.project_.model(a);b.setSelected(true);this.selectionMap_[a]=b};rhizo.selection.SelectionManager.prototype.deselectSingle_=function(a){this.project_.model(a).setSelected(false);delete this.selectionMap_[a]};
rhizo.selection.SelectionManager.prototype.focus_=function(a,b){for(var c={},d=a.length-1;d>=0;d--)c[a[d]]=true;var e=[],f=this.project_.models();for(d=f.length-1;d>=0;d--)f[d].id in c||e.push(f[d].id);this.hide_(e,b)};rhizo.selection.SelectionManager.prototype.hide_=function(a,b){b||this.project_.filterManager().removeFilterFromModels("__selection__");for(var c=a.length-1;c>=0;c--){var d=this.project_.model(a[c]);d&&d.filter("__selection__")}this.project_.alignFx();this.project_.layoutManager().forceLayout({filter:true})};
rhizo.selection.SelectionManager.prototype.resetFocus_=function(){if(this.project_.filterManager().removeFilterFromModels("__selection__")){this.project_.alignFx();this.project_.layoutManager().forceLayout({filter:true})}};namespace("rhizo.ui");
rhizo.ui.toHumanLabel=function(a){if(typeof a=="number"&&a!=0){var b=rhizo.util.orderOfMagnitude(a);if(b<0)return a.toFixed(-b);else if(b<3)return a;b=parseInt(b/3,10);var c=["","K","M","G","T","P","E","Z","Y"][b]||"";return(a/Math.pow(10,b*3)).toPrecision(3)+c}else return a};
rhizo.ui.fadeAllRenderingsTo=function(a,b,c){for(var d=[],e=0;e<a.length;e++)d.push(a[e].rendering().raw_());if(b==rhizo.ui.Visibility.HIDDEN)$(d).fadeOut(function(){if(c)for(var f=a.length-1;f>=0;f--)a[f].rendering().move(0,0,true)});else b==rhizo.ui.Visibility.VISIBLE?$(d).fadeIn():$(d).greyOut()};rhizo.ui.eventToModel=function(a,b){return b.model($(a.currentTarget).data("id"))};rhizo.ui.elementToModel=function(a,b){return b.model($(a).data("id"))};rhizo.ui.Visibility={HIDDEN:0,GREY:1,VISIBLE:2};
rhizo.ui.RenderingOp={ARTIFACT:"artifact",MOVE:"move",RESIZE:"resize",STYLE:"style"};rhizo.ui.RenderingPipeline=function(a,b){this.project_=a;this.container_=b;this.renderingOps_={};this.artifacts_=[];this.artifactLayer_=$("<div />").css({visibility:"hidden",opacity:0}).appendTo(this.container_);this.backupEnabled_=true;this.backupManager_=new rhizo.ui.RenderingBackupManager};
rhizo.ui.RenderingPipeline.prototype.cleanup=function(){this.artifactLayer_.fadeOut(function(){$(this).remove()});this.artifactLayer_=$("<div />").css({visibility:"hidden",opacity:0}).appendTo(this.container_);this.artifacts_=[];this.renderingOps_={}};rhizo.ui.RenderingPipeline.prototype.backupManager=function(){return this.backupEnabled_?this.backupManager_:null};rhizo.ui.RenderingPipeline.prototype.setBackupEnabled=function(a){a||this.backupManager_.clear();this.backupEnabled_=a};
rhizo.ui.RenderingPipeline.prototype.backup_=function(a){if(this.backupEnabled_)return this.backupManager_.backup(a,this.project_.model(a).rendering());return false};rhizo.ui.RenderingPipeline.prototype.getModelOps_=function(a){a in this.renderingOps_||(this.renderingOps_[a]=[]);return this.renderingOps_[a]};
rhizo.ui.RenderingPipeline.prototype.move=function(a,b,c,d,e){var f=this.getModelOps_(a);b={op:rhizo.ui.RenderingOp.MOVE,top:b,left:c};if(d!==undefined&&e!==undefined){this.backup_(a);b.elevation={key:d,value:e}}f.push(b);return this};rhizo.ui.RenderingPipeline.prototype.resize=function(a,b,c){this.backup_(a);this.getModelOps_(a).push({op:rhizo.ui.RenderingOp.RESIZE,width:b,height:c});return this};
rhizo.ui.RenderingPipeline.prototype.style=function(a,b){this.backup_(a);this.getModelOps_(a).push({op:rhizo.ui.RenderingOp.STYLE,styleProps:b});return this};rhizo.ui.RenderingPipeline.prototype.artifact=function(a){this.artifactLayer_.append(a);return this};
rhizo.ui.RenderingPipeline.prototype.apply=function(){this.project_.logger().time("RenderingPipeline::apply");var a={top:Number.POSITIVE_INFINITY,left:Number.POSITIVE_INFINITY,width:0,height:0};for(var b in this.renderingOps_){for(var c=this.renderingOps_[b],d=c.length-1;d>=0;d--){var e=this.project_.model(b).rendering();switch(c[d].op){case rhizo.ui.RenderingOp.MOVE:e.move(c[d].top,c[d].left);c[d].elevation&&e.pushElevation(c[d].elevation.key,c[d].elevation.value);break;case rhizo.ui.RenderingOp.RESIZE:e.rescaleRendering(c[d].width,
c[d].height);break;case rhizo.ui.RenderingOp.STYLE:e.setCss(c[d].styleProps);break;default:throw"Unrecognized rendering op: "+c[d].op;}}this.updateBoundingRectangleCorner_(e,a)}this.computeBoundingRectangleArea_(a);this.artifactLayer_.fadeIn();this.project_.logger().timeEnd("RenderingPipeline::apply");return a};rhizo.ui.RenderingPipeline.prototype.updateBoundingRectangleCorner_=function(a,b){var c=a.position();b.top=Math.min(c.top,b.top);b.left=Math.min(c.left,b.left)};
rhizo.ui.RenderingPipeline.prototype.computeBoundingRectangleArea_=function(a){for(var b in this.renderingOps_){var c=this.project_.model(b).rendering(),d=c.getDimensions();c=c.position();a.width=Math.max(a.width,d.width+c.left-a.left);a.height=Math.max(a.height,d.height+c.top-a.top)}};rhizo.ui.RenderingBackupManager=function(){this.renderingBackups_={};this.numBackups_=0};rhizo.ui.RenderingBackupManager.prototype.clear=function(){this.renderingBackups_={};this.numBackups_=0};
rhizo.ui.RenderingBackupManager.prototype.backup=function(a,b){if(!(a in this.renderingBackups_)){this.renderingBackups_[a]=new rhizo.ui.RenderingBackup(b);this.numBackups_++;return true}return false};rhizo.ui.RenderingBackupManager.prototype.removeBackup=function(a){if(a in this.renderingBackups_){delete this.renderingBackups_[a];this.numBackups_--}};
rhizo.ui.RenderingBackupManager.prototype.restore=function(a,b){if(this.numBackups_>0){for(var c={},d=0;d<a.length;d++)c[a[d].id]=true;d={};for(var e in this.renderingBackups_)e in c||(d[e]=true);this.restoreInternal_(d,true,true,true);b&&this.restoreInternal_(this.renderingBackups_,false,false,true)}};rhizo.ui.RenderingBackupManager.prototype.restoreAll=function(){this.restoreInternal_(this.renderingBackups_,true,true,true);this.renderingBackups_={};this.numBackups_=0};
rhizo.ui.RenderingBackupManager.prototype.restoreInternal_=function(a,b,c,d){for(var e in a){this.renderingBackups_[e].restore(b,c,d);if(b&&c&&d){delete this.renderingBackups_[e];this.numBackups_--}}};rhizo.ui.RenderingBackup=function(a){this.rendering_=a;this.originalDimensions_=jQuery.extend({},a.getDimensions());this.originalBackground_=a.css("background-color");this.originalElevation_=this.rendering_.cloneElevation()};
rhizo.ui.RenderingBackup.prototype.restore=function(a,b,c){c&&this.rendering_.setCss({backgroundColor:this.originalBackground_},true);a&&this.rendering_.rescaleRendering(this.originalDimensions_.width,this.originalDimensions_.height);b&&this.rendering_.restoreElevation(this.originalElevation_)};rhizo.ui.Elevation=function(a){this.elevations_={};this.elevation_top_=0;this.elevation_offset_=a||0};
rhizo.ui.Elevation.prototype.clone=function(){var a=new rhizo.ui.Elevation;a.elevations_=$.extend({},this.elevations_);a.elevation_top_=this.elevation_top_;a.elevation_offset_=this.elevation_offset_;return a};rhizo.ui.Elevation.prototype.add=function(a,b){if(b<=0)return false;this.elevations_[a]=b;return this.recomputeTop_()};rhizo.ui.Elevation.prototype.remove=function(a){delete this.elevations_[a];return this.recomputeTop_()};
rhizo.ui.Elevation.prototype.top=function(){return this.elevation_top_+this.elevation_offset_};rhizo.ui.Elevation.prototype.empty=function(){return this.elevation_top_==0};rhizo.ui.Elevation.prototype.recomputeTop_=function(){var a=0;for(var b in this.elevations_)a=Math.max(a,this.elevations_[b]);if(a!=this.elevation_top_){this.elevation_top_=a;return true}return false};
rhizo.ui.Rendering=function(a,b,c,d){this.model_=a;this.id=a.id;this.raw_node_=b;this.naked_node_=b.children().get(0);this.raw_node_.data("id",a.id);this.renderer_=c;this.renderingHints_=d;this.rendererAttachListener_=this.rendererStyleChanger_=this.rendererRescaler_=this.rendererSizeChecker_=null;this.setRendererHelpers_();this.expanded_=this.expandable_=false;this.position_={};this.cacheDimensions_=false;this.cachedDimensions_={};this.mark_=null;this.visibility=rhizo.ui.Visibility.HIDDEN;this.elevation_=
new rhizo.ui.Elevation(50);this.modes_={};this.notifyAttach_(true)};
rhizo.ui.Rendering.prototype.setRendererHelpers_=function(){if(typeof this.renderer_.canRescaleTo=="function")this.rendererSizeChecker_=this.renderer_.canRescaleTo;if(typeof this.renderer_.rescale=="function")this.rendererRescaler_=this.renderer_.rescale;if(typeof this.renderer_.changeStyle=="function")this.rendererStyleChanger_=this.renderer_.changeStyle;if(typeof this.renderer_.onAttach=="function")this.rendererAttachListener_=this.renderer_.onAttach};rhizo.ui.Rendering.prototype.raw_=function(){return this.raw_node_.get(0)};
rhizo.ui.Rendering.prototype.notifyAttach_=function(a){this.rendererAttachListener_&&this.rendererAttachListener_(this.model_.unwrap(),this.naked_node_,a)};
rhizo.ui.Rendering.prototype.reRender_=function(){this.notifyAttach_(false);this.raw_node_.children(":not(.rhizo-expand-model)").remove();this.naked_node_=$(this.renderer_.render(this.model_.unwrap(),this.expanded_,this.renderingHints_)).get(0);this.raw_node_.toggleClass("rhizo-model-expanded",this.expanded_).css({width:"",height:""});this.expanded_?this.pushElevation("__expanded__",200):this.popElevation("__expanded__");this.raw_node_.append(this.naked_node_);this.notifyAttach_(true);this.refreshCachedDimensions_()};
rhizo.ui.Rendering.prototype.beforeDestroy=function(){this.notifyAttach_(false)};rhizo.ui.Rendering.prototype.destroy=function(){this.beforeDestroy();this.raw_node_.remove();this.raw_node_=null};rhizo.ui.Rendering.prototype.move=function(a,b,c){if(this.position_.top==a&&this.position_.left==b)return this;c?this.raw_node_.css({top:a,left:b}):this.raw_node_.move(a,b);this.position_={top:a,left:b};return this};
rhizo.ui.Rendering.prototype.moveToMark=function(a){this.mark_!==null&&this.move(this.mark_.top,this.mark_.left,a);return this};rhizo.ui.Rendering.prototype.moveFromMark=function(a,b,c){this.mark_!=null?this.move(this.mark_.top+a,this.mark_.left+b,c):this.move(a,b,c);return this};rhizo.ui.Rendering.prototype.markPosition=function(){this.mark_={top:parseInt(this.raw_node_.css("top"),10),left:parseInt(this.raw_node_.css("left"),10)};return this};
rhizo.ui.Rendering.prototype.unmarkPosition=function(){this.mark_=null;return this};rhizo.ui.Rendering.prototype.distanceFromMark=function(a,b){return this.mark_!=null?{left:b-this.mark_.left,top:a-this.mark_.top}:null};rhizo.ui.Rendering.prototype.refreshPosition=function(){this.position_={top:parseInt(this.raw_node_.css("top"),10),left:parseInt(this.raw_node_.css("left"),10)};return this};rhizo.ui.Rendering.prototype.position=function(){return this.position_};
rhizo.ui.Rendering.prototype.setSelected=function(a){a?this.raw_node_.addClass("ui-selected"):this.raw_node_.removeClass("ui-selected")};rhizo.ui.Rendering.prototype.startDimensionCaching=function(){this.cacheDimensions_=true;this.refreshCachedDimensions_()};rhizo.ui.Rendering.prototype.refreshCachedDimensions_=function(){this.cachedDimensions_={width:this.raw_().offsetWidth,height:this.raw_().offsetHeight}};
rhizo.ui.Rendering.prototype.getDimensions=function(){return this.cacheDimensions_?this.cachedDimensions_:{width:this.raw_().offsetWidth,height:this.raw_().offsetHeight}};rhizo.ui.Rendering.prototype.startExpandable=function(a){if(this.expandableByModel_()){a.data("id",this.id);this.raw_node_.append(a);this.expandable_=true}};
rhizo.ui.Rendering.prototype.expandableByModel_=function(){return typeof this.renderer_.expandableByModel=="function"?this.renderer_.expandableByModel(this.model_.unwrap(),this.renderingHints_):true};rhizo.ui.Rendering.prototype.setExpanded=function(a){if(!this.expandable_||this.expanded_==a)return this;this.expanded_=a;this.reRender_();return this};rhizo.ui.Rendering.prototype.toggleExpanded=function(){this.expanded_=!this.expanded_;this.reRender_();return this};
rhizo.ui.Rendering.prototype.modelChanged=function(){this.reRender_()};rhizo.ui.Rendering.prototype.pushElevation=function(a,b){this.elevation_.add(a,b)&&this.raw_node_.css("z-index",this.elevation_.top())};rhizo.ui.Rendering.prototype.popElevation=function(a){if(this.elevation_.remove(a))this.raw_node_.css("z-index",this.elevation_.empty()?"":this.elevation_.top())};rhizo.ui.Rendering.prototype.cloneElevation=function(){return this.elevation_.clone()};
rhizo.ui.Rendering.prototype.restoreElevation=function(a){this.elevation_=a;this.raw_node_.css("z-index",this.elevation_.empty()?"":this.elevation_.top())};rhizo.ui.Rendering.prototype.canRescaleTo=function(a,b,c){if(a<=2||b<=2){c&&c();return false}if(this.rendererSizeChecker_){a=this.rendererSizeChecker_(this.model_.unwrap(),this.naked_node_,a-2,b-2);!a&&c&&c();return a}return true};
rhizo.ui.Rendering.prototype.rescaleRendering=function(a,b){if(this.cacheDimensions_&&this.cachedDimensions_.width==a&&this.cachedDimensions_.height==b)return this;this.cachedDimensions_={width:a,height:b};this.raw_node_.width(a-2).height(b-2);this.rendererRescaler_&&this.rendererRescaler_(this.model_.unwrap(),this.naked_node_,a-2,b-2);return this};
rhizo.ui.Rendering.prototype.setCss=function(a,b){if(typeof a!="object")throw"setCss() expects a map of properties.";this.raw_node_.css(a);this.rendererStyleChanger_&&this.rendererStyleChanger_(this.model_.unwrap(),this.naked_node_,a,b)};rhizo.ui.Rendering.prototype.css=function(a){if(typeof a!="string")throw"css() expects a string of the property to access.";return this.raw_node_.css(a)};rhizo.ui.Rendering.prototype.setMode=function(a){this.modes_[a]=true;return this};
rhizo.ui.Rendering.prototype.removeMode=function(a){delete this.modes_[a];return this};rhizo.ui.Rendering.prototype.isMode=function(a){return!!this.modes_[a]};
rhizo.ui.SyntheticRendering=function(a){this.raw_node_=a;this.raw_node_.css("position","absolute");this.position_={};this.cacheDimensions_=true;this.cachedDimensions_={width:this.raw_node_.get(0).offsetWidth,height:this.raw_node_.get(0).offsetHeight};this.elevation_=new rhizo.ui.Elevation(parseInt(this.raw_node_.css("z-index"),10));this.rendererRescaler_=this.rendererSizeChecker_=null};rhizo.ui.SyntheticRendering.prototype.move=rhizo.ui.Rendering.prototype.move;
rhizo.ui.SyntheticRendering.prototype.pushElevation=rhizo.ui.Rendering.prototype.pushElevation;rhizo.ui.SyntheticRendering.prototype.popElevation=rhizo.ui.Rendering.prototype.popElevation;rhizo.ui.SyntheticRendering.prototype.canRescaleTo=rhizo.ui.Rendering.prototype.canRescaleTo;rhizo.ui.SyntheticRendering.prototype.rescaleRendering=rhizo.ui.Rendering.prototype.rescaleRendering;rhizo.ui.SyntheticRendering.prototype.getDimensions=rhizo.ui.Rendering.prototype.getDimensions;
rhizo.ui.RenderingBootstrap=function(a,b,c){this.renderer_=a;this.gui_=b;this.project_=c;this.logger_=c.logger()};
rhizo.ui.RenderingBootstrap.prototype.buildRenderings=function(a){for(var b=[],c=this.getDragHandleSelector_()!=null,d=0;d<a.length;d++){if(a[d].rendering()){this.logger_.error("Rendering requested for a model that has already been rendered. Model id: "+model.id);return false}this.rawrender_(a[d],b,c)}if(b.length==0){this.logger_.error("No renderings.");return false}c=this.numRenderedModels_();typeof b[0]=="string"?this.buildFromStrings_(a,b,c):this.buildFromShells_(a,b);b=this.gui_.universe.find(".rhizo-model").slice(c);
if(!this.sanityCheck_(b,a))return false;this.decorateRenderings_(b,a);return true};rhizo.ui.RenderingBootstrap.prototype.numRenderedModels_=function(){for(var a=0,b=this.project_.models(),c=b.length-1;c>=0;c--)a+=b[c].rendering()==null?0:1;return a};
rhizo.ui.RenderingBootstrap.prototype.rawrender_=function(a,b,c){a=this.renderer_.render(a.unwrap(),a.expanded,this.gui_.allRenderingHints());var d="rhizo-model";if(this.project_.options().isDragAndDropEnabled()&&!c)d+=" rhizo-drag-handle";if(typeof a=="string"){b.push('<div class="');b.push(d);b.push('">');b.push(a);b.push("</div>")}else{c=$("<div />",{"class":d});c.append(a);b.push(c)}};
rhizo.ui.RenderingBootstrap.prototype.buildFromStrings_=function(a,b,c){this.gui_.universe.append(b.join(""));this.gui_.universe.find(".rhizo-model").slice(c).each(jQuery.proxy(function(d,e){var f=a[d],g=new rhizo.ui.Rendering(f,$(e),this.renderer_,this.gui_.allRenderingHints());f.setRendering(g)},this))};
rhizo.ui.RenderingBootstrap.prototype.buildFromShells_=function(a,b){for(var c=0;c<a.length;c++){this.gui_.universe.append(b[c]);var d=new rhizo.ui.Rendering(a[c],b[c],this.renderer_,this.gui_.allRenderingHints());a[c].setRendering(d)}};
rhizo.ui.RenderingBootstrap.prototype.sanityCheck_=function(a,b){if(a.length!=b.length){this.logger_.error("The number of new renderings and models differ: "+a.length+"  (raw), "+numModels+" (models).");return false}for(var c=b.length-1;c>=0;c--)if(!b[c].rendering()){this.logger_.error("At least one model (id="+b[c].id+") has no rendering attached.");return false}return true};
rhizo.ui.RenderingBootstrap.prototype.getDragHandleSelector_=function(){return typeof this.renderer_.dragHandle=="string"?this.renderer_.dragHandle:typeof this.renderer_.dragHandle=="function"?this.renderer_.dragHandle():null};
rhizo.ui.RenderingBootstrap.prototype.decorateRenderings_=function(a,b){this.canCacheDimensions_()&&this.startDimensionCaching_(b);this.expandable_()&&this.startExpandable_(a,b);this.startClick_(a);this.project_.options().isDragAndDropEnabled()&&window.setTimeout(jQuery.proxy(function(){this.startDraggable_(a)},this),100)};rhizo.ui.RenderingBootstrap.prototype.canCacheDimensions_=function(){return!!this.renderer_.cacheDimensions||this.project_.options().forceDimensionCaching()};
rhizo.ui.RenderingBootstrap.prototype.startDimensionCaching_=function(a){for(var b=a.length-1;b>=0;b--)a[b].rendering().startDimensionCaching()};rhizo.ui.RenderingBootstrap.prototype.expandable_=function(){return typeof this.renderer_.expandable=="boolean"?this.renderer_.expandable:typeof this.renderer_.expandable=="function"?this.renderer_.expandable(this.gui_.allRenderingHints()):false};
rhizo.ui.RenderingBootstrap.prototype.startExpandable_=function(a,b){for(var c=$("<div />",{"class":"rhizo-expand-model rhizo-icon rhizo-maximize-icon",title:"Maximize"}),d=b.length-1;d>=0;d--)b[d].rendering().startExpandable(c.clone());a.hover(function(){$(this).children(".rhizo-expand-model").css("visibility","visible")},function(){$(this).children(".rhizo-expand-model").css("visibility","hidden")});$(".rhizo-expand-model",this.gui_.container).click(jQuery.proxy(function(e){rhizo.ui.eventToModel(e,
this.project_).rendering().toggleExpanded();return false},this))};
rhizo.ui.RenderingBootstrap.prototype.startClick_=function(a){a.click(jQuery.proxy(function(b){var c=rhizo.ui.eventToModel(b,this.project_);if(c.rendering().isMode("__dragging__")){c.rendering().removeMode("__dragging__");return false}if(b.target.nodeName!="A"){if($(b.target).is(".rhizo-stop-propagation")||$(b.target).parents(".rhizo-stop-propagation").length>0)return false;this.project_.options().isClickSelectionMode()&&this.project_.eventBus().publish("selection",{action:"toggle",models:c.id});
return false}},this))};
rhizo.ui.RenderingBootstrap.prototype.startDraggable_=function(a){a.draggable({cursor:"pointer",handle:this.getDragHandleSelector_()||".rhizo-drag-handle",distance:3,addClasses:false,start:jQuery.proxy(function(b,c){var d=rhizo.ui.elementToModel(c.helper[0],this.project_);d.rendering().setMode("__dragging__").markPosition().pushElevation("__dragging__",1E4);if(this.project_.selectionManager().isSelected(d.id)){d=this.project_.selectionManager().allSelected();for(var e in d)this.project_.model(e).rendering().markPosition()}},this),
drag:jQuery.proxy(function(b,c){var d=rhizo.ui.elementToModel(c.helper[0],this.project_);if(this.project_.selectionManager().isSelected(d.id)){var e=d.rendering().distanceFromMark(c.position.top,c.position.left),f=this.project_.selectionManager().allSelected();for(var g in f)g!=d.id&&f[g].rendering().moveFromMark(e.top,e.left,true)}},this),stop:jQuery.proxy(function(b,c){var d=[],e=rhizo.ui.elementToModel(c.helper[0],this.project_);e.rendering().unmarkPosition().refreshPosition().popElevation("__dragging__");
d.push({id:e.id,top:e.rendering().position().top,left:e.rendering().position().left});if(this.project_.selectionManager().isSelected(e.id)){e=this.project_.selectionManager().allSelected();for(var f in e){d.push({id:f,top:e[f].rendering().position().top,left:e[f].rendering().position().left});e[f].rendering().unmarkPosition().refreshPosition()}}this.project_.layoutManager().modelsMoved(d)},this),refreshPositions:false})};namespace("rhizo.keyboard");
rhizo.keyboard.Style={PADDING:5,KEY_HEIGHT:40,KEY_WIDTH:40,KEY_RADIUS:5,KEY_COLORS:{pressed:{fg:"#7aa5d6",text:"#7aa5d6",bg:"#e5ecf9"},hover:{fg:"#7aa5d6",text:"#7aa5d6",bg:"#fff"},base:{fg:"#555",text:"#555",bg:"#fff"}},KEY_FONT:"normal normal normal 22px sans-serif"};
rhizo.keyboard.Keyboard=function(a){this.container_=a;this.keys_=[];this.canvas_=$("<canvas />",{"class":"rhizo-keyboard"}).appendTo(a);this.canvas_.get(0).width=this.canvas_.width();this.canvas_.get(0).height=this.canvas_.height();this.ctx_=this.canvas_.get(0).getContext("2d");this.canvas_.css({left:($(window).width()-this.canvas_.width())/2,top:($(window).height()-this.canvas_.height())/2});this.canvas_.draggable();this.focusTarget_=null;this.ignoreBlur_=false;this.initEvents_();this.initKeys_()};
rhizo.keyboard.Keyboard.prototype.paint=function(){this.ctx_.clearRect(0,0,this.canvas_.get(0).width,this.canvas_.get(0).height);for(var a=0;a<this.keys_.length;a++)this.keys_[a].paint(this.ctx_)};rhizo.keyboard.Keyboard.prototype.getKeys=function(){return this.keys_};rhizo.keyboard.Keyboard.prototype.getFocusTarget=function(){return this.focusTarget_};
rhizo.keyboard.Keyboard.prototype.initEvents_=function(){$("input, textarea",this.container_).focus(jQuery.proxy(function(a){this.focusTarget_=a.target;this.canvas_.show();this.paint()},this)).blur(jQuery.proxy(function(){this.ignoreBlur_||this.canvas_.hide()},this));this.canvas_.mousemove(jQuery.proxy(function(a){for(var b=false,c=0;c<this.keys_.length;c++){var d=this.keys_[c].isInside(a.offsetX||a.layerX,a.offsetY||a.layerY);b=b||d;this.keys_[c].setHover(d)}this.canvas_.css("cursor",b?"pointer":
"move").draggable(b?"disable":"enable");this.paint()},this));this.canvas_.mousedown(jQuery.proxy(this.mousedown_,this));this.canvas_.mouseup(jQuery.proxy(function(){this.ignoreBlur_=false;for(var a=0;a<this.keys_.length;a++)this.keys_[a].isToggle()||this.keys_[a].setPressed(false);this.paint();$(this.focusTarget_).focus()},this))};
rhizo.keyboard.Keyboard.prototype.mousedown_=function(a){this.ignoreBlur_=true;for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b].isInside(a.offsetX||a.layerX,a.offsetY||a.layerY);if(this.keys_[b].isToggle())if(c)this.keys_[b].setPressed(!this.keys_[b].isPressed());else this.keys_[b].isToggleReleasedByOtherKeys()&&this.keys_[b].isPressed()&&this.keys_[b].setPressed(false);else this.keys_[b].setPressed(c)}this.paint()};
rhizo.keyboard.Keyboard.prototype.initKeys_=function(){var a={enter:rhizo.keyboard.EnterKey,"delete":rhizo.keyboard.DeleteKey,tab:rhizo.keyboard.TabKey,caps:rhizo.keyboard.CapsKey,shift:rhizo.keyboard.ShiftKey,reset:rhizo.keyboard.ResetKey,space:rhizo.keyboard.SpaceKey},b=[];b.push(["`","1","2","3","4","5","6","7","8","9","0","-","=","delete"]);b.push(["tab","q","w","e","r","t","y","u","i","o","p","[","]","\\"]);b.push(["caps","a","s","d","f","g","h","j","k","l",";","'","enter"]);b.push(["shift",
"z","x","c","v","b","n","m",",",".","/","reset"]);b.push(["space"]);for(var c=rhizo.keyboard.Style.PADDING,d=c,e=0;e<b.length;e++){for(var f=c,g=0;g<b[e].length;g++){var h=b[e][g];h=new (h in a?a[h]:rhizo.keyboard.Key)(b[e][g],f,d,this);this.keys_.push(h);f+=h.width()+c}d+=c+rhizo.keyboard.Style.KEY_HEIGHT}};
rhizo.keyboard.Key=function(a,b,c,d){this.key_=this.label_=a;this.kx_=b;this.ky_=c;this.keyboard_=d;this.radius_=rhizo.keyboard.Style.KEY_RADIUS;this.height_=rhizo.keyboard.Style.KEY_HEIGHT;this.width_=rhizo.keyboard.Style.KEY_WIDTH;this.hover_=this.pressed_=false;this.canAutofire_=true;this.autofireIntervalId_=null;this.colors_={}};rhizo.keyboard.Key.prototype.width=function(){return this.width_};rhizo.keyboard.Key.prototype.isToggle=function(){return false};
rhizo.keyboard.Key.prototype.paint=function(a){this.setStyles_(a);this.paintRoundedRect_(a);this.paintKey_(a)};rhizo.keyboard.Key.prototype.setStyles_=function(){this.colors_=this.pressed_?rhizo.keyboard.Style.KEY_COLORS.pressed:this.hover_?rhizo.keyboard.Style.KEY_COLORS.hover:rhizo.keyboard.Style.KEY_COLORS.base};
rhizo.keyboard.Key.prototype.paintRoundedRect_=function(a){a.beginPath();a.moveTo(this.kx_,this.ky_+this.radius_);a.lineTo(this.kx_,this.ky_+this.height_-this.radius_);a.quadraticCurveTo(this.kx_,this.ky_+this.height_,this.kx_+this.radius_,this.ky_+this.height_);a.lineTo(this.kx_+this.width()-this.radius_,this.ky_+this.height_);a.quadraticCurveTo(this.kx_+this.width(),this.ky_+this.height_,this.kx_+this.width(),this.ky_+this.height_-this.radius_);a.lineTo(this.kx_+this.width(),this.ky_+this.radius_);
a.quadraticCurveTo(this.kx_+this.width(),this.ky_,this.kx_+this.width()-this.radius_,this.ky_);a.lineTo(this.kx_+this.radius_,this.ky_);a.quadraticCurveTo(this.kx_,this.ky_,this.kx_,this.ky_+this.radius_);a.strokeStyle=this.colors_.fg;a.fillStyle=this.colors_.bg;a.fill();a.stroke()};
rhizo.keyboard.Key.prototype.paintKey_=function(a){a.fillStyle=this.colors_.text;a.font=rhizo.keyboard.Style.KEY_FONT;a.textBaseline="middle";a.textAlign="center";a.fillText(this.label_,this.kx_+this.width()/2,this.ky_+this.height_/2)};rhizo.keyboard.Key.prototype.isInside=function(a,b){return this.kx_<a&&this.kx_+this.width()>a&&this.ky_<b&&this.ky_+this.height_>b};rhizo.keyboard.Key.prototype.setHover=function(a){this.hover_=a};
rhizo.keyboard.Key.prototype.setPressed=function(a){(this.pressed_=a)&&this.modifyTarget_(this.keyboard_.getFocusTarget());if(this.canAutofire_)if(this.pressed_){if(this.autofireIntervalId_==null)this.autofireIntervalId_=window.setInterval(jQuery.proxy(this.setPressed,this),100,true)}else{window.clearInterval(this.autofireIntervalId_);this.autofireIntervalId_=null}};rhizo.keyboard.Key.prototype.isPressed=function(){return this.pressed_};
rhizo.keyboard.Key.prototype.setCaps=function(a){var b="abcdefghijklmnopqrstuvwxyz".toUpperCase(),c=a?"abcdefghijklmnopqrstuvwxyz`1234567890-=[]\\;',./":b+'~!@#$%^&*()_+{}|:"<>?';a=a?b+'~!@#$%^&*()_+{}|:"<>?':"abcdefghijklmnopqrstuvwxyz`1234567890-=[]\\;',./";for(b=0;b<c.length;b++)if(c[b]==this.label_){this.label_=a[b];this.key_=a[b];break}};
rhizo.keyboard.Key.prototype.modifyTarget_=function(a){var b=a.selectionStart,c=a.selectionEnd,d=$(a).val(),e="";if(c-b>0){e=d.substr(c);d=d.substr(0,b)}$(a).val(d+this.key_+e)};rhizo.keyboard.EnterKey=function(a,b,c,d){rhizo.keyboard.Key.call(this,a,b,c,d);this.width_=77;this.canAutofire_=false};rhizo.inherits(rhizo.keyboard.EnterKey,rhizo.keyboard.Key);rhizo.keyboard.EnterKey.prototype.modifyTarget_=function(a){$(a).change()};
rhizo.keyboard.TabKey=function(a,b,c,d){rhizo.keyboard.Key.call(this,a,b,c,d);this.width_=70;this.key_="\t"};rhizo.inherits(rhizo.keyboard.TabKey,rhizo.keyboard.Key);rhizo.keyboard.DeleteKey=function(a,b,c,d){rhizo.keyboard.Key.call(this,a,b,c,d);this.width_=70};rhizo.inherits(rhizo.keyboard.DeleteKey,rhizo.keyboard.Key);
rhizo.keyboard.DeleteKey.prototype.modifyTarget_=function(a){var b=a.selectionStart,c=a.selectionEnd,d=$(a).val();if(c-b>0)$(a).val(d.substr(0,b)+d.substr(c));else d.length>0&&$(a).val(d.substr(0,d.length-1))};rhizo.keyboard.CapsKey=function(a,b,c,d){rhizo.keyboard.Key.call(this,a,b,c,d);this.width_=80;this.canAutofire_=false};rhizo.inherits(rhizo.keyboard.CapsKey,rhizo.keyboard.Key);rhizo.keyboard.CapsKey.prototype.setPressed=function(a){this.pressed_=a;a=this.keyboard_.getKeys();for(var b=0;b<a.length;b++)a[b].setCaps(this.pressed_)};
rhizo.keyboard.CapsKey.prototype.isToggle=function(){return true};rhizo.keyboard.CapsKey.prototype.isToggleReleasedByOtherKeys=function(){return false};rhizo.keyboard.ShiftKey=function(a,b,c,d){rhizo.keyboard.CapsKey.call(this,a,b,c,d);this.width_=97};rhizo.inherits(rhizo.keyboard.ShiftKey,rhizo.keyboard.CapsKey);rhizo.keyboard.ShiftKey.prototype.isToggleReleasedByOtherKeys=function(){return true};
rhizo.keyboard.ResetKey=function(a,b,c,d){rhizo.keyboard.Key.call(this,a,b,c,d);this.width_=105;this.canAutofire_=false};rhizo.inherits(rhizo.keyboard.ResetKey,rhizo.keyboard.Key);rhizo.keyboard.ResetKey.prototype.modifyTarget_=function(a){$(a).val("").change()};rhizo.keyboard.SpaceKey=function(a,b,c,d){rhizo.keyboard.Key.call(this,a,b,c,d);this.width_=660;this.key_=" "};rhizo.inherits(rhizo.keyboard.SpaceKey,rhizo.keyboard.Key);namespace("rhizo");
rhizo.Options=function(a){this.options_={selectfilter:".rhizo-model:visible",selectionMode:"all",panningMode:"infinite",showErrorsInViewport:true,enableHTML5History:true,enableLoadingIndicator:true,enableAnims:true,enableDragAndDrop:true,enableLayoutOnResize:true,allowConfigFromUrl:false,logLevel:"error",cacheDimensions:false,arDefaults:true,arNumFields:5,uiStackFiltersThreshold:5};this.merge(a)};
rhizo.Options.prototype.merge=function(a){if(a)$.extend(this.options_,a instanceof rhizo.Options?a.options_:a)};rhizo.Options.prototype.asString_=function(a){a=this.options_[a];if(a!==null&&a!==undefined)return String(a);return null};rhizo.Options.prototype.asInteger_=function(a){a=parseInt(this.options_[a],10);return isNaN(a)?null:a};rhizo.Options.prototype.platform=function(){return this.asString_("platform")};rhizo.Options.prototype.device=function(){return this.asString_("device")};
rhizo.Options.prototype.template=function(){return this.asString_("template")};rhizo.Options.prototype.metamodel=function(){return this.options_.metamodel};rhizo.Options.prototype.metamodelFragment=function(){return this.options_.metamodelFragment};rhizo.Options.prototype.renderer=function(){return this.options_.renderer};rhizo.Options.prototype.logLevel=function(){return this.asString_("logLevel")};rhizo.Options.prototype.selectFilter=function(){return this.asString_("selectfilter")};
rhizo.Options.prototype.selectionMode=function(){return this.asString_("selectionMode")};rhizo.Options.prototype.isClickSelectionMode=function(){return this.selectionMode()=="click"||this.selectionMode()=="all"};rhizo.Options.prototype.isBoxSelectionMode=function(){return this.selectionMode()=="box"||this.selectionMode()=="all"};rhizo.Options.prototype.panningMode=function(){return this.asString_("panningMode")};rhizo.Options.prototype.showErrorsInViewport=function(){return!!this.options_.showErrorsInViewport};
rhizo.Options.prototype.isHTML5HistoryEnabled=function(){return!!this.options_.enableHTML5History};rhizo.Options.prototype.isLoadingIndicatorEnabled=function(){return!!this.options_.enableLoadingIndicator};rhizo.Options.prototype.isDragAndDropEnabled=function(){return!!this.options_.enableDragAndDrop};rhizo.Options.prototype.mustLayoutOnResize=function(){return!!this.options_.enableLayoutOnResize};rhizo.Options.prototype.areAnimationsEnabled=function(){return!!this.options_.enableAnims};
rhizo.Options.prototype.forceDimensionCaching=function(){return!!this.options_.cacheDimensions};rhizo.Options.prototype.allowConfigFromUrl=function(){return!!this.options_.allowConfigFromUrl};rhizo.Options.prototype.layoutConstraints=function(){return this.options_.layoutConstraints};rhizo.Options.prototype.autoRenderMasterField=function(){return this.asString_("arMaster")};rhizo.Options.prototype.autoRenderSizeField=function(){return this.asString_("arSize")};
rhizo.Options.prototype.autoRenderColorField=function(){return this.asString_("arColor")};rhizo.Options.prototype.autoRenderUseDefaults=function(){return!!this.options_.arDefaults};rhizo.Options.prototype.autoRenderNumberOfFields=function(){return this.asInteger_("arNumFields")};rhizo.Options.prototype.uiStackFiltersThreshold=function(){return this.asInteger_("uiStackFiltersThreshold")};namespace("rhizo.eventbus");rhizo.eventbus.nextParticipantUuid_=0;rhizo.eventbus.uuidKey_="__rhizo_event_uuid";
rhizo.eventbus.EventBus=function(a){this.logger_=a;this.channels_={}};rhizo.eventbus.EventBus.prototype.destroy=function(){this.channels_={}};rhizo.eventbus.EventBus.prototype.subscribe=function(a,b,c,d){this.getChannel_(a).addSubscriber(b,c,d)};rhizo.eventbus.EventBus.prototype.unsubscribe=function(a,b){a in this.channels_&&this.channels_[a].removeSubscriber(b)};rhizo.eventbus.EventBus.prototype.addPreprocessor=function(a,b,c,d){this.getChannel_(a).addPreprocessor(b,c,d)};
rhizo.eventbus.EventBus.prototype.removePreprocessor=function(a,b){a in this.channels_&&this.channels_[a].removePreprocessor(b)};rhizo.eventbus.EventBus.prototype.publish=function(a,b,c,d){if(a in this.channels_){this.logger_.group("message publish on channel "+a);this.logger_.debug("message payload ",b);this.logger_.time("Eventbus::publish");this.channels_[a].publish(b,c,d);this.logger_.timeEnd("Eventbus::publish");this.logger_.groupEnd("message publish on channel "+a)}else c&&c.call(d,true)};
rhizo.eventbus.EventBus.prototype.getChannel_=function(a){a in this.channels_||(this.channels_[a]=new rhizo.eventbus.Channel_(a));return this.channels_[a]};rhizo.eventbus.Channel_=function(a){this.name_=a;this.preprocessors_={};this.preprocessorsOrder_=[];this.subscribers_={};this.commitSubscribers_={}};rhizo.eventbus.Channel_.prototype.addSubscriber=function(a,b,c){this.add_(c?this.commitSubscribers_:this.subscribers_,a,b)};
rhizo.eventbus.Channel_.prototype.addPreprocessor=function(a,b,c){a=this.add_(this.preprocessors_,a,b);c?this.preprocessorsOrder_.splice(0,0,a):this.preprocessorsOrder_.push(a)};rhizo.eventbus.Channel_.prototype.removeSubscriber=function(a){this.remove_(this.subscribers_,a);this.remove_(this.commitSubscribers_,a)};
rhizo.eventbus.Channel_.prototype.removePreprocessor=function(a){a=this.remove_(this.preprocessors_,a);for(var b=0;b<this.preprocessorsOrder_.length;b++)if(a==this.preprocessorsOrder_[b]){this.preprocessorsOrder_.splice(b,1);return}};rhizo.eventbus.Channel_.prototype.publish=function(a,b,c){a=a||{};var d=this.preprocessorsOrder_.slice(0);this.preprocess_(a,d,jQuery.proxy(function(e,f){if(e)this.send_(a,b,c);else b&&b.call(c,false,f)},this))};
rhizo.eventbus.Channel_.prototype.preprocess_=function(a,b,c){b.length==0?c(true):b[0](a,jQuery.proxy(function(d,e){d?this.preprocess_(a,b.slice(1),c):c(false,e)},this))};rhizo.eventbus.Channel_.prototype.send_=function(a,b,c){this.sendToSubscriberPool_(a,this.subscribers_,c);this.sendToSubscriberPool_(a,this.commitSubscribers_,c);b&&b.call(c,true)};rhizo.eventbus.Channel_.prototype.sendToSubscriberPool_=function(a,b,c){for(var d in b)c&&d==c[rhizo.eventbus.uuidKey_]||b[d](a)};
rhizo.eventbus.Channel_.prototype.add_=function(a,b,c){if(typeof c[rhizo.eventbus.uuidKey_]=="undefined")c[rhizo.eventbus.uuidKey_]=rhizo.eventbus.nextParticipantUuid_++;var d=c[rhizo.eventbus.uuidKey_];a[d]=function(){b.apply(c,arguments)};return a[d]};rhizo.eventbus.Channel_.prototype.remove_=function(a,b){if(typeof b[rhizo.eventbus.uuidKey_]=="undefined")return null;var c=a[b[rhizo.eventbus.uuidKey_]];delete a[b[rhizo.eventbus.uuidKey_]];return c};namespace("rhizo.meta");
rhizo.meta.sortBy=function(a,b,c){return function(d,e){var f=d.unwrap(),g=e.unwrap(),h=c?-1:1;return b.compare?b.compare(f[a],g[a])*h:(f[a]<g[a]?-1:f[a]>g[a]?1:0)*h}};rhizo.meta.sortByKind=function(a,b){return function(c,d){var e=b?-1:1;return a.compare?a.compare(c,d)*e:(c<d?-1:c>d?1:0)*e}};rhizo.meta.KindRegistry=function(){this.registry_={};this.uiRegistry_={}};
rhizo.meta.KindRegistry.prototype.clone=function(){var a=new rhizo.meta.KindRegistry;$.extend(a.registry_,this.registry_);$.extend(a.uiRegistry_,this.uiRegistry_);return a};rhizo.meta.KindRegistry.prototype.registerKind=function(a,b){this.registry_[a]={method:"ctor",ctor:b}};rhizo.meta.KindRegistry.prototype.registerKindFactory=function(a,b){this.registry_[a]={method:"factory",factory:b}};
rhizo.meta.KindRegistry.prototype.registerKindUi=function(a,b){if(typeof a=="string")this.uiRegistry_[a]={method:"ctor",ctor:b};else a.__kindRegistry_ui={method:"ctor",ctor:b}};rhizo.meta.KindRegistry.prototype.registerKindUiFactory=function(a,b){if(typeof a=="string")this.uiRegistry_[a]={method:"factory",factory:b};else a.__kindRegistry_ui={method:"factory",factory:b}};
rhizo.meta.KindRegistry.prototype.createNewKind=function(a,b){if(!(a in this.registry_))return null;var c=null;c=this.registry_[a].method=="ctor"?new this.registry_[a].ctor(b):this.registry_[a].factory(b);if(a in this.uiRegistry_)c.__kindRegistry_ui=this.uiRegistry_[a];return c};rhizo.meta.KindRegistry.prototype.createUiForKind=function(a,b,c){if(!this.uiExistsForKind(a))return null;a=a.__kindRegistry_ui;return a.method=="ctor"?new a.ctor(b,c):a.factory(b,c)};
rhizo.meta.KindRegistry.prototype.uiExistsForKind=function(a){return!!a.__kindRegistry_ui};rhizo.meta.defaultRegistry=new rhizo.meta.KindRegistry;rhizo.meta.Kind={STRING:"string",NUMBER:"number",RANGE:"range",DATE:"date",BOOLEAN:"boolean",CATEGORY:"category"};rhizo.meta.StringKind=function(){};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.STRING,rhizo.meta.StringKind);
rhizo.meta.StringKind.prototype.survivesFilter=function(a,b){return a!=""&&(b||"").toLowerCase().indexOf(a.toLowerCase())!=-1};rhizo.meta.StringKind.prototype.cluster=function(a){if(a===null||typeof a=="undefined")a="";return{key:a.toString().toUpperCase().charAt(0),label:a.toString().toUpperCase().charAt(0)}};rhizo.meta.StringKind.prototype.isNumeric=function(){return false};rhizo.meta.NumberKind=function(){};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.NUMBER,rhizo.meta.NumberKind);
rhizo.meta.NumberKind.prototype.survivesFilter=function(a,b){var c=parseInt(a,10);return isNaN(c)?true:c==b};rhizo.meta.NumberKind.prototype.compare=function(a,b){return parseInt(a,10)-parseInt(b,10)};
rhizo.meta.NumberKind.prototype.cluster=function(a){var b=parseInt(a,10);if(isNaN(b))return{key:"-",label:"-"};if(parseFloat(a)<=10)return{key:b,label:b.toString()};for(var c=0;b>=10;){b=parseInt(b/10);c++}c=Math.pow(10,c);b=parseInt(a/c,10)*c;a=parseInt(a/c+1,10)*c;return{key:b,label:b.toString()+" - "+a.toString()}};rhizo.meta.NumberKind.prototype.isNumeric=function(){return true};rhizo.meta.RangeKind=function(){};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.RANGE,rhizo.meta.RangeKind);
rhizo.meta.RangeKind.prototype.survivesFilter=function(a,b){return b>=a.min&&b<=a.max};rhizo.meta.RangeKind.prototype.compare=rhizo.meta.NumberKind.prototype.compare;rhizo.meta.RangeKind.prototype.cluster=rhizo.meta.NumberKind.prototype.cluster;rhizo.meta.RangeKind.prototype.isNumeric=rhizo.meta.NumberKind.prototype.isNumeric;
rhizo.meta.DateKind=function(a){this.monthMap_=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.clusterby_=a.clusterBy||"y";if(this.clusterby_!="y"&&this.clusterby_!="m"&&this.clusterby_!="d")this.clusterby_="y"};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.DATE,rhizo.meta.DateKind);
rhizo.meta.DateKind.prototype.survivesFilter=function(a,b){var c=parseInt(a[0],10),d=parseInt(a[1],10),e=parseInt(a[2],10);if(!b)return isNaN(c)&&isNaN(d)&&isNaN(e);return(isNaN(c)||b.getFullYear()==c)&&(isNaN(d)||b.getMonth()==d)&&(isNaN(e)||b.getDate()==e)};
rhizo.meta.DateKind.prototype.cluster=function(a){if(!a)return{key:"Undefined date",label:"Undefined date"};return this.clusterby_=="y"?{key:a.getFullYear()+"-00-01",label:a.getFullYear()}:this.clusterby_=="m"?{key:a.getFullYear()+"-"+this.addZero_(a.getMonth())+"-01",label:a.getFullYear()+"-"+this.monthMap_[a.getMonth()]}:{key:a.getFullYear()+"-"+this.addZero_(a.getMonth())+"-"+this.addZero_(a.getDate()),label:a.getFullYear()+"-"+this.monthMap_[a.getMonth()]+"-"+a.getDate()}};
rhizo.meta.DateKind.prototype.isNumeric=function(){return false};rhizo.meta.DateKind.prototype.addZero_=function(a){a=String(a);if(a.length==1)a="0"+a;return a};rhizo.meta.BooleanKind=function(){};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.BOOLEAN,rhizo.meta.BooleanKind);rhizo.meta.BooleanKind.prototype.survivesFilter=function(a,b){return a==b};rhizo.meta.BooleanKind.prototype.compare=function(a,b){return a?b?0:-1:b?1:0};rhizo.meta.BooleanKind.prototype.isNumeric=function(){return false};
rhizo.meta.CategoryKind=function(){};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.CATEGORY,rhizo.meta.CategoryKind);rhizo.meta.CategoryKind.prototype.survivesFilter=function(a,b){$.isArray(b)||(b=[b]);$.isArray(a)||(a=[a]);for(var c=false,d=0;d<a.length;d++)if(b&&b.indexOf(a[d])!=-1){c=true;break}return c};rhizo.meta.CategoryKind.prototype.cluster=function(a){if(!a)return{key:"Nothing",label:"Nothing"};return{key:a.length==0?"Nothing":a.toString(),label:a.length==0?"Nothing":a.toString()}};
rhizo.meta.CategoryKind.prototype.compare=function(a,b){return(a?a.length:0)-(b?b.length:0)};rhizo.meta.CategoryKind.prototype.isNumeric=function(){return false};namespace("rhizo.layout");
rhizo.layout.LayoutManager=function(a){this.defaultEngine_="flow";this.curEngineName_=null;this.project_=a;this.gui_=a.gui();this.engines_={};this.renderingPipeline_=new rhizo.ui.RenderingPipeline(a,a.gui().universe);this.project_.eventBus().addPreprocessor("layout",this.onBeforeLayout_,this,true);this.project_.eventBus().subscribe("layout",this.onLayout_,this)};rhizo.layout.LayoutManager.prototype.toString=function(){return"LayoutManager"};
rhizo.layout.LayoutManager.prototype.initEngines=function(a){for(var b in a){var c=new a[b].engine(this.project_);c.verifyMetaModel&&!c.verifyMetaModel(this.project_.metaModel())||(this.engines_[b]=c)}};rhizo.layout.LayoutManager.prototype.getEngineNames=function(){var a=[];for(var b in this.engines_)a.push(b);return a};rhizo.layout.LayoutManager.prototype.getCurrentEngineName=function(){return this.curEngineName_};
rhizo.layout.LayoutManager.prototype.getEngineState=function(a){if(this.engines_[a]&&this.engines_[a].getState)return this.engines_[a].getState();return null};rhizo.layout.LayoutManager.prototype.extendSelection=function(a){var b=this.engines_[this.curEngineName_];if(b.dependentModels){b=b.dependentModels(a);b.push(a);return b}return[a]};
rhizo.layout.LayoutManager.prototype.onBeforeLayout_=function(a,b){if(!("engine"in a))a.engine=this.curEngineName_;a.engine=a.engine||this.defaultEngine_;var c=this.engines_[a.engine];if(c){"state"in a||(a.state=c.getState?c.getState():null);c.setState?this.onBeforeEngineLayout_(c,a,b):b(true)}else b(false,"Invalid layout engine:"+a.engine)};
rhizo.layout.LayoutManager.prototype.onBeforeEngineLayout_=function(a,b,c){if(a.setState(b.state)){b.state=a.getState();c(true)}else c(false,"Received invalid layout state for engine: "+a)};
rhizo.layout.LayoutManager.prototype.onLayout_=function(a){this.project_.logger().time("LayoutManager::onLayout");var b=this.engines_[this.curEngineName_],c=a.options||{};this.curEngineName_=a.engine;var d=this.engines_[this.curEngineName_],e=false;if(b&&b.cleanup)e=b.cleanup(b==d)||e;this.renderingPipeline_.cleanup();b!=d&&this.renderingPipeline_.backupManager().restoreAll();this.gui_.universe.move(0,0,{bottom:0,right:0});var f=this.project_.models();b=[];for(var g=f.length-1;g>=0;g--)f[g].isAvailableForLayout()&&
b.push(f[g]);this.project_.logger().debug(b.length+" models available for layout");f={top:0,left:0,width:0,height:0};if(b.length>0){g=new rhizo.layout.LayoutBox(this.gui_.viewport,this.project_.options().layoutConstraints());if(!g.isEmpty()){e=d.layout(this.renderingPipeline_,g,b,this.project_.modelsMap(),this.project_.metaModel(),c)||e;f=this.renderingPipeline_.apply()}}this.gui_.universe.css({width:Math.max(f.width+f.left,this.gui_.viewport.get(0).clientWidth),height:Math.max(f.height+f.top,this.gui_.viewport.get(0).clientHeight)}).move(0,
0);if(e||c.forcealign){this.project_.logger().debug("Align visibility dirty=",e," forceAlign=",c.forcealign);this.project_.filterManager().alignVisibility()}a.positions&&this.moveModels_(a.positions);this.project_.logger().timeEnd("LayoutManager::onLayout")};rhizo.layout.LayoutManager.prototype.moveModels_=function(a){for(var b=a.length-1;b>=0;b--){var c=this.project_.model(a[b].id);c&&c.rendering().move(a[b].top,a[b].left)}};
rhizo.layout.LayoutManager.prototype.modelsMoved=function(a){this.project_.eventBus().publish("layout",{positions:a},null,this)};rhizo.layout.LayoutManager.prototype.forceLayout=function(a){var b={options:$.extend({},a,{forcealign:true})};this.onBeforeLayout_(b,jQuery.proxy(function(){this.onLayout_(b)},this))};namespace("rhizo.log");
rhizo.log.newLogger=function(a,b){for(var c=rhizo.log.getLogLevel(b),d={},e="dir dirxml count debug log info warn time timeEnd group groupEnd error".split(" "),f=false,g=e.length;g>=0;g--){f?rhizo.log.createNoOp(e[g],d):rhizo.log.createDelegate(e[g],d,window.console);f=f||e[g]==c}if(a){var h=d.error;d.error=function(){a.eventBus().publish("error",{arguments:Array.prototype.slice.call(arguments)});h.apply(d,arguments)}}return d};
rhizo.log.getLogLevel=function(a){var b="error";if(a&&a.logLevel())b=a.logLevel();b in{debug:true,info:true,warn:true,time:true,error:true}||(b="error");return b};rhizo.log.createDelegate=function(a,b,c){b[a]=function(){c&&c[a]&&typeof c[a]=="function"&&c[a].apply(c,arguments)}};rhizo.log.createNoOp=function(a,b){b[a]=function(){}};namespace("rhizo.state");rhizo.state.TYPE="__rhizo_state__";rhizo.state.Facets={LAYOUT:"layout",SELECTION_FILTER:"selection",FILTER:"filter"};
rhizo.state.Bindings={PROJECT:"project",HISTORY:"history"};rhizo.state.MasterOverlord=function(){this.state_={type:rhizo.state.TYPE,uuids:{},delta:{ts:null,uuid:null,facet:null,facetState:null}};this.projectOverlords_={};this.initialStateOwner_=null};
rhizo.state.MasterOverlord.prototype.attachProject=function(a,b){var c=a.uuid(),d=new rhizo.state.ProjectOverlord(this,a,b);this.projectOverlords_[c]=d;if(c in this.state_.uuids){if(!this.initialStateOwner_)throw"Initial state owner is unknown, even though an initial state exists for: "+c;d.broadcast(this.initialStateOwner_,null);return true}this.projectBinder(a).onTransition(null,this.state_);return false};
rhizo.state.MasterOverlord.prototype.detachProject=function(a){a=a.uuid();if(a in this.projectOverlords_){this.projectOverlords_[a].removeAllBindings();delete this.projectOverlords_[a]}a in this.state_.uuids&&delete this.state_.uuids[a]};rhizo.state.MasterOverlord.prototype.projectOverlord=function(a){return this.projectOverlords_[a.uuid()]};rhizo.state.MasterOverlord.prototype.projectBinder=function(a){return this.projectOverlords_[a.uuid()].getProjectBinder()};
rhizo.state.MasterOverlord.prototype.state=function(){return this.state_};rhizo.state.MasterOverlord.prototype.setState=function(a){this.state_=a};rhizo.state.MasterOverlord.prototype.setInitialState=function(a,b,c){if(!c){var d=0;for(var e in this.state_.uuids)d++;if(d>0)return}this.initialStateOwner_=a;this.setState(b);for(e in this.state_.uuids)e in this.projectOverlords_&&this.projectOverlords_[e].broadcast(a,null,c)};
rhizo.state.MasterOverlord.prototype.pushDelta=function(a){this.state_.delta=a;a.uuid in this.state_.uuids||(this.state_.uuids[a.uuid]={});this.state_.uuids[a.uuid][a.facet]=a.facetState};
rhizo.state.ProjectOverlord=function(a,b,c){this.master_=a;this.uuid_=b.uuid();this.bindings_={};c.push(rhizo.state.Bindings.PROJECT);for(var d=0;d<c.length;d++){var e=c[d];switch(e){case rhizo.state.Bindings.PROJECT:a=new rhizo.state.ProjectStateBinder(this,b);this.bindings_[e]=a;break;case rhizo.state.Bindings.HISTORY:if(rhizo.state.getHistoryHelper()){a=new rhizo.state.HistoryStateBinder(this);this.bindings_[e]=a}break;default:throw"Unknown binding: "+e;}}};
rhizo.state.ProjectOverlord.prototype.getProjectBinder=function(){return this.bindings_[rhizo.state.Bindings.PROJECT]};rhizo.state.ProjectOverlord.prototype.uuid=function(){return this.uuid_};rhizo.state.ProjectOverlord.prototype.master=function(){return this.master_};rhizo.state.ProjectOverlord.prototype.addBinding=function(a){a.key()in this.bindings_||(this.bindings_[a.key()]=a);this.uuid_ in this.master_.state().uuids&&a.onTransition(null,this.master_.state())};
rhizo.state.ProjectOverlord.prototype.removeBinding=function(a){var b=this.bindings_[a];b.onRemove();delete this.bindings_[a];return b};rhizo.state.ProjectOverlord.prototype.removeAllBindings=function(){for(var a in this.bindings_)this.removeBinding(a)};rhizo.state.ProjectOverlord.prototype.transition=function(a,b,c,d){c?this.master_.setState(c):this.master_.pushDelta(b);this.broadcast(a,b,d)};
rhizo.state.ProjectOverlord.prototype.broadcast=function(a,b,c){for(var d in this.bindings_)d!=a&&this.bindings_[d].onTransition(b,this.master_.state(),c)};rhizo.state.StateBinder=function(a,b){this.overlord_=a;this.binderKey_=b};rhizo.state.StateBinder.prototype.key=function(){return this.binderKey_};rhizo.state.StateBinder.prototype.onTransition=function(){throw"Unimplemented StateBinder.onTransition";};
rhizo.state.StateBinder.prototype.makeDelta=function(a,b){return{ts:(new Date).getTime(),uuid:this.overlord_.uuid(),facet:a,facetState:b}};rhizo.state.StateBinder.prototype.onRemove=function(){};
rhizo.state.ProjectStateBinder=function(a,b){rhizo.state.StateBinder.call(this,a,rhizo.state.Bindings.PROJECT);this.project_=b;this.removed_=false;this.project_.eventBus().subscribe("layout",this.onLayout_,this,true);this.project_.eventBus().subscribe("selection",this.onSelection_,this,true);this.project_.eventBus().subscribe("filter",this.onFilter_,this,true)};rhizo.inherits(rhizo.state.ProjectStateBinder,rhizo.state.StateBinder);
rhizo.state.ProjectStateBinder.prototype.onRemove=function(){this.project_.eventBus().unsubscribe("layout",this);this.project_.eventBus().unsubscribe("selection",this);this.project_.eventBus().unsubscribe("filter",this);this.removed_=true};rhizo.state.ProjectStateBinder.prototype.onTransition=function(a,b){if(this.removed_)throw"ProjectStateBinder received a transition after being removed from overlord.";a?this.pushDeltaChange_(a):this.pushFullState_(b)};
rhizo.state.ProjectStateBinder.prototype.pushDeltaChange_=function(a){this.project_.logger().debug("Received delta state change to push: ",a);var b=a.facet;a=a.facetState;if(b==rhizo.state.Facets.LAYOUT)this.pushLayoutChange_(a);else if(b==rhizo.state.Facets.SELECTION_FILTER)this.pushSelectionChange_(a);else if(b==rhizo.state.Facets.FILTER)this.pushFilterChange_(a);else throw"Invalid facet: "+b;};
rhizo.state.ProjectStateBinder.prototype.pushFullState_=function(a){this.project_.logger().debug("Received full state change to push: ",a);a=a.uuids[this.overlord_.uuid()]||{};this.pushFilterChange_(a[rhizo.state.Facets.FILTER]);this.pushSelectionChange_(a[rhizo.state.Facets.SELECTION_FILTER]);this.pushLayoutChange_(a[rhizo.state.Facets.LAYOUT],true)};
rhizo.state.ProjectStateBinder.prototype.pushLayoutChange_=function(a,b){var c={engine:a?a.engine:null,state:a?a.state:null,positions:a?a.positions:null};if(b)c.options={forcealign:true};this.project_.eventBus().publish("layout",c,null,this)};
rhizo.state.ProjectStateBinder.prototype.onLayout_=function(a){if(this.removed_)throw"ProjectStateBinder cannot issue transitions after removal from overlord";var b={engine:a.engine,state:a.state},c=!!a.positions&&this.curLayoutHasPositions_();if(a.positions)b.positions=this.mergePositions_(a.positions);a=this.makeDelta(rhizo.state.Facets.LAYOUT,b);this.overlord_.transition(this.key(),a,null,c)};
rhizo.state.ProjectStateBinder.prototype.curLayoutHasPositions_=function(){var a=this.overlord_.master().state(),b=this.overlord_.uuid();return b in a.uuids&&rhizo.state.Facets.LAYOUT in a.uuids[b]&&!!a.uuids[b][rhizo.state.Facets.LAYOUT].positions};
rhizo.state.ProjectStateBinder.prototype.mergePositions_=function(a){for(var b={},c=a.length-1;c>=0;c--)b[a[c].id]=true;if(this.curLayoutHasPositions_()){var d=this.overlord_.master().state().uuids[this.overlord_.uuid()][rhizo.state.Facets.LAYOUT].positions||[];for(c=d.length-1;c>=0;c--)d[c].id in b||a.push(d[c])}return a};
rhizo.state.ProjectStateBinder.prototype.pushSelectionChange_=function(a){a=a||[];a.length==0?this.project_.eventBus().publish("selection",{action:"resetFocus"},null,this):this.project_.eventBus().publish("selection",{action:"hide",models:a,incremental:false},null,this)};
rhizo.state.ProjectStateBinder.prototype.onSelection_=function(a){if(this.removed_)throw"ProjectStateBinder cannot issue transitions after removal from overlord";if(!(a.action!="focus"&&a.action!="resetFocus"&&a.action!="hide")){a=[];for(var b in this.project_.selectionManager().allHidden())a.push(b);b=this.makeDelta(rhizo.state.Facets.SELECTION_FILTER,a);this.overlord_.transition(this.key(),b)}};
rhizo.state.ProjectStateBinder.prototype.pushFilterChange_=function(a){this.project_.eventBus().publish("filter",this.project_.filterManager().filterDiff(a||{}),null,this)};rhizo.state.ProjectStateBinder.prototype.onFilter_=function(){if(this.removed_)throw"ProjectStateBinder cannot issue transitions after removal from overlord";var a=this.makeDelta(rhizo.state.Facets.FILTER,this.project_.filterManager().getFilters());this.overlord_.transition(this.key(),a)};
rhizo.state.HistoryStateBinder=function(a){rhizo.state.StateBinder.call(this,a,rhizo.state.Bindings.HISTORY);rhizo.state.getHistoryHelper().addListener(this.overlord_.uuid(),jQuery.proxy(function(b,c){this.overlord_.transition(this.key(),b,c)},this))};rhizo.inherits(rhizo.state.HistoryStateBinder,rhizo.state.StateBinder);rhizo.state.HistoryStateBinder.prototype.onTransition=function(a,b,c){rhizo.state.getHistoryHelper().sync(b,c)};rhizo.state.HistoryStateBinder.prototype.onRemove=function(){rhizo.state.getHistoryHelper().removeListener(this.overlord_.uuid())};
rhizo.state.HistoryHelper=function(a,b){this.master_=a;this.logger_=b;this.listeners_={};this.initialStateReceived_=false;$(window).bind("popstate",jQuery.proxy(this.historyChange_,this))};rhizo.state.HistoryHelper.prototype.addListener=function(a,b){this.listeners_[a]=b};rhizo.state.HistoryHelper.prototype.removeListener=function(a){a in this.listeners_&&delete this.listeners_[a]};
rhizo.state.HistoryHelper.prototype.sync=function(a,b){this.logger_.debug("Pushing history state, replace=",!!b);this.initialStateReceived_=true;b?window.history.replaceState(a,""):window.history.pushState(a,"")};
rhizo.state.HistoryHelper.prototype.historyChange_=function(a){this.logger_.debug("History popstate event: ",a.originalEvent.state);if(this.initialStateReceived_){var b=a.originalEvent.state;if(b){if(!this.isRhizoState_(b))return;if(this.master_.state().delta.ts==b.delta.ts)return;a=this.diff_(this.master_.state(),b)}else a={ts:(new Date).getTime(),uuid:this.master_.state().delta.uuid,facet:this.master_.state().delta.facet,facetState:null};this.logger_.debug("Delta change extracted from history: ",
a);if(a.uuid in this.listeners_)this.listeners_[a.uuid](a,b);else b?this.master_.setState(b):this.master_.pushDelta(a)}else{this.logger_.debug("History event is initial.");this.initialStateReceived_=true;if(a=a.originalEvent.state)this.isRhizoState_(a)&&this.master_.setInitialState(rhizo.state.Bindings.HISTORY,a);else this.logger_.debug("Initial history event is null.")}};rhizo.state.HistoryHelper.prototype.isRhizoState_=function(a){return a.type==rhizo.state.TYPE};
rhizo.state.HistoryHelper.prototype.diff_=function(a,b){if(b.delta.ts>a.delta.ts)return b.delta;else{var c=a.delta.facet,d=a.delta.uuid;return d in b.uuids&&c in b.uuids[d]?{ts:b.delta.ts,uuid:d,facet:c,facetState:b.uuids[d][c]}:{ts:b.delta.ts,uuid:d,facet:c,facetState:null}}};rhizo.state.overlord_=new rhizo.state.MasterOverlord;rhizo.state.getMasterOverlord=function(){return rhizo.state.overlord_};rhizosphereHistoryLogLevel=window.rhizosphereHistoryLogLevel||"error";rhizo.state.history_=null;
if(window.history&&typeof window.history.pushState=="function"){var logger=rhizo.log.newLogger(null,new rhizo.Options({logLevel:rhizosphereHistoryLogLevel}));rhizo.state.history_=new rhizo.state.HistoryHelper(rhizo.state.getMasterOverlord(),logger)}rhizo.state.getHistoryHelper=function(){return rhizo.state.history_};namespace("rhizo.ui.meta");rhizo.ui.meta.labelWrap=function(a,b,c){return $("<div class='rhizo-filter' />").append(a.metaModel()[b].label+": ").append($(c))};
rhizo.ui.meta.FilterUi=function(a,b){this.ui_controls_=null;this.project_=a;this.metaModelKey_=b;this.project_.eventBus().subscribe("filter",this.onFilter_,this);this.project_.eventBus().subscribe("model",this.onModelChange_,this,true)};rhizo.ui.meta.FilterUi.prototype.filterUIControls=function(){if(!this.ui_controls_){this.ui_controls_=this.renderControls();this.setFilterValue(this.project_.filterManager().getFilterValue(this.metaModelKey_))}return this.ui_controls_};
rhizo.ui.meta.FilterUi.prototype.onFilter_=function(a){this.metaModelKey_ in a&&this.ui_controls_&&this.setFilterValue(a[this.metaModelKey_])};rhizo.ui.meta.FilterUi.prototype.doFilter=function(a){var b={};b[this.metaModelKey_]=a;this.project_.eventBus().publish("filter",b,null,this)};rhizo.ui.meta.FilterUi.prototype.setFilterValue=function(){};rhizo.ui.meta.FilterUi.prototype.renderControls=function(){return null};
rhizo.ui.meta.FilterUi.prototype.onModelChange_=function(a){this.modelsChanged(a.action=="remove",a.models,this.project_.models());this.setFilterValue(this.project_.filterManager().getFilterValue(this.metaModelKey_))};rhizo.ui.meta.FilterUi.prototype.modelsChanged=function(){};rhizo.ui.meta.TextKindUi=function(a,b){this.input_=null;rhizo.ui.meta.FilterUi.call(this,a,b)};rhizo.inherits(rhizo.ui.meta.TextKindUi,rhizo.ui.meta.FilterUi);
rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.STRING,rhizo.ui.meta.TextKindUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.NUMBER,rhizo.ui.meta.TextKindUi);rhizo.ui.meta.TextKindUi.prototype.renderControls=function(){this.input_=$("<input type='text' />");$(this.input_).change(jQuery.proxy(function(){this.doFilter($(this.input_).val().length>0?$(this.input_).val():null)},this));return rhizo.ui.meta.labelWrap(this.project_,this.metaModelKey_,this.input_)};
rhizo.ui.meta.TextKindUi.prototype.setFilterValue=function(a){this.input_.val(a||"")};rhizo.ui.meta.DateKindUi=function(a,b){this.monthMap_=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];this.yearRange_=this.fixedYearRange_=this.day_=this.month_=this.year_=null;rhizo.ui.meta.FilterUi.call(this,a,b)};rhizo.inherits(rhizo.ui.meta.DateKindUi,rhizo.ui.meta.FilterUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.DATE,rhizo.ui.meta.DateKindUi);
rhizo.ui.meta.DateKindUi.prototype.renderControls=function(){this.extractFixedYearRange_();this.year_=$("<select style='vertical-align:top' />");this.updateYearRanges_();this.month_=$("<select style='vertical-align:top' />");this.month_.append("<option value='mm'>mm</option>");for(i=0;i<this.monthMap_.length;i++)this.month_.append("<option value='"+i+"'>"+this.monthMap_[i]+"</option>");this.day_=$("<select style='vertical-align:top' />");this.day_.append("<option value='dd'>dd</option>");for(i=1;i<=
31;i++)this.day_.append("<option value='"+i+"'>"+i+"</option>");$(this.year_).add($(this.month_)).add($(this.day_)).change(jQuery.proxy(function(){$(this.year_).find('option[disabled="disabled"]').remove();var a=$(this.year_).val(),b=$(this.month_).val(),c=$(this.day_).val();a=="yyyy"&&b=="mm"&&c=="dd"?this.doFilter(null):this.doFilter([a!="yyyy"?a:undefined,b!="mm"?b:undefined,c!="dd"?c:undefined])},this));return rhizo.ui.meta.labelWrap(this.project_,this.metaModelKey_,$(this.year_).add($(this.month_)).add($(this.day_)))};
rhizo.ui.meta.DateKindUi.prototype.setFilterValue=function(a){a=a||[undefined,undefined,undefined];$(this.year_).find('option[disabled="disabled"]').remove();if(a[0]&&(!this.yearRange_||a[0]<this.yearRange_.min||a[0]>this.yearRange_.max))this.createYearOptions_(a[0],null,true,!this.yearRange_||a[0]<this.yearRange_.min);this.year_.val(a[0]||"yyyy");this.month_.val(a[1]||"mm");this.day_.val(a[2]||"dd")};
rhizo.ui.meta.DateKindUi.prototype.extractFixedYearRange_=function(){var a=this.project_.metaModel()[this.metaModelKey_];if(typeof a.minYear!="undefined"&&a.minYear!=null&&typeof a.maxYear!="undefined"&&a.maxYear!=null)this.yearRange_=this.fixedYearRange_={min:parseInt(a.minYear,10),max:parseInt(a.maxYear,10)}};
rhizo.ui.meta.DateKindUi.prototype.updateYearRanges_=function(){this.year_.children().remove();this.year_.append("<option value='yyyy'>yyyy</option>");this.yearRange_&&this.createYearOptions_(this.yearRange_.min,this.yearRange_.max)};rhizo.ui.meta.DateKindUi.prototype.createYearOptions_=function(a,b,c,d){b=typeof b=="number"?b:a;for(a=a;a<=b;a++){var e='<option value="'+a+'" '+(c?'disabled="disabled"':"")+">"+a+"</option>";d?this.year_.children(":first").after(e):this.year_.append(e)}};
rhizo.ui.meta.DateKindUi.prototype.modelsChanged=function(a,b,c){if(!this.fixedYearRange_){if(c.length==0)this.yearRange_=null;else{a=Number.POSITIVE_INFINITY;b=Number.NEGATIVE_INFINITY;for(var d=c.length-1;d>=0;d--){var e=c[d].unwrap()[this.metaModelKey_];if(e){a=Math.min(a,e.getFullYear());b=Math.max(b,e.getFullYear())}}this.yearRange_={min:a,max:b}}this.updateYearRanges_()}};
rhizo.ui.meta.RangeKindUi=function(a,b){this.steps_=this.stepping_=this.rangeFilterScale_=this.range_=this.fixedRange_=this.maxLabel_=this.minLabel_=this.slider_=null;rhizo.ui.meta.FilterUi.call(this,a,b)};rhizo.inherits(rhizo.ui.meta.RangeKindUi,rhizo.ui.meta.FilterUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.RANGE,rhizo.ui.meta.RangeKindUi);
rhizo.ui.meta.RangeKindUi.prototype.renderControls=function(){this.extractMetamodelOptions_();this.minLabel_=$("<span />",{"class":"rhizo-slider-label"});this.maxLabel_=$("<span />",{"class":"rhizo-slider-label"});this.slider_=$("<div class='rhizo-slider' />").slider({stepping:this.stepping_?this.toFilterScale(this.stepping_):null,steps:this.steps_,range:true,values:[0,100],slide:jQuery.proxy(this.onSlide_,this),stop:jQuery.proxy(this.onStopSlide_,this),orientation:"horizontal"});this.updateRange_();
return rhizo.ui.meta.labelWrap(this.project_,this.metaModelKey_,$(this.minLabel_).add($("<span> to </span>")).add($(this.maxLabel_)).add($(this.slider_)))};
rhizo.ui.meta.RangeKindUi.prototype.extractMetamodelOptions_=function(){var a=this.project_.metaModel()[this.metaModelKey_];if(typeof a.min!="undefined"&&a.min!=null&&typeof a.max!="undefined"&&a.max!=null){this.range_=this.fixedRange_={min:parseFloat(a.min),max:parseFloat(a.max)};this.rangeFilterScale_={min:this.toFilterScale(this.range_.min),max:this.toFilterScale(this.range_.max)}}this.stepping_=a.stepping;this.steps_=a.steps};
rhizo.ui.meta.RangeKindUi.prototype.updateRange_=function(){this.slider_.slider("option",{min:this.rangeFilterScale_?this.rangeFilterScale_.min:0,max:this.rangeFilterScale_?this.rangeFilterScale_.max:100}).slider(this.rangeFilterScale_?"enable":"disable")};
rhizo.ui.meta.RangeKindUi.prototype.onSlide_=function(a,b){if(b.values[0]!=this.rangeFilterScale_.min){this.minLabel_.text(this.toHumanLabel(this.toModelScale(b.values[0]))).addClass("rhizo-slider-moving");this.maxLabel_.removeClass("rhizo-slider-moving")}if(b.values[1]!=this.rangeFilterScale_.max){this.maxLabel_.text(this.toHumanLabel(this.toModelScale(b.values[1]))).addClass("rhizo-slider-moving");this.minLabel_.removeClass("rhizo-slider-moving")}};
rhizo.ui.meta.RangeKindUi.prototype.onStopSlide_=function(a,b){var c=Math.max(this.toModelScale(b.values[0]),this.range_.min),d=Math.min(this.toModelScale(b.values[1]),this.range_.max);this.minLabel_.text(this.toHumanLabel(c)).removeClass("rhizo-slider-moving");this.maxLabel_.text(this.toHumanLabel(d)).removeClass("rhizo-slider-moving");c!=this.range_.min||d!=this.range_.max?this.doFilter({min:c,max:d}):this.doFilter(null)};
rhizo.ui.meta.RangeKindUi.prototype.modelsChanged=function(a,b,c){if(!this.fixedRange_){if(c.length==0)this.rangeFilterScale_=this.range_=null;else{a=Number.POSITIVE_INFINITY;b=Number.NEGATIVE_INFINITY;for(var d=c.length-1;d>=0;d--){var e=parseFloat(c[d].unwrap()[this.metaModelKey_]);if(!isNaN(e)){a=Math.min(a,e);b=Math.max(b,e)}}if(a==Number.POSITIVE_INFINITY||b==Number.NEGATIVE_INFINITY)this.rangeFilterScale_=this.range_=null;else{this.range_={min:a,max:b};this.rangeFilterScale_={min:this.toFilterScale(this.range_.min),
max:this.toFilterScale(this.range_.max)}}}this.updateRange_()}};rhizo.ui.meta.RangeKindUi.prototype.setFilterValue=function(a){if(this.range_){a={min:a?this.clamp_(a.min):this.range_.min,max:a?this.clamp_(a.max):this.range_.max};this.minLabel_.text(this.toHumanLabel(a.min));this.maxLabel_.text(this.toHumanLabel(a.max));this.slider_.slider("values",[this.toFilterScale(a.min),this.toFilterScale(a.max)])}else this.minLabel_.add(this.maxLabel_).text("-")};
rhizo.ui.meta.RangeKindUi.prototype.toModelScale=function(a){var b=this.project_.metaModel()[this.metaModelKey_].kind;if(b.toModelScale)return b.toModelScale(a);return a};rhizo.ui.meta.RangeKindUi.prototype.toFilterScale=function(a){var b=this.project_.metaModel()[this.metaModelKey_].kind;if(b.toUserScale)return b.toUserScale(a);return a};
rhizo.ui.meta.RangeKindUi.prototype.toHumanLabel=function(a){var b=this.project_.metaModel()[this.metaModelKey_];if(typeof b.toHumanLabel=="function")return b.toHumanLabel.call(b,a);return a};rhizo.ui.meta.RangeKindUi.prototype.clamp_=function(a){return Math.max(this.range_.min,Math.min(this.range_.max,a))};rhizo.ui.meta.BooleanKindUi=function(a,b){this.check_=null;rhizo.ui.meta.FilterUi.call(this,a,b)};rhizo.inherits(rhizo.ui.meta.BooleanKindUi,rhizo.ui.meta.FilterUi);
rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.BOOLEAN,rhizo.ui.meta.BooleanKindUi);
rhizo.ui.meta.BooleanKindUi.prototype.renderControls=function(){this.check_=$("<select />");this.check_.append("<option value=''>-</option>");this.check_.append("<option value='true'>Yes</option>");this.check_.append("<option value='false'>No</option>");$(this.check_).change(jQuery.proxy(function(){this.doFilter($(this.check_).val().length>0?$(this.check_).val()=="true":null)},this));return rhizo.ui.meta.labelWrap(this.project_,this.metaModelKey_,this.check_)};
rhizo.ui.meta.BooleanKindUi.prototype.setFilterValue=function(a){this.check_.val(a==null?"":a?"true":"false")};rhizo.ui.meta.CategoryKindUi=function(a,b){this.categoryPicker_=null;this.multiple_=false;this.fixedCategories_=null;this.categories_={};rhizo.ui.meta.FilterUi.call(this,a,b)};rhizo.inherits(rhizo.ui.meta.CategoryKindUi,rhizo.ui.meta.FilterUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.CATEGORY,rhizo.ui.meta.CategoryKindUi);
rhizo.ui.meta.CategoryKindUi.prototype.renderControls=function(){this.extractMetamodelOptions_();this.categoryPicker_=$("<select "+(this.multiple_?'multiple size="4" ':"")+" style='vertical-align:top' />");this.updateCategories_();$(this.categoryPicker_).change(jQuery.proxy(function(){$(this.categoryPicker_).find('option[disabled="disabled"]').remove();var a=[];if(this.multiple_)a=$.grep($(this.categoryPicker_).val(),function(b){return b!=""});else if($(this.categoryPicker_).val().length>0)a=[$(this.categoryPicker_).val()];
if(a.length==0)a=null;this.doFilter(a)},this));return rhizo.ui.meta.labelWrap(this.project_,this.metaModelKey_,this.categoryPicker_)};rhizo.ui.meta.CategoryKindUi.prototype.extractMetamodelOptions_=function(){var a=this.project_.metaModel()[this.metaModelKey_];if(this.fixedCategories_=a.categories||null)for(var b=this.fixedCategories_.length-1;b>=0;b--)this.categories_[this.fixedCategories_[b]]=true;this.multiple_=!!a.multiple};
rhizo.ui.meta.CategoryKindUi.prototype.updateCategories_=function(){this.categoryPicker_.children().remove();this.categoryPicker_.append("<option value=''>-</option>");var a=[];for(var b in this.categories_)a.push(b);a.sort();for(b=0;b<a.length;b++)this.categoryPicker_.append("<option value='"+a[b]+"'>"+a[b]+"</option>")};
rhizo.ui.meta.CategoryKindUi.prototype.setFilterValue=function(a){this.categoryPicker_.find('option[disabled="disabled"]').remove();if(a)for(var b=$.isArray(a)?a:[a],c=b.length-1;c>=0;c--)b[c]in this.categories_||this.categoryPicker_.append("<option value='"+b[c]+"' disabled='disabled'>"+b[c]+"</option>");this.categoryPicker_.val(a||(this.multiple_?[]:""))};
rhizo.ui.meta.CategoryKindUi.prototype.modelsChanged=function(a,b,c){if(!this.fixedCategories_){this.categories_={};if(c.length!=0)for(a=c.length-1;a>=0;a--)if(b=c[a].unwrap()[this.metaModelKey_]){$.isArray(b)||(b=[b]);for(var d=b.length-1;d>=0;d--)this.categories_[b[d]]=true}this.updateCategories_()}};namespace("rhizo.model");rhizo.model.SuperModel=function(a){this.model=a;this.id=a.id;this.filters_={};this.rendering_=null;this.pinned_=this.selected_=false};
rhizo.model.SuperModel.prototype.setRendering=function(a){this.rendering_=a};rhizo.model.SuperModel.prototype.rendering=function(){return this.rendering_};rhizo.model.SuperModel.prototype.unwrap=function(){return this.model};rhizo.model.SuperModel.prototype.destroy=function(){if(this.rendering_){this.rendering_.destroy();this.rendering_=null}};rhizo.model.SuperModel.prototype.isDirtyVisibility=function(){return!this.isFiltered()&&(this.rendering_==null||this.rendering_.visibility==rhizo.ui.Visibility.HIDDEN)};
rhizo.model.SuperModel.prototype.isAvailableForLayout=function(){return!this.isFiltered()&&!this.isPinned()};rhizo.model.SuperModel.prototype.setSelected=function(a){this.selected_=!!a;this.rendering_.setSelected(this.selected_)};rhizo.model.SuperModel.prototype.pin=function(){this.pinned_=true};rhizo.model.SuperModel.prototype.unpin=function(){this.pinned_=false};rhizo.model.SuperModel.prototype.isPinned=function(){return this.pinned_};rhizo.model.SuperModel.prototype.toString=function(){return this.model.toString()};
rhizo.model.SuperModel.prototype.isFiltered=function(a){if(a)return this.filters_[a]||false;else{for(var b in this.filters_)return true;return false}};rhizo.model.SuperModel.prototype.filter=function(a){if(a in this.filters_)return false;else return this.filters_[a]=true};rhizo.model.SuperModel.prototype.resetFilter=function(a){if(a in this.filters_){delete this.filters_[a];return true}else return false};rhizo.model.SuperModel.prototype.modelChanged=function(){this.rendering_.modelChanged()};namespace("rhizo.meta");
rhizo.meta.FilterManager=function(a){this.filters_={};this.filterAutocommit_=true;this.project_=a;this.project_.eventBus().addPreprocessor("filter",this.onBeforeFilter_,this,true);this.project_.eventBus().subscribe("filter",this.onFilter_,this)};rhizo.meta.FilterManager.prototype.getFilters=function(){return $.extend({},this.filters_)};rhizo.meta.FilterManager.prototype.getFilterValue=function(a){return this.filters_[a]||null};
rhizo.meta.FilterManager.prototype.enableFilterAutocommit=function(a){if(this.filterAutocommit_=a){a=this.project_.models();for(var b=a.length-1;b>=0;b--)if(a[b].rendering().visibility==rhizo.ui.Visibility.GREY){this.commitFilter();break}}};rhizo.meta.FilterManager.prototype.isFilterAutocommit=function(){return this.filterAutocommit_};rhizo.meta.FilterManager.prototype.commitFilter=function(){this.project_.layoutManager().forceLayout({filter:true})};
rhizo.meta.FilterManager.prototype.filterDiff=function(a){a=$.extend({},a);for(var b in this.filters_)b in a||(a[b]=null);return a};rhizo.meta.FilterManager.prototype.removeFilterFromModels=function(a){for(var b=this.project_.models(),c=false,d=b.length-1;d>=0;d--)c=b[d].resetFilter(a)||c;return c};rhizo.meta.FilterManager.prototype.applyAllFiltersToModel=function(a){var b=false;for(var c in this.filters_)b=this.filterModelOnKey_(c,this.filters_[c],a)||b;return b};
rhizo.meta.FilterManager.prototype.alignVisibility=function(a){this.project_.logger().time("FilterManager::alignVisibility");var b=rhizo.ui.Visibility;a=a||b.HIDDEN;for(var c=false,d=[],e=[],f=this.project_.models(),g=f.length-1;g>=0;g--){var h=f[g],j=h.rendering();if(h.isFiltered()){if(j.visibility>a){d.push(h);j.visibility=a}}else if(j.visibility<b.VISIBLE){c=c||j.visibility==b.HIDDEN;e.push(h);j.visibility=b.VISIBLE}}f=this.project_.options().panningMode()=="native"&&a==b.HIDDEN;rhizo.ui.fadeAllRenderingsTo(d,
a,f);rhizo.ui.fadeAllRenderingsTo(e,b.VISIBLE);this.project_.logger().timeEnd("FilterManager::alignVisibility");this.project_.logger().debug(d.length+e.length+" models changed visibility");this.project_.logger().debug("Dirty layout after alignVisibility");return c};rhizo.meta.FilterManager.prototype.onBeforeFilter_=function(a,b){for(var c in a)c in this.project_.metaModel()||delete a[c];b(true)};
rhizo.meta.FilterManager.prototype.onFilter_=function(a){this.project_.logger().time("FilterManager::onFilter");var b=false;for(var c in a){var d=a[c];b=d!==null&&d!==undefined?this.filterAllModelsOnKey_(c,d)||b:this.resetAllModelsOnKey_(c)||b}if(b){this.project_.alignFx();this.mustLayoutAfterFilter_()?this.commitFilter():this.alignVisibility(rhizo.ui.Visibility.GREY)}this.project_.logger().timeEnd("FilterManager::onFilter")};
rhizo.meta.FilterManager.prototype.filterAllModelsOnKey_=function(a,b){this.filters_[a]=b;for(var c=false,d=this.project_.models(),e=d.length-1;e>=0;e--)c=this.filterModelOnKey_(a,b,d[e])||c;return c};rhizo.meta.FilterManager.prototype.filterModelOnKey_=function(a,b,c){return this.project_.metaModel()[a].kind.survivesFilter(b,c.unwrap()[a])?c.resetFilter(a):c.filter(a)};rhizo.meta.FilterManager.prototype.resetAllModelsOnKey_=function(a){delete this.filters_[a];return this.removeFilterFromModels(a)};
rhizo.meta.FilterManager.prototype.mustLayoutAfterFilter_=function(){if(this.filterAutocommit_)return true;for(var a=this.project_.models(),b=a.length-1;b>=0;b--)if(a[b].isDirtyVisibility())return true;return false};namespace("rhizo.meta");rhizo.meta.Kind=rhizo.meta.Kind||{};rhizo.meta.Kind.DECIMAL="decimal";rhizo.meta.Kind.DECIMALRANGE="decimalRange";rhizo.meta.Kind.LOGARITHMRANGE="logarithmRange";rhizo.meta.Kind.STRINGARRAY="stringArray";
rhizo.meta.DecimalKind=function(a){this.precision_=typeof a.precision=="number"?a.precision:2};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.DECIMAL,rhizo.meta.DecimalKind);rhizo.meta.DecimalKind.prototype.survivesFilter=function(a,b){var c=parseFloat(a);return isNaN(c)?true:c.toFixed(this.precision_)==b.toFixed(this.precision_)};rhizo.meta.DecimalKind.prototype.compare=function(a,b){return parseFloat(a)-parseFloat(b)};
rhizo.meta.DecimalKind.prototype.cluster=function(a){a=parseFloat(a.toFixed(this.precision_));var b=rhizo.util.orderOfMagnitude(a);if(isNaN(b))return{key:0,label:(new Number(0)).toFixed(this.precision_)};a=Math.pow(10,b);b=Math.pow(10,b+1);return{key:a,label:rhizo.ui.toHumanLabel(a)+" - "+rhizo.ui.toHumanLabel(b)}};rhizo.meta.DecimalKind.prototype.isNumeric=function(){return true};
rhizo.meta.DecimalRangeKind=function(a){this.precision_=typeof a.precision=="number"?a.precision:2;this.scale_=Math.pow(10,this.precision_)};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.DECIMALRANGE,rhizo.meta.DecimalRangeKind);rhizo.meta.DecimalRangeKind.prototype.survivesFilter=function(a,b){return b>=a.min&&b<=a.max};rhizo.meta.DecimalRangeKind.prototype.compare=rhizo.meta.DecimalKind.prototype.compare;rhizo.meta.DecimalRangeKind.prototype.cluster=rhizo.meta.DecimalKind.prototype.cluster;
rhizo.meta.DecimalRangeKind.prototype.isNumeric=rhizo.meta.DecimalKind.prototype.isNumeric;rhizo.meta.DecimalRangeKind.prototype.toModelScale=function(a){return parseFloat((a/this.scale_).toFixed(this.precision_))};rhizo.meta.DecimalRangeKind.prototype.toUserScale=function(a){return Math.round(a*this.scale_)};rhizo.meta.LogarithmRangeKind=function(a){this.precision_=typeof a.precision=="number"?a.precision:2;this.scale_=Math.pow(10,this.precision_);this.oneplus_=!!a.oneplus};
rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.LOGARITHMRANGE,rhizo.meta.LogarithmRangeKind);rhizo.meta.LogarithmRangeKind.prototype.survivesFilter=function(a,b){return b>=a.min&&b<=a.max};rhizo.meta.LogarithmRangeKind.prototype.compare=rhizo.meta.DecimalKind.prototype.compare;rhizo.meta.LogarithmRangeKind.prototype.cluster=rhizo.meta.DecimalKind.prototype.cluster;rhizo.meta.LogarithmRangeKind.prototype.isNumeric=rhizo.meta.DecimalKind.prototype.isNumeric;
rhizo.meta.LogarithmRangeKind.prototype.toModelScale=function(a){var b=this.oneplus_?-1:0;return parseFloat(Math.pow(10,a/this.scale_).toFixed(this.precision_))+b};rhizo.meta.LogarithmRangeKind.prototype.toUserScale=function(a){a=this.oneplus_?a+1:a;return Math.round(rhizo.util.log10_(a)*this.scale_)};rhizo.meta.StringArrayKind=function(){};rhizo.meta.defaultRegistry.registerKind(rhizo.meta.Kind.STRINGARRAY,rhizo.meta.StringArrayKind);
rhizo.meta.StringArrayKind.prototype.survivesFilter=function(a,b){if(a!="")for(var c=0;c<b.length;c++)if(b[c].toLowerCase().indexOf(a.toLowerCase())!=-1)return true;return false};rhizo.meta.StringArrayKind.prototype.cluster=function(){return{key:"undefined",label:"Clustering unsupported for this datatype."}};rhizo.meta.StringArrayKind.prototype.isNumeric=function(){return false};namespace("rhizo.layout");
rhizo.layout.firstMetamodelKey=function(a,b){for(var c in a.metaModel())if(!b||b(c,a.metaModel()[c]))return c;return null};rhizo.layout.orMatcher=function(){var a=Array.prototype.slice.call(arguments);return function(b,c){for(var d=0;d<a.length;d++)if(a[d](b,c))return true;return false}};rhizo.layout.linkMatcher=function(a,b){return!!b.isLink};rhizo.layout.hierarchyMatcher=function(a,b){return b.kind instanceof rhizo.meta.CategoryKind&&!!b.isHierarchy};rhizo.layout.numericMatcher=function(a,b){return b.kind.isNumeric()};
rhizo.layout.LayoutBox=function(a,b){this.height=this.width=this.right=this.left=this.bottom=this.top=0;this.maxWidth_=$(a).get(0).clientWidth;this.maxHeight_=$(a).get(0).clientHeight;this.computeLayoutBox_(b||{})};rhizo.layout.LayoutBox.prototype.isEmpty=function(){return this.width<=0||this.height<=0};
rhizo.layout.LayoutBox.prototype.computeLayoutBox_=function(a){this.top=this.getAbsoluteDimension_(a.top,this.maxHeight_);if(a.height){this.height=this.getAbsoluteDimension_(a.height,this.maxHeight_);this.bottom=this.maxHeight_-this.top-this.height}else{this.bottom=this.clamp_(this.getAbsoluteDimension_(a.bottom,this.maxHeight_),0,this.maxHeight_-this.top);this.height=this.maxHeight_-this.top-this.bottom}this.left=this.getAbsoluteDimension_(a.left,this.maxWidth_);if(a.width){this.width=this.getAbsoluteDimension_(a.width,
this.maxWidth_);this.right=this.maxWidth_-this.left-this.width}else{this.right=this.clamp_(this.getAbsoluteDimension_(a.right,this.maxWidth_),0,this.maxWidth_-this.left);this.width=this.maxWidth_-this.left-this.right}};rhizo.layout.LayoutBox.prototype.getAbsoluteDimension_=function(a,b){a=a||0;return this.clamp_(Math.round(a*(a<1?b:1)),0,b)};rhizo.layout.LayoutBox.prototype.clamp_=function(a,b,c){return Math.min(c,Math.max(b,a))};
rhizo.layout.newTreeifier=function(a,b){return rhizo.layout.linkMatcher(a,b)?new rhizo.layout.LinkTreeifier(a,b.linkKey):rhizo.layout.hierarchyMatcher(a,b)?new rhizo.layout.CategoryTreeifier(a):null};rhizo.layout.CategoryTreeifier=function(a){this.categoryKey_=a};
rhizo.layout.CategoryTreeifier.prototype.buildTree=function(a,b,c){b=new rhizo.layout.TreeNode;for(var d=0,e=a.length;d<e;d++){var f=a[d].unwrap()[this.categoryKey_];$.isArray(f)||(f=[f]);for(var g=b,h=0;h<f.length;h++){var j="__syntethic_id_"+f[h],k=g.childs[j];if(!k){k=new rhizo.layout.SyntheticTreeNode(j,f[h]);g.addChild(k)}g=k}f=new rhizo.layout.ModelTreeNode(a[d]);g.addChild(f);if(c)c[a[d].id]=f}return b};rhizo.layout.LinkTreeifier=function(a,b){this.linkStartKey_=a;this.linkEndKey_=b||"id"};
rhizo.layout.LinkTreeifier.prototype.buildTree=function(a,b,c){var d=b;if(this.linkEndKey_!="id")d=this.buildLinkMap_(b);b=c||{};c=0;for(var e=a.length;c<e;c++)b[a[c].id]=new rhizo.layout.ModelTreeNode(a[c]);var f=new rhizo.layout.TreeNode;c=0;for(e=a.length;c<e;c++)if(!b[a[c].unwrap().id].traversed_)for(var g={},h=a[c].unwrap();;){if(g[h.id])throw new rhizo.layout.TreeCycleException("Tree is invalid: cycle detected");g[h.id]=true;b[h.id].traversed_=true;var j=this.findFirstAvailableParent_(d,d[h[this.linkStartKey_]]);
if(j&&j.id!=h.id){var k=j.unwrap();b[k.id].addChild(b[h.id]);h=j.unwrap()}else{f.addChild(b[h.id]);break}}return f};rhizo.layout.LinkTreeifier.prototype.findFirstAvailableParent_=function(a,b){if(!b)return null;for(var c={};!b.isAvailableForLayout();){if(c[b.id])throw new rhizo.layout.TreeCycleException("Tree is invalid: hidden cycle detected");c[b.id]=true;b=a[b.unwrap()[this.linkStartKey_]];if(!b)return null}return b};
rhizo.layout.LinkTreeifier.prototype.buildLinkMap_=function(a){var b={};for(var c in a){var d=a[c].unwrap();if(this.linkEndKey_ in d){if(d[this.linkEndKey_]in b)throw new rhizo.layout.TreeCycleException("Tree is invalid: multiple models have the same value for the "+this.linkEndKey_+" attribute");b[d[this.linkEndKey_]]=a[c]}}return b};rhizo.layout.TreeNode=function(a,b){this.id=a;this.childs={};this.traversed_=false;this.numChilds=0;this.is_root=this.id==null;this.synthetic_=false;this.payload_=b};
rhizo.layout.TreeNode.prototype.setSynthetic=function(a){this.synthetic_=a};rhizo.layout.TreeNode.prototype.synthetic=function(){return this.synthetic_};rhizo.layout.TreeNode.prototype.payload=function(){return this.payload_};rhizo.layout.TreeNode.prototype.addChild=function(a){if(!this.childs[a.id]){this.childs[a.id]=a;this.numChilds++}};rhizo.layout.TreeNode.prototype.childsAsArray=function(){var a=[];for(var b in this.childs)a.push(this.childs[b]);return a};
rhizo.layout.TreeNode.prototype.deepChildsAsArray=function(a){for(var b in this.childs){a.push(this.childs[b]);this.childs[b].deepChildsAsArray(a)}};rhizo.layout.TreeNode.prototype.renderingDimensions=function(){return{width:0,height:0}};rhizo.layout.ModelTreeNode=function(a){rhizo.layout.TreeNode.call(this,a?a.id:null,a)};rhizo.inherits(rhizo.layout.ModelTreeNode,rhizo.layout.TreeNode);rhizo.layout.ModelTreeNode.prototype.renderingDimensions=function(){return this.payload().rendering().getDimensions()};
rhizo.layout.SyntheticTreeNode=function(a,b){rhizo.layout.TreeNode.call(this,a,b);this.setSynthetic(true);this.syntheticRendering_=null};rhizo.inherits(rhizo.layout.SyntheticTreeNode,rhizo.layout.TreeNode);rhizo.layout.SyntheticTreeNode.prototype.renderingDimensions=function(){return this.syntheticRendering_.getDimensions()};rhizo.layout.SyntheticTreeNode.prototype.setSyntheticRendering=function(a){this.syntheticRendering_=a};rhizo.layout.SyntheticTreeNode.prototype.syntheticRendering=function(){return this.syntheticRendering_};
rhizo.layout.TreeCycleException=function(a){this.message=a;this.name="TreeCycleException"};rhizo.layout.TreeCycleException.prototype.toString=function(){return this.name+": "+this.message};namespace("rhizo.autorender");
rhizo.autorender.AR=function(a,b,c,d){this.metamodel_=a;this.metamodelFields_=0;for(var e in this.metamodel_)this.metamodelFields_++;this.fallbackToDefaults_=!!c;this.locateFields_();a=0;if(this.sizeField_){this.sizeRange_=this.locateMinMax_(b,this.sizeField_);a++}if(this.colorField_){this.colorRange_=this.locateMinMax_(b,this.colorField_);a++}this.numfields_=d===undefined||d===null?5:Math.max(d,a);this.cacheDimensions=true};rhizo.autorender.AR.prototype.getSizeRange=function(){return this.sizeRange_};
rhizo.autorender.AR.prototype.getColorRange=function(){return this.colorRange_};rhizo.autorender.AR.prototype.locateFields_=function(){for(var a in this.metamodel_){this.masterField_=this.masterField_||this.getArField_(a,"master","true");this.sizeField_=this.sizeField_||this.getArField_(a,"bind","size");this.colorField_=this.colorField_||this.getArField_(a,"bind","color")}this.locateDefaultFields_()};
rhizo.autorender.AR.prototype.getArField_=function(a,b,c){if(this.metamodel_[a].ar)if((b=this.metamodel_[a].ar[b])&&b.toString().indexOf(c)!=-1)return a;return null};
rhizo.autorender.AR.prototype.locateDefaultFields_=function(){for(var a in this.metamodel_){if(!this.masterField_)this.masterField_=a;if(!this.fallbackToDefaults_)break;var b=this.metamodel_[a].kind;b=typeof b=="string"?rhizo.meta.defaultRegistry.createNewKind(b,this.metamodel_[a]):b;if(!this.sizeField_&&b.isNumeric())this.sizeField_=a;else if(this.sizeField_)if(!this.colorField_&&b.isNumeric())this.colorField_=a}};
rhizo.autorender.AR.prototype.locateMinMax_=function(a,b){var c=this.metamodel_[b].kind;c=typeof c=="string"?rhizo.meta.defaultRegistry.createNewKind(c,this.metamodel_[b]):c;if(c.isNumeric()&&typeof this.metamodel_[b].min!="undefined"&&typeof this.metamodel_[b].max!="undefined")return{min:this.metamodel_[b].min,max:this.metamodel_[b].max,label:this.metamodel_[b].label};else{var d=Number.POSITIVE_INFINITY,e=Number.NEGATIVE_INFINITY;$.each(a,function(f,g){d=Math.min(d,g[b]);e=Math.max(e,g[b])});return{min:d,
max:e,label:this.metamodel_[b].label}}};rhizo.autorender.AR.prototype.getClass_=function(a,b,c,d){a=parseInt((a-b.min)/(b.max-b.min)*5,10);return"ar-"+d+"-"+a.toString()+(c.small?"m":"")};rhizo.autorender.AR.prototype.getFontClass_=function(a,b,c){return this.getClass_(a,b,c,"fon")};rhizo.autorender.AR.prototype.getColorClass_=function(a,b,c){return this.getClass_(a,b,c,"col")};
rhizo.autorender.AR.prototype.renderSingleModelKey_=function(a,b){var c=[];c.push('<p><span class="rhizo-autorender-label">');c.push(this.metamodel_[a].label);c.push("</span>: ");c.push(b);c.push("</p>");return c.join("")};rhizo.autorender.AR.prototype.expandable=function(a){return this.metamodelFields_>(a.small?1:this.numfields_+1)};
rhizo.autorender.AR.prototype.render=function(a,b,c){var d="ar-col-0"+(c.small?"m":"");if(this.colorField_)d=this.getColorClass_(a[this.colorField_],this.colorRange_,c);var e="ar-fon-0"+(c.small?"m":"");if(this.sizeField_)e=this.getFontClass_(a[this.sizeField_],this.sizeRange_,c);if(c.small&&!b)return $("<div class='rhizo-autorender "+d+"'><span class='"+e+"'>"+a[this.masterField_]+"</span></div>");else{c=[];c.push("<div class='rhizo-autorender "+d+"'>");c.push("<span class='"+e+"'>"+a[this.masterField_]+
"</span>");d=0;if(this.sizeField_){c.push(this.renderSingleModelKey_(this.sizeField_,a[this.sizeField_]));d++}if(this.colorField_&&this.colorField_!=this.sizeField_){c.push(this.renderSingleModelKey_(this.colorField_,a[this.colorField_]));d++}for(var f in this.metamodel_){if(d>=this.numfields_&&!b)break;if(f!=this.sizeField_&&f!=this.colorField_&&f!=this.masterField_){d++;c.push(this.renderSingleModelKey_(f,a[f]))}}c.push("</div>");return $(c.join(""))}};
rhizo.autorender.AR.prototype.changeStyle=function(a,b,c,d){if("backgroundColor"in c)$(b).css("backgroundColor",d?"":c.backgroundColor)};namespace("rhizo.gviz");rhizo.gviz.Rhizosphere=function(a){if(typeof google=="undefined"||typeof google.visualization=="undefined")throw"Google Visualization APIs not available. Please load them first.";this.container_=a;this.project_=null};
rhizo.gviz.Rhizosphere.prototype.draw=function(a,b){this.project_&&this.project_.destroy();var c=new rhizo.Options(b);c.merge({showErrorsInViewport:false});var d=new rhizo.gviz.Initializer(a,rhizo.log.newLogger(null,c),c);if(d.parse()){c=new rhizo.bootstrap.Bootstrap(this.container_,c,jQuery.proxy(this.deployComplete_,this));this.project_=c.prepare().getProject();c.deployExplicit(d.models,d.metamodel,d.renderer)}else{this.project_=null;this.deployComplete_(null,true)}};
rhizo.gviz.Rhizosphere.prototype.deployComplete_=function(a,b,c){if(b)google.visualization.events.trigger(this,"ready",{});else{a=google.visualization.errors.addError(this.container_,c,null,{style:"position: absolute; top: 0; right: 0; z-index: 350"});google.visualization.events.trigger(this,"error",{id:a,message:c})}};rhizo.gviz.Initializer=function(a,b,c){this.dt_=a;this.logger_=b;this.options_=c};
rhizo.gviz.Initializer.prototype.parse=function(){if(this.dt_.getNumberOfRows()==0||this.dt_.getNumberOfColumns()==0)return false;var a=this.getColumnGroupings_();if(this.transformDataTableIfNeeded_(a))a=this.getColumnGroupings_();this.metamodel=this.buildMetaModel_(a);this.models=this.loadModels_(this.metamodel,a);this.renderer=this.options_.renderer()||this.createDefaultRenderer_(this.metamodel,this.models);return true};
rhizo.gviz.Initializer.prototype.getColumnId_=function(a){return this.dt_.getColumnId(a)||"col_"+a};rhizo.gviz.Initializer.prototype.getColumnGroupId_=function(a,b){return this.getColumnId_(a)+"__"+this.getColumnId_(b-1)};rhizo.gviz.Initializer.prototype.getColumnLabel_=function(a){var b=this.dt_.getColumnLabel(a);if(b=="")b="Column "+this.getColumnId_(a);return b};
rhizo.gviz.Initializer.prototype.isParentColumn_=function(a){if(a==0)return false;return!!this.dt_.getColumnProperty(a,"rhizosphereParent")||this.getColumnLabel_(a)=="Parent"+this.getColumnLabel_(a-1)};
rhizo.gviz.Initializer.prototype.getCategoryColumnData_=function(a){var b=this.dt_.getColumnProperty(a,"rhizosphereCategory");if(b)return{multiple:!!b.multiple,hierarchy:!!b.hierarchy};if(this.getColumnLabel_(a).indexOf("CAT")!=-1)return{multiple:this.getColumnLabel_(a).indexOf("MUL")!=-1,hierarchy:this.getColumnLabel_(a).indexOf("HIE")!=-1};return null};rhizo.gviz.Initializer.stripCategoryTokens_=function(a){return a.replace(/CAT|MUL|HIE/g,"").replace(/^\s+|\s+$/g,"")};
rhizo.gviz.Initializer.prototype.getColumnGroupings_=function(){for(var a={},b=this.dt_.getNumberOfColumns(),c=0,d=this.getColumnLabel_(c),e=1;e<b;e++)if(this.getColumnLabel_(e)!=d){if(e>c+1)a[c]=e;c=e;d=this.getColumnLabel_(c)}if(c!=b-1)a[c]=b;return a};
rhizo.gviz.Initializer.prototype.transformDataTableIfNeeded_=function(a){for(var b=0,c=this.dt_.getNumberOfColumns();b<c;)if(b in a){if(this.isValidModelTree_(b,a[b])){this.logger_.debug("Column group starting at "+b+" is a valid model tree. Transforming the datatable.");this.packHierarchy_(b,a[b]);return true}b=a[b]}else{var d=this.getCategoryColumnData_(b);if(d&&d.hierarchy)if(this.isValidModelTree_(b)){this.logger_.debug("Hierarchy column at position "+b+" is a valid model tree. Transforming the datatable.");
this.packHierarchy_(b);return true}b+=1}return false};rhizo.gviz.Initializer.prototype.isValidModelTree_=function(a,b){for(var c={},d={},e=0,f=0,g=this.dt_.getNumberOfRows();f<g;f++)for(var h=d,j=rhizo.gviz.Initializer.getRowCategories_(this.dt_,f,a,b),k=0;k<j.length;k++){var m=j[k];if(!(m in h)){if(m in c)return false;c[m]=true;h[m]={};e++}h=h[m]}return e==this.dt_.getNumberOfRows()};
rhizo.gviz.Initializer.prototype.packHierarchy_=function(a,b){for(var c=new google.visualization.DataView(this.dt_),d=[],e=0;e<a;e++)d.push(e);d.push({type:"string",id:"c("+this.getColumnId_(a)+(b?":"+this.getColumnId_(b-1):"")+")",label:this.dt_.getColumnLabel(a),calc:function(f,g){return rhizo.gviz.Initializer.packFunction_(f,g,a,b,0)}});d.push({type:"string",id:"p("+this.getColumnId_(a)+(b?":"+this.getColumnId_(b-1):"")+")",label:"Parent"+this.dt_.getColumnLabel(a),calc:function(f,g){return rhizo.gviz.Initializer.packFunction_(f,
g,a,b,1)}});for(e=b||a+1;e<this.dt_.getNumberOfColumns();e++)d.push(e);c.setColumns(d);this.dt_=c};rhizo.gviz.Initializer.packFunction_=function(a,b,c,d,e){a=rhizo.gviz.Initializer.getRowCategories_(a,b,c,d);return a.length-1-e<0?null:a[a.length-1-e]};
rhizo.gviz.Initializer.prototype.buildMetaModel_=function(a){for(var b={},c=0,d=this.dt_.getNumberOfColumns();c<d;){var e=null,f=null,g=null,h=null;if(c in a){e=this.getColumnGroupId_(c,a[c]);f=this.buildMetaModelEntry_(e,c,a[c]);c=a[c]}else{e=this.getColumnId_(c);f=this.buildMetaModelEntry_(e,c);c+=1;if(c!=d&&this.isParentColumn_(c)){g=this.getColumnId_(c);h=this.buildMetaModelEntry_(g,c);h.isLink=true;h.linkKey=e;c+=1}}b[e]=f;if(g)b[g]=h}return b};
rhizo.gviz.Initializer.prototype.buildMetaModelEntry_=function(a,b,c){var d={};d.label=this.getColumnLabel_(b);if(c)this.buildMetaModelCategoryEntry_(d,b,c);else{c=this.dt_.getColumnType(b);if(c=="number")this.buildMetaModelNumericEntry_(d,b);else if(c=="boolean")d.kind=rhizo.meta.Kind.BOOLEAN;else{c!="string"&&this.logger_.warn("Column "+d.label+" will be treated as String. Unsupported type: "+c);this.buildMetaModelStringEntry_(d,b)}}this.buildAutoRenderInfo_(a,d);return d};
rhizo.gviz.Initializer.prototype.buildMetaModelStringEntry_=function(a,b){var c=this.getCategoryColumnData_(b);if(c)this.buildMetaModelCategoryEntry_(a,b,null,c);else a.kind=rhizo.meta.Kind.STRING};rhizo.gviz.Initializer.prototype.buildMetaModelNumericEntry_=function(a,b){var c=this.dt_.getColumnRange(b).min,d=this.dt_.getColumnRange(b).max;if(c==d)a.kind=rhizo.meta.Kind.NUMBER;else{a.kind=rhizo.meta.Kind.RANGE;a.min=c;a.max=d}};
rhizo.gviz.Initializer.prototype.buildMetaModelCategoryEntry_=function(a,b,c,d){a.kind=rhizo.meta.Kind.CATEGORY;a.categories=rhizo.gviz.Initializer.getAllCategories_(this.dt_,b,c);a.isHierarchy=c||d&&d.hierarchy;a.multiple=d&&d.multiple;if(d)a.label=rhizo.gviz.Initializer.stripCategoryTokens_(a.label)};
rhizo.gviz.Initializer.getAllCategories_=function(a,b,c){var d=[];if(c)for(var e=0,f=a.getNumberOfRows();e<f;e++)for(var g=b;g<c;g++)d.push(a.getValue(e,g));else{e=0;for(f=a.getNumberOfRows();e<f;e++)Array.prototype.push.apply(d,rhizo.gviz.Initializer.splitCSVCategory_(a.getValue(e,b)))}return rhizo.gviz.Initializer.cleanCategories_(d).sort()};
rhizo.gviz.Initializer.getRowCategories_=function(a,b,c,d){var e=[];if(d)for(c=c;c<d;c++)e.push(a.getValue(b,c));else e=rhizo.gviz.Initializer.splitCSVCategory_(a.getValue(b,c));return rhizo.gviz.Initializer.cleanCategories_(e)};rhizo.gviz.Initializer.splitCSVCategory_=function(a){if(a==null||String(a)=="")return[];return String(a).split(",")};
rhizo.gviz.Initializer.cleanCategories_=function(a){var b=$.grep(a,function(e){return e!=null&&String(e)!=""});a={};for(var c=0;c<b.length;c++)a[String(b[c]).replace(/^\s+|\s+$/g,"")]=true;b=[];for(var d in a)b.push(d);return b};
rhizo.gviz.Initializer.prototype.buildAutoRenderInfo_=function(a,b){var c={},d=false;if(this.options_.autoRenderMasterField()&&this.matchAutoRenderOption_(this.options_.autoRenderMasterField(),b.label,a))d=c.master=true;if(this.options_.autoRenderSizeField()&&this.matchAutoRenderOption_(this.options_.autoRenderSizeField(),b.label,a)){c.bind=(c.bind?c.bind:"")+"size ";d=true}if(this.options_.autoRenderColorField()&&this.matchAutoRenderOption_(this.options_.autoRenderColorField(),b.label,a)){c.bind=
(c.bind?c.bind:"")+"color ";d=true}if(d)b.ar=c};rhizo.gviz.Initializer.prototype.matchAutoRenderOption_=function(a,b,c){a=a.toLowerCase();if(/^[a-z]$/.test(a)){c=String(c).toLowerCase();return c==a||c.indexOf(a+"__")==0||c.indexOf("c("+a+":")==0}else return b.toLowerCase()==a};
rhizo.gviz.Initializer.prototype.loadModels_=function(a,b){for(var c=[],d=0,e=this.dt_.getNumberOfRows();d<e;d++){for(var f={id:"gviz-"+d},g=0,h=this.dt_.getNumberOfColumns();g<h;)if(g in b){f[this.getColumnGroupId_(g,b[g])]=rhizo.gviz.Initializer.getRowCategories_(this.dt_,d,g,b[g]);g=b[g]}else{if(a[this.getColumnId_(g)].kind==rhizo.meta.Kind.CATEGORY)f[this.getColumnId_(g)]=rhizo.gviz.Initializer.getRowCategories_(this.dt_,d,g);else f[this.getColumnId_(g)]=this.dt_.getValue(d,g);g++}c.push(f)}return c};
rhizo.gviz.Initializer.prototype.createDefaultRenderer_=function(a,b){return new rhizo.autorender.AR(a,b,this.options_.autoRenderUseDefaults(),this.options_.autoRenderNumberOfFields())};rhizo.gviz.DebugRenderer=function(a){this.dt_=a};rhizo.gviz.DebugRenderer.prototype.getColumnId_=function(a){return this.dt_.getColumnId(a)||"col_"+a};
rhizo.gviz.DebugRenderer.prototype.render=function(a){for(var b=$("<div />"),c=0,d=this.dt_.getNumberOfColumns();c<d;c++)b.append("<p>"+a[this.getColumnId_(c)]+"</p>");return b};namespace("rhizo.layout");rhizo.layout.StatefulLayout=function(a){this.project_=a;this.state_=this.defaultState_()};rhizo.layout.StatefulLayout.prototype.getState=function(){return this.state_};
rhizo.layout.StatefulLayout.prototype.setState=function(a){if(!a){this.state_=this.defaultState_();return true}if(this.validateState_(a)){this.state_=this.cloneState_(a);return true}else return false};rhizo.layout.StatefulLayout.prototype.defaultState_=function(){return null};rhizo.layout.StatefulLayout.prototype.validateState_=function(){return true};
rhizo.layout.StatefulLayout.prototype.validateStateAttributePresence_=function(a,b){if(!(b in a)){this.project_.logger().error("State must specify a "+b+" attribute");return false}return true};
rhizo.layout.StatefulLayout.prototype.validateMetamodelPresence_=function(a,b){if(!(a in this.project_.metaModel())){this.project_.logger().error(a+" is not part of the metamodel.");return false}if(b&&!b(a,this.project_.metaModel()[a])){this.project_.logger().error(a+" does not match the required constraints");return false}return true};rhizo.layout.StatefulLayout.prototype.cloneState_=function(a){return $.extend({},a)};rhizo.layout.NoLayout=function(){};rhizo.layout.NoLayout.prototype.layout=function(){return false};
rhizo.layout.NoLayout.prototype.toString=function(){return"NoLayout"};rhizo.layout.ScrambleLayout=function(){};rhizo.layout.ScrambleLayout.prototype.layout=function(a,b,c,d,e,f){if(f.filter)return false;d=0;for(e=c.length;d<e;d++)a.move(c[d].id,Math.round(b.height*0.05+Math.random()*0.85*b.height),Math.round(b.width*0.05+Math.random()*0.85*b.width));return false};rhizo.layout.ScrambleLayout.prototype.toString=function(){return"ScrambleLayout"};
rhizo.layout.FlowLayout=function(a,b,c){this.project_=a;this.top=b||5;this.left=c||5;rhizo.layout.StatefulLayout.call(this,a)};rhizo.inherits(rhizo.layout.FlowLayout,rhizo.layout.StatefulLayout);rhizo.layout.FlowLayout.prototype.defaultState_=function(){return{order:rhizo.layout.firstMetamodelKey(this.project_),reverse:false}};rhizo.layout.FlowLayout.prototype.validateState_=function(a){return this.validateStateAttributePresence_(a,"order")&&this.validateMetamodelPresence_(a.order)};
rhizo.layout.FlowLayout.prototype.layout=function(a,b,c,d,e){var f=this.getState().order,g=!!this.getState().reverse;b=b.width;d=0;c.sort(rhizo.meta.sortBy(f,e[f].kind,g));e=0;for(f=c.length;e<f;e++){g=c[e].rendering().getDimensions();d=Math.max(d,g.height);if(this.left+g.width>b){this.left=5;this.top+=d+5;d=g.height}a.move(c[e].id,this.top,this.left);this.left+=g.width+5}this.top+=d;return false};rhizo.layout.FlowLayout.prototype.cleanup=function(){this.top=this.left=5;return false};
rhizo.layout.FlowLayout.prototype.toString=function(){return"FlowLayout"};rhizo.layout.BucketLayout=function(a){this.project_=a;this.internalFlowLayout_=new rhizo.layout.FlowLayout(a);rhizo.layout.StatefulLayout.call(this,a)};rhizo.inherits(rhizo.layout.BucketLayout,rhizo.layout.StatefulLayout);rhizo.layout.BucketLayout.prototype.defaultState_=function(){return{bucketBy:rhizo.layout.firstMetamodelKey(this.project_),reverse:false}};
rhizo.layout.BucketLayout.prototype.validateState_=function(a){return this.validateStateAttributePresence_(a,"bucketBy")&&this.validateMetamodelPresence_(a.bucketBy)};
rhizo.layout.BucketLayout.prototype.layout=function(a,b,c,d,e){var f=!!this.getState().reverse,g=this.getState().bucketBy;this.internalFlowLayout_.setState({order:g,reverse:f});var h,j;if(e[g].cluster){h=e[g].cluster;j=e[g]}else{h=e[g].kind.cluster;j=e[g].kind}for(var k={},m={},n=0,p=c.length;n<p;n++){var l=c[n].unwrap()[g],o=l;if(h){o=h.call(j,l);l=o.key;o=o.label}if(!k[l]){k[l]=[];m[l]=o}k[l].push(c[n])}c=[];for(l in k)c.push(l);c.sort(rhizo.meta.sortByKind(e[g].kind,f));f=false;g=true;for(n=0;n<
c.length;n++){l=c[n];this.renderBucketHeader_(a,m[l],k[l],g);f=this.internalFlowLayout_.layout(a,b,k[l],d,e)||f;this.internalFlowLayout_.top+=10;this.internalFlowLayout_.left=5;g=false}return f};
rhizo.layout.BucketLayout.prototype.renderBucketHeader_=function(a,b,c,d){for(var e=Array(c.length),f=c.length-1;f>=0;f--)e[f]=c[f].id;c=$("<div />",{"class":d?"rhizo-bucket-header rhizo-bucket-first":"rhizo-bucket-header"});c.text(b).css("position","absolute").css("left",5).css("top",this.internalFlowLayout_.top);this.project_.options().isClickSelectionMode()&&c.click(jQuery.proxy(function(){this.project_.eventBus().publish("selection",{action:"toggle",models:e})},this));a.artifact(c);this.internalFlowLayout_.top+=
c.height()+5};rhizo.layout.BucketLayout.prototype.cleanup=function(a){this.internalFlowLayout_.cleanup(a);return false};rhizo.layout.BucketLayout.prototype.toString=function(){return"BucketLayout"};rhizo.layout.layouts={no:{name:"-",engine:rhizo.layout.NoLayout},flow:{name:"List",engine:rhizo.layout.FlowLayout},scramble:{name:"Random",engine:rhizo.layout.ScrambleLayout},bucket:{name:"Buckets",engine:rhizo.layout.BucketLayout}};namespace("rhizo.ui.meta");
rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.DECIMAL,rhizo.ui.meta.TextKindUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.DECIMALRANGE,rhizo.ui.meta.RangeKindUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.LOGARITHMRANGE,rhizo.ui.meta.RangeKindUi);rhizo.meta.defaultRegistry.registerKindUi(rhizo.meta.Kind.STRINGARRAY,rhizo.ui.meta.TextKindUi);namespace("rhizo.model");
rhizo.model.ModelManager=function(a){this.project_=a;this.renderingBootstrap_=new rhizo.ui.RenderingBootstrap(this.project_.renderer(),this.project_.gui(),this.project_);this.modelsMap_={};this.models_=[];this.project_.eventBus().addPreprocessor("model",this.onBeforeModelChange_,this,true);this.project_.eventBus().subscribe("model",this.onModelChange_,this)};rhizo.model.ModelManager.prototype.models=function(){return this.models_};rhizo.model.ModelManager.prototype.modelsMap=function(){return this.modelsMap_};
rhizo.model.ModelManager.prototype.onBeforeModelChange_=function(a,b){var c=[],d=a.models||[];$.isArray(d)||(d=[d]);if(a.action=="remove")c=this.extractSuperModelsToRemove_(d);else{a.action="add";if(!this.createSuperModelsToAdd(d,c,b))return}a.models=c;b(true)};rhizo.model.ModelManager.prototype.extractSuperModelsToRemove_=function(a){for(var b=[],c=a.length-1;c>=0;c--){var d=a[c];if(d.id)d.id in this.modelsMap_&&b.push(this.modelsMap_[d.id]);else d in this.modelsMap_&&b.push(this.modelsMap_[d])}return b};
rhizo.model.ModelManager.prototype.createSuperModelsToAdd=function(a,b,c){for(var d=0;d<a.length;d++){var e=new rhizo.model.SuperModel(a[d]);this.project_.filterManager().applyAllFiltersToModel(e);b.push(e)}return this.checkModels_(b,c)};
rhizo.model.ModelManager.prototype.checkModels_=function(a,b){for(var c={},d=a.length-1;d>=0;d--){var e=a[d].id;if(typeof e=="undefined"){b(false,"Missing models' ids.");return false}else if(e in c||e in this.modelsMap_){b(false,"Verify your models, duplicate id "+e);return false}else c[e]=true}return true};
rhizo.model.ModelManager.prototype.onModelChange_=function(a){this.project_.logger().time("ModelManager::onModelChange");var b=a.models||[];if(b.length>0)if((a.action=="remove"?this.removeModels_(b):this.addModels_(b))&&!(a.options||{}).delayLayout)this.project_.layoutManager().forceLayout();this.project_.logger().debug(this.models_.length+" models in visualization");this.project_.logger().timeEnd("ModelManager::onModelChange")};
rhizo.model.ModelManager.prototype.addModels_=function(a){this.renderingBootstrap_.buildRenderings(a);for(var b=false,c=a.length-1;c>=0;c--){this.modelsMap_[a[c].id]=a[c];this.models_.push(a[c]);b=a[c].isDirtyVisibility()||b}return b};rhizo.model.ModelManager.prototype.removeModels_=function(a){for(var b=false,c=a.length-1;c>=0;c--){a[c].destroy();b=a[c].isDirtyVisibility()||b;delete this.modelsMap_[a[c].id]}this.models_=[];for(var d in this.modelsMap_)this.models_.push(this.modelsMap_[d]);return b};
namespace("rhizo");rhizo.Project=function(a,b){this.metaModelRegistry_=rhizo.meta.defaultRegistry;this.options_=b;this.gui_=a;this.logger_=rhizo.log.newLogger(this,this.options_);this.state_=null;this.eventBus_=new rhizo.eventbus.EventBus(this.logger_);this.modelManager_=null;this.selectionManager_=new rhizo.selection.SelectionManager(this);this.layoutManager_=null;this.filterManager_=new rhizo.meta.FilterManager(this);this.userAgent_=new rhizo.UserAgent(this)};
rhizo.Project.prototype.deploy=function(){var a=this.parseOptions_();if(!a.success)return a;this.modelManager_=new rhizo.model.ModelManager(this);this.layoutManager_=new rhizo.layout.LayoutManager(this);this.layoutManager_.initEngines(rhizo.layout.layouts);a=[];this.options_.isHTML5HistoryEnabled()&&a.push(rhizo.state.Bindings.HISTORY);rhizo.state.getMasterOverlord().attachProject(this,a);this.state_=rhizo.state.getMasterOverlord().projectBinder(this);this.options_.mustLayoutOnResize()&&this.gui_.trackViewportResize(this.layoutManager_);
return{success:true}};rhizo.Project.prototype.parseOptions_=function(){var a=this.parseMetaModel_();if(!a.success)return a;a=this.parseRenderer_();if(!a.success)return a;return{success:true}};
rhizo.Project.prototype.parseMetaModel_=function(){if(!this.options_.metamodel())return{success:false,details:"Missing metaModel specification"};this.metaModel_=$.extend({},this.options_.metamodel(),this.options_.metamodelFragment());var a=[];for(var b in this.metaModel_)if(this.metaModel_[b].kind){if(typeof this.metaModel_[b].kind=="string")this.metaModel_[b].kind=this.metaModelRegistry_.createNewKind(this.metaModel_[b].kind,this.metaModel_[b]);a.push(this.metaModel_[b].kind)}else delete this.metaModel_[b];
for(b=0;b<a.length;b++)for(var c=b+1;c<a.length;c++)if(a[b]===a[c])return{success:false,details:"Verify your metaModel: shared kind instances."};return{success:true}};rhizo.Project.prototype.parseRenderer_=function(){if(!this.options_.renderer())return{success:false,details:"Missing renderer"};this.renderer_=this.options_.renderer();return{success:true}};
rhizo.Project.prototype.destroy=function(){rhizo.state.getMasterOverlord().detachProject(this);if(this.modelManager_)for(var a=this.modelManager_.models(),b=a.length-1;b>=0;b--){var c=a[b].rendering();c&&c.beforeDestroy()}this.gui_.destroy()};rhizo.Project.prototype.uuid=function(){return this.gui_.container.attr("id")};rhizo.Project.prototype.options=function(){return this.options_};rhizo.Project.prototype.model=function(a){return this.modelManager_.modelsMap()[a]};
rhizo.Project.prototype.models=function(){return this.modelManager_.models()};rhizo.Project.prototype.modelsMap=function(){return this.modelManager_.modelsMap()};rhizo.Project.prototype.metaModel=function(){return this.metaModel_};rhizo.Project.prototype.metaModelRegistry=function(){return this.metaModelRegistry_};rhizo.Project.prototype.renderer=function(){return this.renderer_};rhizo.Project.prototype.gui=function(){return this.gui_};rhizo.Project.prototype.logger=function(){return this.logger_};
rhizo.Project.prototype.eventBus=function(){return this.eventBus_};rhizo.Project.prototype.modelManager=function(){return this.modelManager_};rhizo.Project.prototype.layoutManager=function(){return this.layoutManager_};rhizo.Project.prototype.selectionManager=function(){return this.selectionManager_};rhizo.Project.prototype.filterManager=function(){return this.filterManager_};rhizo.Project.prototype.userAgent=function(){return this.userAgent_};
rhizo.Project.prototype.alignFx=function(){for(var a=0,b=0,c=this.modelManager_.models(),d=c.length-1;d>=0;d--){var e=c[d];e.isFiltered()||a++;e.rendering().visibility>=rhizo.ui.Visibility.GREY&&b++}this.gui_.disableFx(!this.options_.areAnimationsEnabled()||a>200||b>200)};rhizo.UserAgent=function(a){this.project_=a;this.listeners_={selection:[],filter:[],layout:[],model:[],error:[]}};rhizo.UserAgent.prototype.getProject=function(){return this.project_};
rhizo.UserAgent.prototype.addSelectionListener=function(a,b){this.subscribe_("selection",a,b)};rhizo.UserAgent.prototype.removeSelectionListener=function(a,b){this.unsubscribe_("selection",a,b)};rhizo.UserAgent.prototype.addFilterListener=function(a,b){this.subscribe_("filter",a,b)};rhizo.UserAgent.prototype.removeFilterListener=function(a,b){this.unsubscribe_("filter",a,b)};rhizo.UserAgent.prototype.addLayoutListener=function(a,b){this.subscribe_("layout",a,b)};
rhizo.UserAgent.prototype.removeLayoutListener=function(a,b){this.unsubscribe_("layout",a,b)};rhizo.UserAgent.prototype.addModelListener=function(a,b){this.subscribe_("model",a,b)};rhizo.UserAgent.prototype.removeModelListener=function(a,b){this.unsubscribe_("model",a,b)};rhizo.UserAgent.prototype.addErrorListener=function(a,b){this.subscribe_("error",a,b)};rhizo.UserAgent.prototype.removeErrorListener=function(a,b){this.unsubscribe_("error",a,b)};
rhizo.UserAgent.prototype.subscribe_=function(a,b,c){var d=this.listeners_[a].length==0;this.listeners_[a].push({listener:c,listenerCallback:b});d&&this.project_.eventBus().subscribe(a,function(e){for(var f=0;f<this.listeners_[a].length;f++){var g=this.listeners_[a][f];g.listenerCallback.call(g.listener,e)}},this,true)};
rhizo.UserAgent.prototype.unsubscribe_=function(a,b,c){var d=[];if(b)for(var e=0;e<this.listeners_[a].length;e++){var f=this.listeners_[a][e];f.listener==b&&(!c||c==f.listenerCallback)||d.push(f)}this.listeners_[a]=d;d.length==0&&this.project_.eventBus().unsubscribe(a,this)};rhizo.UserAgent.prototype.doSelection=function(a,b,c,d){a={action:a};if(b)a.models=b;if(c!==null&&c!=undefined)a.incremental=c;this.project_.eventBus().publish("selection",a,d,this)};
rhizo.UserAgent.prototype.doFilter=function(a,b,c){if(typeof a=="string"){var d={};d[a]=b||null;this.project_.eventBus().publish("filter",d,c||null,this)}else this.project_.eventBus().publish("filter",a,b||null,this)};rhizo.UserAgent.prototype.doResetFilters=function(a){this.project_.eventBus().publish("filter",this.project_.filterManager().filterDiff({}),a,this)};
rhizo.UserAgent.prototype.doLayout=function(a,b,c,d){var e={};if(a)e.engine=a;if(b)e.state=b;if(c)e.positions=c;this.project_.eventBus().publish("layout",e,d,this)};rhizo.UserAgent.prototype.addModels=function(a,b){this.project_.eventBus().publish("model",{action:"add",models:a},b,this)};rhizo.UserAgent.prototype.removeModels=function(a,b){this.project_.eventBus().publish("model",{action:"remove",models:a},b,this)};
rhizo.UserAgent.prototype.addError=function(a,b){this.project_.eventBus().publish("error",{arguments:a},b,this)};rhizo.UserAgent.prototype.clearErrors=function(a){this.project_.eventBus().publish("error",{clear:true},a,this)};namespace("rhizo.layout");rhizo.layout.TreeLayout=function(a){this.project_=a;this.matcher_=rhizo.layout.orMatcher(rhizo.layout.linkMatcher,rhizo.layout.hierarchyMatcher);this.globalNodesMap_=null;rhizo.layout.StatefulLayout.call(this,a)};
rhizo.inherits(rhizo.layout.TreeLayout,rhizo.layout.StatefulLayout);rhizo.layout.TreeLayout.prototype.verifyMetaModel=function(a){for(var b in a)if(this.matcher_(b,a[b]))return true;return false};rhizo.layout.TreeLayout.prototype.defaultState_=function(){return{direction:"ver",parentKey:rhizo.layout.firstMetamodelKey(this.project_,this.matcher_)}};
rhizo.layout.TreeLayout.prototype.validateState_=function(a){return this.validateStateAttributePresence_(a,"parentKey")&&this.validateMetamodelPresence_(a.parentKey,this.matcher_)};
rhizo.layout.TreeLayout.prototype.layout=function(a,b,c,d,e){var f=this.getState().parentKey,g=this.getState().direction=="ver";this.treePainter_=new rhizo.layout.TreePainter(this.project_,g);try{this.globalNodesMap_={};var h=(new rhizo.layout.newTreeifier(f,e[f])).buildTree(c,d,this.globalNodesMap_).childs;c={left:0,top:0};d=0;for(var j in h){this.treePainter_.fillSyntheticRenderings_(h[j],a);var k=this.treePainter_.toAbsoluteCoords_(this.treePainter_.calculateBoundingRect_(h[j]));if(c.left+k.w>
b.width){c.left=0;c.top+=d+(d>0?5:0)}this.treePainter_.draw_(a,h[j],this.treePainter_.toRelativeCoords_(c));c.left+=k.w;d=Math.max(d,k.h)}}catch(m){if(m.name=="TreeCycleException")this.project_.logger().error(m);else throw m;}return false};rhizo.layout.TreeLayout.prototype.toString=function(){return"TreeLayout"};rhizo.layout.TreeLayout.prototype.dependentModels=function(a){var b=[];if(a=this.globalNodesMap_[a]){a.deepChildsAsArray(b);for(a=b.length-1;a>=0;a--)b[a]=b[a].id}return b};
rhizo.layout.TreePainter=function(a,b){this.project_=a;if(this.vertical_=b){this.gdName_="top";this.odName_="left";this.gdLength_="height";this.odLength_="width"}else{this.gdName_="left";this.odName_="top";this.gdLength_="width";this.odLength_="height"}};rhizo.layout.TreePainter.prototype.gd_=function(a){return this.vertical_?a.height:a.width};rhizo.layout.TreePainter.prototype.od_=function(a){return this.vertical_?a.width:a.height};
rhizo.layout.TreePainter.prototype.toAbsoluteCoords_=function(a){return this.vertical_?{w:a.od,h:a.gd}:{w:a.gd,h:a.od}};rhizo.layout.TreePainter.prototype.toRelativeCoords_=function(a){return this.vertical_?{gd:a.top,od:a.left}:{gd:a.left,od:a.top}};rhizo.layout.TreePainter.prototype.packedCenter_=function(a,b){return{gd:a.gd+5+this.gd_(b)/2,od:a.od+this.od_(b)/2}};rhizo.layout.TreePainter.prototype.evenCenter_=function(a,b,c){return{gd:a.gd+c.gd/2,od:a.od+5+this.od_(b)/2}};
rhizo.layout.TreePainter.prototype.fillSyntheticRenderings_=function(a,b){if(a.synthetic()&&!a.syntheticRendering()){var c=$("<div />",{"class":"rhizo-tree-syntheticnode"}).text(a.payload()||"Everything Else");this.project_.options().isClickSelectionMode()&&c.click(jQuery.proxy(function(){var e=[],f=[];a.deepChildsAsArray(e);for(var g=e.length-1;g>=0;g--)e[g].synthetic()||f.push(e[g].id);this.project_.eventBus().publish("selection",{action:"toggle",models:f})},this));b.artifact(c);a.setSyntheticRendering(new rhizo.ui.SyntheticRendering(c))}for(var d in a.childs)this.fillSyntheticRenderings_(a.childs[d],
b)};rhizo.layout.TreePainter.prototype.calculateBoundingRect_=function(a){var b={gd:0,od:0};for(var c in a.childs){var d=this.calculateBoundingRect_(a.childs[c]);b.gd+=d.gd+5;b.od=Math.max(b.od,d.od)}c=a.renderingDimensions();a.boundingRect={od:this.od_(c)+b.od+25,gd:Math.max(this.gd_(c),b.gd)+5};return a.boundingRect};
rhizo.layout.TreePainter.prototype.draw_=function(a,b,c,d,e){var f=b.renderingDimensions();if(this.vertical_){b.synthetic()?b.syntheticRendering().move(c.gd+5,c.od,true):a.move(b.payload().id,c.gd+5,c.od);d!=null&&this.drawConnector_(a,this.packedCenter_(c,f),this.packedCenter_(d,e.renderingDimensions()))}else{b.synthetic()?b.syntheticRendering().move(c.od+5,c.gd+(b.boundingRect.gd-this.gd_(f))/2,true):a.move(b.payload().id,c.od+5,c.gd+(b.boundingRect.gd-this.gd_(f))/2);d!=null&&this.drawConnector_(a,
this.evenCenter_(c,f,b.boundingRect),this.evenCenter_(d,e.renderingDimensions(),e.boundingRect))}d=c.gd;for(var g in b.childs){e=b.childs[g];var h={od:c.od+this.od_(f)+20,gd:d};this.draw_(a,e,h,c,b);d+=e.boundingRect.gd+5}};
rhizo.layout.TreePainter.prototype.drawConnector_=function(a,b,c){var d={position:"absolute"};d[this.gdName_]=Math.min(b.gd,c.gd);d[this.odName_]=c.od;d[this.odLength_]=2;d[this.gdLength_]=Math.abs(c.gd-b.gd);d=$("<div />",{"class":"rhizo-tree-connector",css:d});var e={position:"absolute"};e[this.gdName_]=b.gd;e[this.odName_]=c.od;e[this.gdLength_]=2;e[this.odLength_]=Math.abs(c.od-b.od);b=$("<div />",{"class":"rhizo-tree-connector",css:e});a.artifact(d);a.artifact(b)};
rhizo.layout.layouts.tree={name:"Tree",engine:rhizo.layout.TreeLayout};namespace("rhizo.layout");namespace("rhizo.layout.treemap");rhizo.layout.treemap.TreeMapDirection={HOR:"h",VER:"v"};
rhizo.layout.treemap.TreeMapNode=function(a,b,c,d){this.id=a.id;this.pipeline_=b;this.project_=c;this.area_=a.area*d;if(isNaN(this.area_)||this.area_<0)this.area_=0;this.height_=this.width_=this.left_=this.top_=0;if(this.synthetic_=a.synthetic()){this.buildSyntheticRendering_(a);this.hidden_=false}else this.model_=a.payload()};
rhizo.layout.treemap.TreeMapNode.prototype.buildSyntheticRendering_=function(a){var b=$("<div />",{"class":"rhizo-treemap-syntheticnode"}).text(a.payload()||"Everything Else");this.project_.options().isClickSelectionMode()&&b.click(jQuery.proxy(function(){var c=[],d=[];a.deepChildsAsArray(c);for(var e=c.length-1;e>=0;e--)c[e].synthetic()||d.push(c[e].id);this.project_.eventBus().publish("selection",{action:"toggle",models:d})},this));this.pipeline_.artifact(b);this.syntheticRendering_=new rhizo.ui.SyntheticRendering(b);
a.setSyntheticRendering(this.syntheticRendering_)};rhizo.layout.treemap.TreeMapNode.prototype.area=function(){return this.area_};rhizo.layout.treemap.TreeMapNode.prototype.isHidden=function(){return this.synthetic_?this.hidden_:this.model_.isFiltered("__treemap__")};rhizo.layout.treemap.TreeMapNode.prototype.hide=function(){if(this.synthetic_)this.hidden_=true;else this.model_.filter("__treemap__")};
rhizo.layout.treemap.TreeMapNode.prototype.nestedBoundingRect=function(){return this.isHidden()||this.width_<24||this.height_<39?{width:0,height:0}:{width:this.width_-4,height:this.height_-19}};rhizo.layout.treemap.TreeMapNode.prototype.nestedAnchor=function(){return{x:this.left_+2,y:this.top_+17}};
rhizo.layout.treemap.TreeMapNode.prototype.move=function(a,b,c){this.top_=Math.round(a);this.left_=Math.round(b);if(this.synthetic_){this.syntheticRendering_.move(this.top_,this.left_,true);this.syntheticRendering_.pushElevation("__treemap__",c)}else this.pipeline_.move(this.id,this.top_,this.left_,"__treemap__",c)};
rhizo.layout.treemap.TreeMapNode.prototype.resize=function(a,b){if(this.synthetic_){if(!this.syntheticRendering_.canRescaleTo(a,b))return false;this.width_=a;this.height_=b;return this.syntheticRendering_.rescaleRendering(a,b)}else if(this.model_.rendering().canRescaleTo(a,b)){this.pipeline_.resize(this.id,a,b);this.width_=a;this.height_=b;return true}return false};
rhizo.layout.treemap.TreeMapNode.prototype.colorWeighted=function(a){if(!this.synthetic_){var b=parseFloat(this.model_.unwrap()[a.meta]);isNaN(b)||this.pipeline_.style(this.id,{backgroundColor:this.toColorScale_(b,a)})}};rhizo.layout.treemap.TreeMapNode.prototype.color=function(a){this.synthetic_||this.pipeline_.style(this.id,{backgroundColor:a})};
rhizo.layout.treemap.TreeMapNode.prototype.updateColorRange=function(a){if(!this.synthetic_){var b=parseFloat(this.model_.unwrap()[a.meta]);if(!isNaN(b)){a.min=Math.min(a.min,b);a.max=Math.max(a.max,b)}}};
rhizo.layout.treemap.TreeMapNode.prototype.toColorScale_=function(a,b){for(var c=b.kind.toUserScale?jQuery.proxy(b.kind.toUserScale,b.kind):function(h){return h},d=["r","g","b"],e={},f=0;f<d.length;f++){var g=d[f];e[g]=b.colorMin[g]+(b.colorMax[g]-b.colorMin[g])*(c(a)-c(b.min))/(c(b.max)-c(b.min))}return"rgb("+Math.round(e.r)+","+Math.round(e.g)+","+Math.round(e.b)+")"};
rhizo.layout.treemap.TreeMapSlice=function(a,b,c){this.length_=a;this.direction_=b;this.anchorPoint_=c;this.nodes_=[];this.sliceArea_=0;this.minArea_=Number.MAX_VALUE};rhizo.layout.treemap.TreeMapSlice.prototype.direction=function(){return this.direction_};rhizo.layout.treemap.TreeMapSlice.prototype.anchorPoint=function(){return this.anchorPoint_};rhizo.layout.treemap.TreeMapSlice.prototype.nodes=function(){return this.nodes_};
rhizo.layout.treemap.TreeMapSlice.prototype.addNode=function(a){this.nodes_.push(a);this.sliceArea_+=a.area();this.minArea_=Math.min(this.minArea_,a.area())};rhizo.layout.treemap.TreeMapSlice.prototype.span=function(a){return a?(this.sliceArea_+a.area())/this.length_:this.sliceArea_/this.length_};rhizo.layout.treemap.TreeMapSlice.prototype.aspectRatio=function(a){var b=this.span(a),c=null;c=a?Math.min(this.minArea_,a.area())/(1*b*b):this.minArea_/(1*b*b);if(c<1)c=1/c;return c};
rhizo.layout.treemap.TreeMapSlice.prototype.draw=function(a,b){a=a||{x:0,y:0};for(var c=0,d=this.anchorPoint_.y+a.y,e=this.anchorPoint_.x+a.x,f=0;f<this.nodes_.length;f++){var g=this.nodes_[f];if(g.isHidden())c++;else{var h=Math.round(this.span()),j=g.area()/this.span();if(Math.round(j)==0||h==0){g.hide();c++}else{var k={};if(this.direction_==rhizo.layout.treemap.TreeMapDirection.HOR){k.width=Math.round(j);k.height=h}else{k.width=h;k.height=Math.round(j)}if(g.resize(k.width,k.height))g.move(d,e,b);
else{g.hide();c++}}if(this.direction_==rhizo.layout.treemap.TreeMapDirection.HOR)e+=j;else d+=j}}return c};rhizo.layout.TreeMapLayout=function(a){this.project_=a;this.prevColorMeta_=null;this.globalNodesMap_={};this.numHiddenModels_=0;this.parentMatcher_=rhizo.layout.orMatcher(rhizo.layout.linkMatcher,rhizo.layout.hierarchyMatcher);rhizo.layout.StatefulLayout.call(this,a)};rhizo.inherits(rhizo.layout.TreeMapLayout,rhizo.layout.StatefulLayout);
rhizo.layout.TreeMapLayout.prototype.verifyMetaModel=function(a){for(var b in a)if(rhizo.layout.numericMatcher(b,a[b]))return true;return false};rhizo.layout.TreeMapLayout.prototype.defaultState_=function(){return{area:rhizo.layout.firstMetamodelKey(this.project_,rhizo.layout.numericMatcher),color:null,parentKey:null}};
rhizo.layout.TreeMapLayout.prototype.validateState_=function(a){if(!this.validateStateAttributePresence_(a,"area"))return false;if(!this.validateMetamodelPresence_(a.area,rhizo.layout.numericMatcher))return false;if(a.color&&!this.validateMetamodelPresence_(a.color,rhizo.layout.numericMatcher))return false;if(a.parentKey&&!this.validateMetamodelPresence_(a.parentKey,this.parentMatcher_))return false;return true};
rhizo.layout.TreeMapLayout.prototype.layout=function(a,b,c,d,e){var f=this.getState().area,g=this.getState().color,h=this.getState().parentKey;a.backupManager().restore(c,this.prevColorMeta_&&!g);this.prevColorMeta_=g;this.revertExpandedModels_(c);var j;this.globalNodesMap_={};if(h)try{j=(new rhizo.layout.newTreeifier(h,e[h])).buildTree(c,d,this.globalNodesMap_)}catch(k){if(k.name=="TreeCycleException"){this.project_.logger().error(k);return false}else throw k;}else{j=new rhizo.layout.TreeNode;for(d=
0;d<c.length;d++)j.addChild(new rhizo.layout.ModelTreeNode(c[d]))}this.computeNestedAreas_(j,f);this.numHiddenModels_=this.layoutNestedMap_(a,{width:b.width,height:b.height},j,{x:0,y:0},50);if(g){a={min:Number.MAX_VALUE,max:Number.MIN_VALUE,meta:g,kind:this.project_.metaModel()[g].kind,colorMin:{r:237,g:76,b:95},colorMax:{r:122,g:255,b:115},colorGroup:"white"};this.computeColorRange_(j,a);this.colorTree_(j,a)}return this.numHiddenModels_>0};
rhizo.layout.TreeMapLayout.prototype.cleanup=function(){if(this.numHiddenModels_>0){this.project_.filterManager().removeFilterFromModels("__treemap__");this.numHiddenModels_=0;return true}return false};rhizo.layout.TreeMapLayout.prototype.dependentModels=function(a){var b=[];if(a=this.globalNodesMap_[a]){a.deepChildsAsArray(b);for(a=b.length-1;a>=0;a--)b[a]=b[a].id}return b};rhizo.layout.TreeMapLayout.prototype.toString=function(){return"TreeMapLayout"};
rhizo.layout.TreeMapLayout.prototype.layoutNestedMap_=function(a,b,c,d,e){var f=0;if(c.numChilds==0)return f;b=this.layoutFlatMap_(a,b,c);for(var g=0;g<b.length;g++){f+=b[g].draw(d,e);for(var h=0;h<b[g].nodes().length;h++){var j=b[g].nodes()[h],k=c.childs[j.id];k.treemapnode=j;f+=this.layoutNestedMap_(a,j.nestedBoundingRect(),k,j.nestedAnchor(),e+1,a)}}return f};rhizo.layout.TreeMapLayout.prototype.sortByAreaDesc_=function(a,b){return b.area-a.area};
rhizo.layout.TreeMapLayout.prototype.layoutFlatMap_=function(a,b,c){var d=[];if(c.numChilds==0)return d;c=c.childsAsArray();for(var e=0,f=0;f<c.length;f++)e+=c[f].area;var g;if(e>0)g=b.width*b.height*1/e;b.width<b.height?d.push(new rhizo.layout.treemap.TreeMapSlice(b.width,rhizo.layout.treemap.TreeMapDirection.HOR,{x:0,y:0})):d.push(new rhizo.layout.treemap.TreeMapSlice(b.height,rhizo.layout.treemap.TreeMapDirection.VER,{x:0,y:0}));e=d[0];f=0;c.sort(this.sortByAreaDesc_);var h=new rhizo.layout.treemap.TreeMapNode(c[f++],
a,this.project_,g);h.area()<=0&&h.hide();for(e.addNode(h);f<c.length;){h=new rhizo.layout.treemap.TreeMapNode(c[f++],a,this.project_,g);if(h.area()<=0)h.hide();else{var j=e.aspectRatio(h),k=e.aspectRatio();if(j>k){b=this.getRemainderBoundingRect_(b,e);j=e.direction()==rhizo.layout.treemap.TreeMapDirection.HOR?b.height:b.width;e=e.direction()==rhizo.layout.treemap.TreeMapDirection.HOR?new rhizo.layout.treemap.TreeMapSlice(j,rhizo.layout.treemap.TreeMapDirection.VER,{x:e.anchorPoint().x,y:e.anchorPoint().y+
e.span()}):new rhizo.layout.treemap.TreeMapSlice(j,rhizo.layout.treemap.TreeMapDirection.HOR,{x:e.anchorPoint().x+e.span(),y:e.anchorPoint().y});d.push(e)}}e.addNode(h)}return d};rhizo.layout.TreeMapLayout.prototype.getRemainderBoundingRect_=function(a,b){var c=b.span();return b.direction()==rhizo.layout.treemap.TreeMapDirection.HOR?{width:a.width,height:a.height-c}:{width:a.width-c,height:a.height}};
rhizo.layout.TreeMapLayout.prototype.computeNestedAreas_=function(a,b){if(a.numChilds==0){a.area=parseFloat(a.payload().unwrap()[b]);if(isNaN(a.area)||a.area<0)a.area=0}else{var c=0;for(var d in a.childs)c+=this.computeNestedAreas_(a.childs[d],b);a.area=c}return a.area};
rhizo.layout.TreeMapLayout.prototype.computeColorRange_=function(a,b){if(!a.is_root&&a.treemapnode.isHidden())return false;if(a.numChilds>0){var c=false;for(var d in a.childs)c=this.computeColorRange_(a.childs[d],b)||c;c||a.is_root||a.treemapnode.updateColorRange(b)}else a.is_root||a.treemapnode.updateColorRange(b);return true};
rhizo.layout.TreeMapLayout.prototype.colorTree_=function(a,b){if(!a.is_root&&a.treemapnode.isHidden())return false;if(a.numChilds>0){var c=false;for(var d in a.childs)c=this.colorTree_(a.childs[d],b)||c;a.is_root||(c?a.treemapnode.color(b.colorGroup):a.treemapnode.colorWeighted(b))}else a.is_root||a.treemapnode.colorWeighted(b);return true};rhizo.layout.TreeMapLayout.prototype.revertExpandedModels_=function(a){for(var b=a.length-1;b>=0;b--)a[b].rendering().setExpanded(false)};
rhizo.layout.layouts.treemap={name:"Treemap",engine:rhizo.layout.TreeMapLayout};namespace("rhizo.model.loader");rhizo.model.loader.loaders=[];var $globalJSONPLoaderCount=0,$globalJSONPLoaderMap={};rhizo.model.loader.JSONP=function(a){this.resource_=a;this.loaderCount_=$globalJSONPLoaderCount++;$globalJSONPLoaderMap[this.loaderCount_]=this};rhizo.model.loader.loaders.push(rhizo.model.loader.JSONP);rhizo.model.loader.JSONP.prototype.match=function(){return/\.js$/.test(this.resource_)};
rhizo.model.loader.JSONP.prototype.load=function(a){this.callback_=a;a=document.createElement("script");a.src=this.resource_+"?jsonp=$globalJSONPLoaderMap["+this.loaderCount_+"].loadDone";a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a)};rhizo.model.loader.JSONP.prototype.loadDone=function(a){this.callback_(a.models,a.metamodel,a.renderer);$globalJSONPLoaderMap[this.loaderCount_]=null};rhizo.model.loader.GViz=function(a){this.datasource_url=this.resource_=a};rhizo.model.loader.loaders.push(rhizo.model.loader.GViz);
rhizo.model.loader.GViz.prototype.match=function(){return false};rhizo.model.loader.GViz.prototype.load=function(a,b,c){if(typeof google=="undefined"||typeof google.visualization=="undefined")c.error("Google Visualization APIs not available.");else{var d=this;(new google.visualization.Query(this.resource_)).send(function(e){d.handleQueryResponse_(e,a,b,c)})}};
rhizo.model.loader.GViz.prototype.handleQueryResponse_=function(a,b,c,d){if(a.isError())d.error("GViz load failed: "+a.getMessage());else{a=new rhizo.gviz.Initializer(a.getDataTable(),d,c);a.parse()&&b(a.models,a.metamodel,a.renderer)}};rhizo.model.loader.GoogleSpreadsheets=function(a){rhizo.model.loader.GViz.call(this,a)};rhizo.inherits(rhizo.model.loader.GoogleSpreadsheets,rhizo.model.loader.GViz);rhizo.model.loader.loaders.push(rhizo.model.loader.GoogleSpreadsheets);
rhizo.model.loader.GoogleSpreadsheets.prototype.match=function(){return/spreadsheets\d?\.google\.com/.test(this.resource_)};rhizo.model.loader.GoogleGadget=function(a){rhizo.model.loader.GViz.call(this,a)};rhizo.inherits(rhizo.model.loader.GoogleGadget,rhizo.model.loader.GViz);rhizo.model.loader.loaders.push(rhizo.model.loader.GoogleGadget);rhizo.model.loader.GoogleGadget.prototype.match=function(){return false};
rhizo.model.loader.GoogleGadget.prototype.load=function(a,b,c){if(typeof google=="undefined"||typeof google.visualization=="undefined")c.error("Google Visualization APIs not available.");else if(typeof _IG_Prefs=="undefined")c.error("Google Gadget APIs not available.");else{var d=new _IG_Prefs,e=this;(new google.visualization.GadgetHelper).createQueryFromPrefs(d).send(function(f){e.handleQueryResponse_(f,a,b,c)})}};
rhizo.model.loader.load=function(a,b,c,d){for(var e=rhizo.model.loader.loaders,f=0;f<e.length;f++){var g=new e[f](a);if(g.match()){g.load(b,c,d);return}}d.error("No loader available for the resource: "+a)};namespace("rhizo.ui.layout");rhizo.ui.layout.registerUi=function(a,b){if(a in rhizo.layout.layouts)rhizo.layout.layouts[a].ui=b};
rhizo.ui.layout.metaModelKeySelector=function(a,b,c){b=$("<select class='"+b+"' />");if(a&&a.metaModel())for(var d in a.metaModel())if(!c||c(d,a.metaModel()[d]))b.append("<option value='"+d+"'>"+a.metaModel()[d].label+"</option>");return b};rhizo.ui.layout.LayoutUi=function(a,b){this.ui_controls_=null;this.project_=a;this.engineName_=b;this.project_.eventBus().subscribe("layout",this.onLayout_,this)};
rhizo.ui.layout.LayoutUi.prototype.layoutUIControls=function(){if(!this.ui_controls_){this.ui_controls_=this.renderControls();this.setState(this.project_.layoutManager().getEngineState(this.engineName_))}return this.ui_controls_};rhizo.ui.layout.LayoutUi.prototype.onLayout_=function(a){a.engine==this.engineName_&&this.ui_controls_&&a.state&&this.setState(a.state)};rhizo.ui.layout.LayoutUi.prototype.renderControls=function(){return null};rhizo.ui.layout.LayoutUi.prototype.setState=function(){};
rhizo.ui.layout.LayoutUi.prototype.setStateFromUi=function(a){this.project_.eventBus().publish("layout",{engine:this.engineName_,state:a,options:{forcealign:true}},null,this)};rhizo.ui.layout.ScrambleLayoutUi=function(a,b){rhizo.ui.layout.LayoutUi.call(this,a,b)};rhizo.inherits(rhizo.ui.layout.ScrambleLayoutUi,rhizo.ui.layout.LayoutUi);rhizo.ui.layout.registerUi("scramble",rhizo.ui.layout.ScrambleLayoutUi);
rhizo.ui.layout.ScrambleLayoutUi.prototype.renderControls=function(){var a=$("<button />").text("Reshuffle").click(jQuery.proxy(function(){this.setStateFromUi({})},this));return $("<div />").append(a)};rhizo.ui.layout.FlowLayoutUi=function(a,b){rhizo.ui.layout.LayoutUi.call(this,a,b);this.project_=a;this.reverseCheckbox_=this.orderSelector_=null};rhizo.inherits(rhizo.ui.layout.FlowLayoutUi,rhizo.ui.layout.LayoutUi);rhizo.ui.layout.registerUi("flow",rhizo.ui.layout.FlowLayoutUi);
rhizo.ui.layout.FlowLayoutUi.prototype.renderControls=function(){this.orderSelector_=rhizo.ui.layout.metaModelKeySelector(this.project_,"rhizo-flowlayout-order").change(jQuery.proxy(this.updateState_,this));this.reverseCheckbox_=$('<input type="checkbox" class="rhizo-flowlayout-desc" />').click(jQuery.proxy(this.updateState_,this));return $("<div />").append("Ordered by: ").append(this.orderSelector_).append(" desc?").append(this.reverseCheckbox_)};
rhizo.ui.layout.FlowLayoutUi.prototype.setState=function(a){this.orderSelector_.val(a.order);a.reverse?this.reverseCheckbox_.attr("checked","checked"):this.reverseCheckbox_.removeAttr("checked")};rhizo.ui.layout.FlowLayoutUi.prototype.updateState_=function(){this.setStateFromUi({order:this.orderSelector_.val(),reverse:this.reverseCheckbox_.is(":checked")})};
rhizo.ui.layout.BucketLayoutUi=function(a,b){rhizo.ui.layout.LayoutUi.call(this,a,b);this.project_=a;this.reverseCheckbox_=this.bucketSelector_=null};rhizo.inherits(rhizo.ui.layout.BucketLayoutUi,rhizo.ui.layout.LayoutUi);rhizo.ui.layout.registerUi("bucket",rhizo.ui.layout.BucketLayoutUi);
rhizo.ui.layout.BucketLayoutUi.prototype.renderControls=function(){this.bucketSelector_=rhizo.ui.layout.metaModelKeySelector(this.project_,"rhizo-bucketlayout-bucket").change(jQuery.proxy(this.updateState_,this));this.reverseCheckbox_=$('<input type="checkbox" class="rhizo-bucketlayout-desc" />').click(jQuery.proxy(this.updateState_,this));return $("<div />").append("Group by: ").append(this.bucketSelector_).append(" desc?").append(this.reverseCheckbox_)};
rhizo.ui.layout.BucketLayoutUi.prototype.setState=function(a){this.bucketSelector_.val(a.bucketBy);a.reverse?this.reverseCheckbox_.attr("checked","checked"):this.reverseCheckbox_.removeAttr("checked")};rhizo.ui.layout.BucketLayoutUi.prototype.updateState_=function(){this.setStateFromUi({bucketBy:this.bucketSelector_.val(),reverse:this.reverseCheckbox_.is(":checked")})};
rhizo.ui.layout.TreeLayoutUi=function(a,b){rhizo.ui.layout.LayoutUi.call(this,a,b);this.project_=a;this.metaModelKeySelector_=this.directionSelector_=null;this.matcher_=rhizo.layout.orMatcher(rhizo.layout.linkMatcher,rhizo.layout.hierarchyMatcher)};rhizo.inherits(rhizo.ui.layout.TreeLayoutUi,rhizo.ui.layout.LayoutUi);rhizo.ui.layout.registerUi("tree",rhizo.ui.layout.TreeLayoutUi);
rhizo.ui.layout.TreeLayoutUi.prototype.renderControls=function(){var a=this.getParentKeys_(),b=$("<div />");if(a.length==0){b.append("No hierarchical relationships exist");return b}b.append(" arrange ");this.directionSelector_=$("<select class='rhizo-treelayout-direction' />");this.directionSelector_.append("<option value='hor'>Horizontally</option>");this.directionSelector_.append("<option value='ver'>Vertically</option>");this.directionSelector_.change(jQuery.proxy(this.updateState_,this));b.append(this.directionSelector_);
if(a.length>1){this.metaModelKeySelector_=rhizo.ui.layout.metaModelKeySelector(this.project_,"rhizo-treelayout-parentKey",this.matcher_);this.metaModelKeySelector_.change(jQuery.proxy(this.updateState_,this));b.append(" by ").append(this.metaModelKeySelector_)}else if(a.length==1)this.metaModelKeySelector_=$("<input type='hidden' />").val(a[0]);return b};
rhizo.ui.layout.TreeLayoutUi.prototype.getParentKeys_=function(){var a=[];for(var b in this.project_.metaModel())this.matcher_(b,this.project_.metaModel()[b])&&a.push(b);return a};rhizo.ui.layout.TreeLayoutUi.prototype.setState=function(a){this.directionSelector_.val(a.direction);this.metaModelKeySelector_&&this.metaModelKeySelector_.val(a.parentKey)};
rhizo.ui.layout.TreeLayoutUi.prototype.updateState_=function(){var a={direction:this.directionSelector_.val()};if(this.metaModelKeySelector_)a.parentKey=this.metaModelKeySelector_.val();this.setStateFromUi(a)};rhizo.ui.layout.TreeMapLayoutUi=function(a,b){rhizo.ui.layout.LayoutUi.call(this,a,b);this.project_=a;this.parentKeySelector_=this.colorSelector_=this.areaSelector_=null;this.parentMatcher_=rhizo.layout.orMatcher(rhizo.layout.linkMatcher,rhizo.layout.hierarchyMatcher)};
rhizo.inherits(rhizo.ui.layout.TreeMapLayoutUi,rhizo.ui.layout.LayoutUi);rhizo.ui.layout.registerUi("treemap",rhizo.ui.layout.TreeMapLayoutUi);
rhizo.ui.layout.TreeMapLayoutUi.prototype.renderControls=function(){var a=this.checkParentKeys_(),b=$("<div />");this.areaSelector_=rhizo.ui.layout.metaModelKeySelector(this.project_,"rhizo-treemaplayout-area",rhizo.layout.numericMatcher).change(jQuery.proxy(this.updateState_,this));this.colorSelector_=rhizo.ui.layout.metaModelKeySelector(this.project_,"rhizo-treemaplayout-color",rhizo.layout.numericMatcher).append("<option value=''>-</option>").change(jQuery.proxy(this.updateState_,this));b.append(this.renderSelector_("Area: ",
this.areaSelector_)).append(this.renderSelector_("Color: ",this.colorSelector_));if(a){this.parentKeySelector_=rhizo.ui.layout.metaModelKeySelector(this.project_,"rhizo-treemaplayout-parentKey",this.parentMatcher_).append("<option value=''>-</option>").change(jQuery.proxy(this.updateState_,this));b.append(this.renderSelector_("Group by: ",this.parentKeySelector_))}return b};rhizo.ui.layout.TreeMapLayoutUi.prototype.renderSelector_=function(a,b){return $("<div />",{"class":"rhizo-layout-control"}).append($("<label />").text(a)).append(b)};
rhizo.ui.layout.TreeMapLayoutUi.prototype.checkParentKeys_=function(){for(var a in this.project_.metaModel())if(this.parentMatcher_(a,this.project_.metaModel()[a]))return true;return false};rhizo.ui.layout.TreeMapLayoutUi.prototype.setState=function(a){this.areaSelector_.val(a.area);this.colorSelector_.val(a.color||"");if(this.parentKeySelector_)this.parentKeySelector_.val(a.parentKey||"")};
rhizo.ui.layout.TreeMapLayoutUi.prototype.updateState_=function(){var a={area:this.areaSelector_.val(),color:this.colorSelector_.val()};if(this.parentKeySelector_)a.parentKey=this.parentKeySelector_.val();this.setStateFromUi(a)};namespace("rhizo.ui.component");rhizo.ui.component.Progress=function(){};
rhizo.ui.component.Progress.prototype.render=function(a){this.pbarPanel_=$("<div/>",{"class":"rhizo-progressbar-panel"}).appendTo(a);this.pbarPanel_.css({top:Math.round((a.height()-this.pbarPanel_.height())/2),left:Math.round((a.width()-this.pbarPanel_.width())/2)});this.pbar_=$("<div/>",{"class":"rhizo-progressbar"}).appendTo(this.pbarPanel_).progressbar({value:1});this.pbarText_=$("<div/>",{"class":"rhizo-progressbar-text"}).text("Loading...").appendTo(this.pbarPanel_)};
rhizo.ui.component.Progress.prototype.update=function(a,b){this.pbar_.progressbar("value",a);b&&this.pbarText_.text(b);a>=100&&this.destroy()};rhizo.ui.component.Progress.prototype.destroy=function(){this.pbarPanel_.is(":visible")?setTimeout(jQuery.proxy(function(){this.pbarPanel_.fadeOut(function(){$(this).remove()})},this),1E3):this.pbarPanel_.remove()};rhizo.ui.component.Phase={INIT:0,RENDER:1,METAREADY:2,READY:3};
rhizo.ui.component.Component=function(a,b){this.project_=a;this.gui_=a.gui();this.key_=b};rhizo.ui.component.Component.prototype.key=function(){return this.key_};rhizo.ui.component.Component.prototype.title=function(){return null};rhizo.ui.component.Component.prototype.titleClass=function(){return null};rhizo.ui.component.Component.prototype.render=function(){return $("<div />").get(0)};rhizo.ui.component.Component.prototype.metaReady=function(){};rhizo.ui.component.Component.prototype.ready=function(){};
rhizo.ui.component.Container=function(a,b){rhizo.ui.component.Component.call(this,a,b);this.components_=[];this.phase_=rhizo.ui.component.Phase.INIT};rhizo.inherits(rhizo.ui.component.Container,rhizo.ui.component.Component);
rhizo.ui.component.Container.prototype.addComponent=function(a,b){b?this.components_.splice(b,0,a):this.components_.push(a);if(b<0)b=this.components_.length-1+b;var c=null;switch(this.phase_){case rhizo.ui.component.Phase.INIT:break;case rhizo.ui.component.Phase.RENDER:c=this.renderSingleComponent(a,b);break;case rhizo.ui.component.Phase.METAREADY:c=this.renderSingleComponent(a,b);a.metaReady();break;case rhizo.ui.component.Phase.READY:c=this.renderSingleComponent(a,b);a.metaReady();a.ready();break;
default:break}return c};rhizo.ui.component.Container.prototype.getComponents=function(){return this.components_};rhizo.ui.component.Container.prototype.phase=function(){return this.phase_};rhizo.ui.component.Container.prototype.render=function(){this.phase_=rhizo.ui.component.Phase.RENDER;var a=[];this.appendRendering_(this.renderContainer(),a);for(var b=0;b<this.components_.length;b++)this.appendRendering_(this.renderSingleComponent(this.components_[b],b),a);return a};
rhizo.ui.component.Container.prototype.appendRendering_=function(a,b){if(a)jQuery.isArray(a)?Array.prototype.push.apply(b,a):b.push(a)};rhizo.ui.component.Container.prototype.renderContainer=function(){return null};rhizo.ui.component.Container.prototype.renderSingleComponent=function(){return null};rhizo.ui.component.Container.prototype.metaReady=function(){this.phase_=rhizo.ui.component.Phase.METAREADY;for(var a=this.getComponents(),b=0;b<a.length;b++)a[b].metaReady()};
rhizo.ui.component.Container.prototype.ready=function(){this.phase_=rhizo.ui.component.Phase.READY;for(var a=this.getComponents(),b=0;b<a.length;b++)a[b].ready()};rhizo.ui.component.Template=function(a,b){rhizo.ui.component.Container.call(this,a,b);this.viewport_=new rhizo.ui.component.Viewport(a);if(a.options().isLoadingIndicatorEnabled())this.progress_=new rhizo.ui.component.Progress};rhizo.inherits(rhizo.ui.component.Template,rhizo.ui.component.Container);
rhizo.ui.component.Template.prototype.setProgressHandler=function(a){this.progress_&&this.progress_.destroy();this.progress_=a};rhizo.ui.component.Template.prototype.addComponent=function(a){(a=rhizo.ui.component.Container.prototype.addComponent.call(this,a))&&this.gui_.container.append(a)};rhizo.ui.component.Template.prototype.render=function(){var a=rhizo.ui.component.Container.prototype.render.call(this);this.progress_&&this.progress_.update(20,"Chrome created. Loading metadata...");return a};
rhizo.ui.component.Template.prototype.renderContainer=function(){this.gui_.container.addClass("rhizo-template-"+this.key());this.gui_.container.append(this.viewport_.render());this.progress_&&this.progress_.render(this.gui_.viewport);return this.gui_.container.get(0)};rhizo.ui.component.Template.prototype.renderSingleComponent=function(a){this.gui_.container.append(a.render());return null};
rhizo.ui.component.Template.prototype.metaReady=function(){this.progress_&&this.progress_.update(40,"Metadata loaded. Updating components...");this.viewport_.metaReady();rhizo.ui.component.Container.prototype.metaReady.call(this);this.progress_&&this.progress_.update(60,"Components updated. Loading models...")};
rhizo.ui.component.Template.prototype.ready=function(){this.progress_&&this.progress_.update(80,"Models loaded. Activating UI...");this.viewport_.ready();rhizo.ui.component.Container.prototype.ready.call(this);this.progress_&&this.progress_.update(100,"Rhizosphere ready!")};rhizo.ui.component.VBox=function(a,b,c){rhizo.ui.component.Container.call(this,a,b);this.boxclass_=c;this.panel_=null};rhizo.inherits(rhizo.ui.component.VBox,rhizo.ui.component.Container);
rhizo.ui.component.VBox.prototype.renderContainer=function(){this.panel_=$("<div />",{"class":this.boxclass_});return this.panel_.get(0)};rhizo.ui.component.VBox.prototype.renderSingleComponent=function(a){var b=a.title();if(b){var c="rhizo-section-header";if(a.titleClass())c+=" "+a.titleClass();$("<div />",{"class":c}).text(b).appendTo(this.panel_)}this.panel_.append(a.render());return null};rhizo.ui.component.RightBar=function(a,b,c){rhizo.ui.component.Container.call(this,a,b);this.boxclass_=c};
rhizo.inherits(rhizo.ui.component.RightBar,rhizo.ui.component.Container);rhizo.ui.component.RightBar.prototype.renderContainer=function(){this.toggle_=$("<div />",{"class":"rhizo-right-pop"}).html("&#x25c2;");this.rightBar_=$("<div />",{"class":this.boxclass_}).css("display","none");this.activateToggle_();return[this.rightBar_.get(0),this.toggle_.get(0)]};
rhizo.ui.component.RightBar.prototype.renderSingleComponent=function(a){var b=a.title();if(b){var c="rhizo-section-header";if(a.titleClass())c+=" "+a.titleClass();$("<div />",{"class":c}).text(b).appendTo(this.rightBar_)}this.rightBar_.append(a.render());return null};
rhizo.ui.component.RightBar.prototype.activateToggle_=function(){this.toggle_.click(jQuery.proxy(function(){if(this.rightBar_.is(":visible")){this.toggle_.css("right",0).html("&#x25c2;");this.gui_.viewport.css("right",5);this.rightBar_.css("display","none")}else{this.gui_.viewport.css("right",135);this.toggle_.css("right",130).html("&#x25b8;");this.rightBar_.css("display","")}},this))};rhizo.ui.component.RightBar.prototype.getToggle=function(){return this.toggle_};
rhizo.ui.component.RightBar.prototype.isCollapsed=function(){return this.rightBar_.is(":visible")};rhizo.ui.component.HBox=function(a,b,c){rhizo.ui.component.Container.call(this,a,b,c);this.toggles_=[];this.boxclass_=c;a.eventBus().subscribe("userAction",this.onUserAction_,this)};rhizo.inherits(rhizo.ui.component.HBox,rhizo.ui.component.Container);rhizo.ui.component.HBox.prototype.renderContainer=function(){this.bar_=$("<div />",{"class":this.boxclass_});return this.bar_.get(0)};
rhizo.ui.component.HBox.prototype.renderSingleComponent=function(a,b){var c={component:a,key:a.key(),clickable:this.renderClickable_(a.title(),a.titleClass()),renderings:a.render()};this.toggles_.push(c);if(b)b>0?c.clickable.insertAfter(this.bar_.find(".rhizo-section-header:eq("+(b-1)+")")):this.bar_.prepend(c.clickable);else this.bar_.append(c.clickable);$(c.renderings).addClass("rhizo-floating-panel").css("display","none");this.activateToggle_(c);return $(c.renderings).get()};
rhizo.ui.component.HBox.prototype.renderClickable_=function(a,b){var c="rhizo-section-header";if(b)c+=" "+b;c=$("<div />",{"class":c}).appendTo(this.bar_);$("<a />",{href:"javascript:;",title:a}).text(a).appendTo(c);return c};
rhizo.ui.component.HBox.prototype.activateToggle_=function(a){var b=this.project_.eventBus(),c=this;a.clickable.click(jQuery.proxy(function(){jQuery.each(this.toggles_,jQuery.proxy(function(d,e){if(e==a){$(e.renderings).toggle();$(e.clickable).toggleClass("rhizo-section-open")}else{$(e.renderings).css("display","none");$(e.clickable).removeClass("rhizo-section-open")}this.phase()==rhizo.ui.component.Phase.READY&&b.publish("userAction",{action:"componentActivation",componentKey:e.key,active:$(e.clickable).hasClass("rhizo-section-open")},
null,c)},this))},this))};rhizo.ui.component.HBox.prototype.onUserAction_=function(a){if(a.action=="componentActivation"){var b=a.componentKey;a=!!a.active;for(var c=0;c<this.toggles_.length;c++)if(this.toggles_[c].key==b){this.toggles_[c].clickable.hasClass("rhizo-section-open")!=a&&this.toggles_[c].clickable.click();break}}};
rhizo.ui.component.Viewport=function(a){rhizo.ui.component.Component.call(this,a,"rhizo.ui.component.Viewport");this.universeTargetPosition_={top:0,left:0};this.infinitePanning_=a.options().panningMode()=="infinite";this.canToggleBoxSelection_=a.options().isBoxSelectionMode()&&this.infinitePanning_;this.selectionModeOn_=false;this.selectionArea_=null;a.options().showErrorsInViewport()&&a.eventBus().subscribe("error",this.onError_,this);this.canToggleBoxSelection_&&a.eventBus().subscribe("userAction",
this.onUserAction_,this)};rhizo.inherits(rhizo.ui.component.Viewport,rhizo.ui.component.Component);
rhizo.ui.component.Viewport.prototype.render=function(){var a=["rhizo-viewport","rhizo-panning-"+this.project_.options().panningMode(),"rhizo-selectionmode-"+this.project_.options().selectionMode()];this.viewport_=$("<div/>",{"class":a.join(" ")});a=["rhizo-universe"];!this.infinitePanning_&&this.project_.options().isBoxSelectionMode()&&a.push("rhizo-box-selecting");this.universe_=$("<div/>",{"class":a.join(" ")}).appendTo(this.viewport_);this.selectionArea_=this.infinitePanning_?this.viewport_:this.universe_;
this.gui_.setViewport(this.viewport_);this.gui_.setUniverse(this.universe_);if(this.canToggleBoxSelection_)this.selection_trigger_=$("<div />",{"class":"rhizo-selection-trigger",title:"Start selecting items"}).appendTo(this.viewport_);return this.viewport_.get(0)};
rhizo.ui.component.Viewport.prototype.ready=function(){this.infinitePanning_&&this.activateDraggableViewport_();this.project_.options().isBoxSelectionMode()&&this.activateSelectableViewport_();if(this.project_.options().isClickSelectionMode()||this.project_.options().isBoxSelectionMode())this.viewport_.click(jQuery.proxy(function(a){this.isOnEmptySpace_(a)&&this.project_.eventBus().publish("selection",{action:"deselectAll"})},this))};
rhizo.ui.component.Viewport.prototype.activateSelectableViewport_=function(){this.canToggleBoxSelection_&&this.selection_trigger_.click(jQuery.proxy(function(){this.toggleSelectionMode_(!this.selectionModeOn_);this.project_.eventBus().publish("userAction",{action:"selection",isOn:this.selectionModeOn_},null,this)},this));this.selectionArea_.selectable({disabled:this.infinitePanning_,selected:jQuery.proxy(function(a,b){var c=$(b.selected).data("id");c&&this.project_.eventBus().publish("selection",
{action:"select",models:c})},this),unselected:jQuery.proxy(function(a,b){var c=$(b.unselected).data("id");c&&this.project_.eventBus().publish("selection",{action:"deselect",models:c})},this),filter:this.project_.options().selectFilter(),cancel:this.project_.options().selectFilter(),tolerance:"touch",distance:1})};rhizo.ui.component.Viewport.prototype.isOnEmptySpace_=function(a){return $(a.target).hasClass("rhizo-viewport")||$(a.target).hasClass("rhizo-universe")};
rhizo.ui.component.Viewport.prototype.toggleSelectionMode_=function(a){a=(this.selectionModeOn_=a)?"disable":"enable";this.selectionArea_.selectable(this.selectionModeOn_?"enable":"disable").draggable(a).toggleClass("rhizo-box-selecting",this.selectionModeOn_);this.selection_trigger_.attr("title",this.selectionModeOn_?"Stop selecting items":"Start selecting items")};
rhizo.ui.component.Viewport.prototype.activateDraggableViewport_=function(){this.viewport_.draggable({cancel:".rhizo-model",helper:jQuery.proxy(function(){return $("<div />").appendTo(this.viewport_)},this),start:jQuery.proxy(function(){var a=this.universe_.position();this.universe_.data("top0",a.top).data("left0",a.left)},this),drag:jQuery.proxy(function(a,b){var c=b.position.top+this.universe_.data("top0"),d=b.position.left+this.universe_.data("left0");if(Math.abs(b.position.left)<=15)d=this.universe_.data("left0");
if(Math.abs(d)<=15)d=0;this.moveUniverse_({top:c,left:d})},this),refreshPositions:false});$.support.mouseWheel&&this.viewport_.mousewheel(jQuery.proxy(function(a,b,c){this.panUniverse_(b,c)},this))};rhizo.ui.component.Viewport.prototype.moveUniverse_=function(a){this.universeTargetPosition_={top:a.top,left:a.left};this.universe_.stop().css(this.universeTargetPosition_)};
rhizo.ui.component.Viewport.prototype.panUniverse_=function(a,b){var c=Math.round(this.viewport_.get(0).offsetHeight/10);this.universeTargetPosition_={top:b*c+this.universeTargetPosition_.top,left:a*c+this.universeTargetPosition_.left};this.universe_.stop().animate(this.universeTargetPosition_)};
rhizo.ui.component.Viewport.prototype.onError_=function(a){if(a.clear)$(this.viewport_).find(".rhizo-error").remove();else{var b=$(this.viewport_).find(".rhizo-error");if(b.length==0)b=$("<div />",{"class":"rhizo-error"}).appendTo(this.viewport_);a=a.arguments||[];for(var c=["An error occurred: "],d=0;d<a.length;d++)c.push(String(a[d]));$("<p />").text(c.join(" ")).appendTo(b)}};rhizo.ui.component.Viewport.prototype.onUserAction_=function(a){a.action=="selection"&&this.toggleSelectionMode_(!!a.isOn)};
rhizo.ui.component.Logo=function(a,b,c){rhizo.ui.component.Component.call(this,a,"rhizo.ui.component.Logo");this.titleless_=b;this.sliding_=c};rhizo.inherits(rhizo.ui.component.Logo,rhizo.ui.component.Component);rhizo.ui.component.Logo.prototype.title=function(){return this.titleless_?null:"?"};
rhizo.ui.component.Logo.prototype.render=function(){var a=$("<div />",{"class":"rhizo-logo"}),b=$("<h1>Rhizosphere</h1>").appendTo(a),c=$("<p />").appendTo(a);c.append($("<a />",{href:"http://www.rhizospherejs.com/doc",target:"_blank"}).text("Help"));c.append("&nbsp;").append($("<a />",{href:"http://sites.google.com/site/rhizosphereui/",target:"_blank"}).text("Project Info"));c.append("&nbsp;").append($("<a />",{href:"http://rhizosphere.googlecode.com/hg/AUTHORS.txt",target:"_blank"}).text("Authors"));
c.append("&nbsp;").append($("<a />",{href:"http://rhizosphere.googlecode.com/hg/COPYING.txt",target:"_blank"}).text("License"));this.sliding_&&b.click(function(){c.slideToggle("fast")});return a.get(0)};rhizo.ui.component.Layout=function(a){rhizo.ui.component.Component.call(this,a,"rhizo.ui.component.Layout");a.eventBus().subscribe("layout",this.onLayout_,this)};rhizo.inherits(rhizo.ui.component.Layout,rhizo.ui.component.Component);rhizo.ui.component.Layout.prototype.title=function(){return"Display"};
rhizo.ui.component.Layout.prototype.render=function(){this.layoutPanel_=$("<div />");this.layoutOptions_=$("<div />",{"class":"rhizo-layout-extra-options"}).appendTo(this.layoutPanel_);this.layoutSelector_=$("<select />",{disabled:"disabled"});this.layoutSelector_.append($("<option value=''>No layout engines</option>"));this.layoutPanel_.prepend(this.layoutSelector_).prepend("Keep items ordered by: ");return this.layoutPanel_.get(0)};
rhizo.ui.component.Layout.prototype.metaReady=function(){this.layoutSelector_.children().remove();this.layoutControlsMap_={};for(var a=this.project_.layoutManager().getEngineNames(),b=0;b<a.length;b++){var c=a[b],d=c==this.project_.layoutManager().getCurrentEngineName();this.layoutSelector_.append($("<option value='"+c+"' "+(d?"selected":"")+">"+rhizo.layout.layouts[c].name+"</option>"));var e=rhizo.layout.layouts[c].ui;if(e){e=(new e(this.project_,c)).layoutUIControls();this.layoutControlsMap_[c]=
$(e);d||e.css("display","none");this.layoutOptions_.append(e)}}this.layoutSelector_.removeAttr("disabled").change(jQuery.proxy(this.updateVisibleEngineControls_,this))};rhizo.ui.component.Layout.prototype.ready=function(){this.layoutSelector_.change(jQuery.proxy(function(){this.project_.eventBus().publish("layout",{engine:this.layoutSelector_.val(),options:{forcealign:true}},null,this)},this))};rhizo.ui.component.Layout.prototype.onLayout_=function(a){this.layoutSelector_.val(a.engine);this.updateVisibleEngineControls_()};
rhizo.ui.component.Layout.prototype.updateVisibleEngineControls_=function(){for(var a in this.layoutControlsMap_)a==$(this.layoutSelector_).val()?this.layoutControlsMap_[a].show("fast"):this.layoutControlsMap_[a].hide("fast")};
rhizo.ui.component.SelectionManager=function(a){rhizo.ui.component.Component.call(this,a,"rhizo.ui.component.SelectionManager");a.eventBus().subscribe("selection",this.onSelectionChanged_,this,true);a.eventBus().subscribe("model",this.onModelChanged_,this,true);a.eventBus().subscribe("userAction",this.onUserAction_,this)};rhizo.inherits(rhizo.ui.component.SelectionManager,rhizo.ui.component.Component);rhizo.ui.component.SelectionManager.prototype.title=function(){return"Selection"};
rhizo.ui.component.SelectionManager.prototype.render=function(){var a=$("<div />",{"class":"rhizo-selection"});this.selectButton_=$("<button />",{disabled:"disabled"}).text("Work on selected items only");this.resetButton_=$("<button />",{disabled:"disabled"}).text("Reset");a.append(this.selectButton_).append(this.resetButton_);return a.get(0)};
rhizo.ui.component.SelectionManager.prototype.ready=function(){this.selectButton_.removeAttr("disabled").click(jQuery.proxy(function(){this.project_.eventBus().publish("selection",{action:"focus"})},this));this.resetButton_.click(jQuery.proxy(function(){this.project_.eventBus().publish("selection",{action:"resetFocus"})},this))};rhizo.ui.component.SelectionManager.prototype.onSelectionChanged_=function(a){if(a.action=="focus"||a.action=="resetFocus"||a.action=="hide")this.setNumFilteredModels_(this.project_.selectionManager().getNumHidden())};
rhizo.ui.component.SelectionManager.prototype.onModelChanged_=function(){this.setNumFilteredModels_(this.project_.selectionManager().getNumHidden())};
rhizo.ui.component.SelectionManager.prototype.onUserAction_=function(a){if(a.action=="selection")this.project_.eventBus().publish("userAction",{action:"componentActivation",componentKey:this.key(),active:!!a.isOn},null,this);else a.action=="componentActivation"&&a.componentKey==this.key()&&this.project_.eventBus().publish("userAction",{action:"selection",isOn:!!a.active},null,this)};
rhizo.ui.component.SelectionManager.prototype.setNumFilteredModels_=function(a){a>0?this.resetButton_.removeAttr("disabled").text("Reset ("+a+" filtered)"):this.resetButton_.attr("disabled","disabled").text("Reset")};rhizo.ui.component.AutocommitPanel=function(a){rhizo.ui.component.Component.call(this,a,"rhizo.ui.component.AutocommitPanel");this.callback_=null};rhizo.inherits(rhizo.ui.component.AutocommitPanel,rhizo.ui.component.Component);
rhizo.ui.component.AutocommitPanel.prototype.registerCallback=function(a){this.callback_=a};
rhizo.ui.component.AutocommitPanel.prototype.render=function(){var a=$("<div />",{"class":"rhizo-filter rhizo-autocommit-panel"});this.autocommit_=$("<input />",{type:"checkbox",checked:this.project_.filterManager().isFilterAutocommit(),disabled:"disabled"}).appendTo(a);this.autocommitLabel_=$("<span>Autocommit</span>").appendTo(a);this.hideButton_=$("<button />",{disabled:"disabled"}).text("Apply filters").prependTo(a);return a};
rhizo.ui.component.AutocommitPanel.prototype.ready=function(){this.autocommit_.removeAttr("disabled").click(jQuery.proxy(function(){this.setAutocommit_(this.autocommit_.is(":checked"))},this));this.autocommitLabel_.click(jQuery.proxy(function(){if(this.autocommit_.is(":checked")){this.autocommit_.removeAttr("checked");this.setAutocommit_(false)}else{this.autocommit_.attr("checked","checked");this.setAutocommit_(true)}},this));this.hideButton_.attr("disabled",this.project_.filterManager().isFilterAutocommit()).click(jQuery.proxy(function(){this.project_.filterManager().commitFilter()},
this))};rhizo.ui.component.AutocommitPanel.prototype.setAutocommit_=function(a){a?this.hideButton_.attr("disabled","disabled"):this.hideButton_.removeAttr("disabled");this.project_.eventBus().publish("userAction",{action:"autocommit",enabled:a},null,this);this.project_.filterManager().enableFilterAutocommit(a)};
rhizo.ui.component.FilterStackContainer=function(a){rhizo.ui.component.Container.call(this,a,"rhizo.ui.component.FilterStackContainer");this.filterSelectorThreshold_=a.options().uiStackFiltersThreshold();this.activeFilters_={};this.filterUis_={};a.eventBus().subscribe("filter",this.onFilterChanged_,this,true)};rhizo.inherits(rhizo.ui.component.FilterStackContainer,rhizo.ui.component.Container);rhizo.ui.component.FilterStackContainer.prototype.title=function(){return"Filters"};
rhizo.ui.component.FilterStackContainer.prototype.renderContainer=function(){this.filterPanel_=$("<div />",{"class":"rhizo-filter-container"});this.noFilterNotice_=$("<p />").text("No filters available.");this.filterPanel_.append(this.noFilterNotice_);return this.filterPanel_.get(0)};rhizo.ui.component.FilterStackContainer.prototype.renderSingleComponent=function(a){this.filterPanel_.prepend(a.render());return null};
rhizo.ui.component.FilterStackContainer.prototype.metaReady=function(){rhizo.ui.component.Container.prototype.metaReady.call(this);var a=this.metaModelWithUi_(),b=0;for(var c in a)b++;b>0&&this.noFilterNotice_.remove();b=b>this.filterSelectorThreshold_;for(c in a){var d=this.project_.metaModelRegistry().createUiForKind(a[c].kind,this.project_,c).filterUIControls();if(b){$(d).css("display","none");$("<div />",{"class":"rhizo-icon rhizo-close-icon"}).text("x").prependTo(d).data("rhizo-metamodel-key",
c)}this.filterPanel_.append(d);this.filterUis_[c]=d}b&&this.renderFilterSelector_()};rhizo.ui.component.FilterStackContainer.prototype.renderFilterSelector_=function(){var a=this.metaModelWithUi_();this.filterSelector_=$("<select />",{"class":"rhizo-filter-selector",disabled:"disabled"});$("<option />").attr("value","").text("Add Filter...").appendTo(this.filterSelector_);for(var b in a)this.filterSelector_.append($("<option />").attr("value",b).text(a[b].label));this.filterPanel_.append(this.filterSelector_)};
rhizo.ui.component.FilterStackContainer.prototype.ready=function(){rhizo.ui.component.Container.prototype.ready.call(this);if(this.filterSelector_){this.enableFilterSelector_();this.enableFilterDismissal_()}};
rhizo.ui.component.FilterStackContainer.prototype.enableFilterSelector_=function(){this.filterSelector_.removeAttr("disabled").change(jQuery.proxy(function(){var a=this.filterSelector_.val();if(a in this.project_.metaModel()){this.showFilter_(a);this.filterSelector_.find("option").eq(0).attr("selected","selected")}},this))};
rhizo.ui.component.FilterStackContainer.prototype.enableFilterDismissal_=function(){var a=this;this.filterPanel_.find(".rhizo-close-icon").click(function(){var b=$(this).data("rhizo-metamodel-key");$(a.filterUis_[b]).slideUp("fast");delete a.activeFilters_[b];var c={};c[b]=null;a.project_.eventBus().publish("filter",c,null,a);a.filterSelector_.find("option[value="+rhizo.util.escapeSelectorToken(b)+"]").removeAttr("disabled")})};
rhizo.ui.component.FilterStackContainer.prototype.showFilter_=function(a){$(this.filterUis_[a]).slideDown("fast");this.activeFilters_[a]=true;this.filterSelector_.find("option[value="+rhizo.util.escapeSelectorToken(a)+"]").attr("disabled","disabled")};rhizo.ui.component.FilterStackContainer.prototype.metaModelWithUi_=function(){var a={},b=this.project_.metaModel();for(var c in b)if(this.project_.metaModelRegistry().uiExistsForKind(b[c].kind))a[c]=b[c];return a};
rhizo.ui.component.FilterStackContainer.prototype.onFilterChanged_=function(a){if(this.filterSelector_)for(var b in a)b in this.activeFilters_||this.showFilter_(b)};rhizo.ui.component.FilterBookContainer=function(a){rhizo.ui.component.Container.call(this,a,"rhizo.ui.component.FilterBookContainer");a.eventBus().subscribe("userAction",this.onUserAction_,this)};rhizo.inherits(rhizo.ui.component.FilterBookContainer,rhizo.ui.component.Container);rhizo.ui.component.FilterBookContainer.prototype.title=function(){return"Filters"};
rhizo.ui.component.FilterBookContainer.prototype.renderContainer=function(){this.filterPanel_=$("<div />",{"class":"rhizo-filter-container"});this.nextFilter_=$("<div />",{"class":"rhizo-next-filter",title:"Next filter"}).text(">").appendTo(this.filterPanel_);this.prevFilter_=$("<div />",{"class":"rhizo-prev-filter",title:"Previous filter"}).text("<").appendTo(this.filterPanel_);this.commitFilterLink_=$("<a />",{href:"javascript:;","class":"rhizo-autocommit-link"}).text("Apply").appendTo(this.filterPanel_);
return this.filterPanel_.get(0)};rhizo.ui.component.FilterBookContainer.prototype.renderSingleComponent=function(a){this.filterPanel_.append(a.render());return null};
rhizo.ui.component.FilterBookContainer.prototype.metaReady=function(){rhizo.ui.component.Container.prototype.metaReady.call(this);this.project_.filterManager().isFilterAutocommit()&&this.commitFilterLink_.css("display","none");var a=this.metaModelWithUi_();for(var b in a){var c=this.project_.metaModelRegistry().createUiForKind(a[b].kind,this.project_,b).filterUIControls();c.css("display","none");this.filterPanel_.append(c)}};
rhizo.ui.component.FilterBookContainer.prototype.ready=function(){rhizo.ui.component.Container.prototype.ready.call(this);this.commitFilterLink_.click(jQuery.proxy(function(){this.project_.filterManager().commitFilter()},this));var a=this.gui_;this.nextFilter_.click(function(){var b=$(".rhizo-filter:visible",a.container),c=b.next(".rhizo-filter:hidden").eq(0);if(c.length>0){b.css("display","none");c.css("display","")}});this.prevFilter_.click(function(){var b=$(".rhizo-filter:visible",a.container),
c=b.prev(".rhizo-filter:hidden").eq(0);if(c.length>0){b.css("display","none");c.css("display","")}})};rhizo.ui.component.FilterBookContainer.prototype.metaModelWithUi_=function(){var a={},b=this.project_.metaModel();for(var c in b)if(this.project_.metaModelRegistry().uiExistsForKind(b[c].kind))a[c]=b[c];return a};rhizo.ui.component.FilterBookContainer.prototype.onUserAction_=function(a){if(a.action=="autocommit")this.commitFilterLink_.css("display",a.enabled?"none":"")};
rhizo.ui.component.Legend=function(a){rhizo.ui.component.Component.call(this,a,"rhizo.ui.component.Legend");this.legendPanel_=null};rhizo.inherits(rhizo.ui.component.Legend,rhizo.ui.component.Component);rhizo.ui.component.Legend.prototype.title=function(){return"Legend"};rhizo.ui.component.Legend.prototype.render=function(){this.legendPanel_=$("<div />",{"class":"rhizo-legend-panel"});$("<p />").text("Legend is not available yet.").appendTo(this.legendPanel_);return this.legendPanel_.get(0)};
rhizo.ui.component.Legend.prototype.metaReady=function(){if(this.project_.renderer().getSizeRange||this.project_.renderer().getColorRange){this.legendPanel_.children().remove();var a=null;if(this.project_.renderer().getSizeRange)a=this.project_.renderer().getSizeRange();var b=null;if(this.project_.renderer().getColorRange)b=this.project_.renderer().getColorRange();if(a){var c=$("<div />",{"class":"rhizo-legend-size"}),d=$("<span />",{"class":"rhizo-legend-size-min"}).html(a.label+" &nbsp; "+rhizo.ui.toHumanLabel(a.min)+
":");a=$("<span />",{"class":"rhizo-legend-size-max"}).html(": "+rhizo.ui.toHumanLabel(a.max));c.append(d).append('<span class="ar-fon-0">A</span> -- <span class="ar-fon-5">A</span>').append(a).appendTo(this.legendPanel_)}if(b){c=$("<div />",{"class":"rhizo-legend-color"});d=$("<span />",{"class":"rhizo-legend-color-min"}).html(b.label+" &nbsp; "+rhizo.ui.toHumanLabel(b.min)+":");a=$("<span />",{"class":"rhizo-legend-color-max"}).html(": "+rhizo.ui.toHumanLabel(b.max));c.append(d).append('<span class="ar-col-0 ar-col-legend">&nbsp; &nbsp;</span>&nbsp;<span class="ar-col-1 ar-col-legend">&nbsp; &nbsp;</span>&nbsp;<span class="ar-col-2 ar-col-legend">&nbsp; &nbsp;</span>&nbsp;<span class="ar-col-3 ar-col-legend">&nbsp; &nbsp;</span>&nbsp;<span class="ar-col-4 ar-col-legend">&nbsp; &nbsp;</span>&nbsp;<span class="ar-col-5 ar-col-legend">&nbsp; &nbsp;</span>&nbsp;').append(a).appendTo(this.legendPanel_)}}};
rhizo.ui.component.Actions=function(a){rhizo.ui.component.Component.call(this,a)};rhizo.inherits(rhizo.ui.component.Actions,rhizo.ui.component.Component);rhizo.ui.component.Actions.prototype.title=function(){return"Actions"};rhizo.ui.component.Actions.prototype.render=function(){for(var a=$("<div />",{"class":"rhizo-actions"}),b=0;b<2;b++)$("<div />",{"class":"rhizo-action"}).text("Sample Action "+(b+1)).appendTo(a);return a.get(0)};
rhizo.ui.component.Actions.prototype.ready=function(){if($(".rhizo-action",this.gui_.container).length>0){var a=this.gui_,b=this.project_;$(".rhizo-action",this.gui_.container).draggable({helper:"clone"});this.gui_.universe.droppable({accept:".rhizo-action",drop:function(c,d){var e=a.universe.offset(),f=a.universe.width(),g=a.universe.height(),h=d.draggable.text(),j=d.offset.left-e.left;if(j+200>f)j=f-210;e=d.offset.top-e.top;if(e+200>g)e=g-210;var k=$("<div class='rhizo-droppable-action'>Drop your items here to perform:<br />"+
h+"</div>").css({top:e,left:j});a.universe.append(k);k.fadeIn();k.draggable();k.droppable({accept:".rhizo-model",drop:function(m,n){var p=n.draggable.data("id");if(b.selectionManager().isSelected(p)){var l=0,o=b.selectionManager().allSelected();for(p in o)l++;alert("Action applied on "+l+" elements");for(p in o)o[p].rendering().refreshPosition().moveToMark().unmarkPosition();b.eventBus().publish("selection",{action:"deselectAll"})}else{alert("Action applied on "+b.model(p));b.model(p).rendering().refreshPosition().moveToMark().unmarkPosition()}}});
k.dblclick(function(){k.remove();return false})}})}};rhizo.ui.component.BareTemplate=function(a,b){rhizo.ui.component.Template.call(this,a,b)};rhizo.inherits(rhizo.ui.component.BareTemplate,rhizo.ui.component.Template);rhizo.ui.component.BottomTemplate=function(a,b){rhizo.ui.component.Template.call(this,a,b);this.initComponents_(a)};rhizo.inherits(rhizo.ui.component.BottomTemplate,rhizo.ui.component.Template);
rhizo.ui.component.BottomTemplate.prototype.initComponents_=function(a){this.hbox_=new rhizo.ui.component.HBox(a,"rhizo.ui.component.BottomBar","rhizo-bottom-bar");a=this.defaultComponents(a);for(var b=0;b<a.length;b++)this.hbox_.addComponent(a[b]);rhizo.ui.component.Template.prototype.addComponent.call(this,this.hbox_)};
rhizo.ui.component.BottomTemplate.prototype.defaultComponents=function(a){var b=new rhizo.ui.component.FilterBookContainer(a);b.addComponent(new rhizo.ui.component.AutocommitPanel(a));return[new rhizo.ui.component.Layout(a),new rhizo.ui.component.SelectionManager(a),b,new rhizo.ui.component.Logo(a,false,false)]};rhizo.ui.component.BottomTemplate.prototype.addComponent=function(a){this.addtoBottomBar(a);return null};
rhizo.ui.component.BottomTemplate.prototype.addtoBottomBar=function(a){(a=this.hbox_.addComponent(a,-1))&&this.gui_.container.append(a)};rhizo.ui.component.StandardTemplate=function(a,b){rhizo.ui.component.Template.call(this,a,b);this.initComponents_(a)};rhizo.inherits(rhizo.ui.component.StandardTemplate,rhizo.ui.component.Template);
rhizo.ui.component.StandardTemplate.prototype.initComponents_=function(a){this.leftbox_=new rhizo.ui.component.VBox(a,null,"rhizo-left");this.rightbox_=new rhizo.ui.component.RightBar(a,"rhizo.ui.component.RightBar","rhizo-right");for(var b=this.defaultLeftComponents(a),c=0;c<b.length;c++)this.leftbox_.addComponent(b[c]);a=this.defaultRightComponents(a);for(c=0;c<a.length;c++)this.rightbox_.addComponent(a[c]);rhizo.ui.component.Template.prototype.addComponent.call(this,this.leftbox_);rhizo.ui.component.Template.prototype.addComponent.call(this,
this.rightbox_)};rhizo.ui.component.StandardTemplate.prototype.defaultLeftComponents=function(a){var b=new rhizo.ui.component.FilterStackContainer(a);b.addComponent(new rhizo.ui.component.AutocommitPanel(a));return[new rhizo.ui.component.Logo(a,true,true),new rhizo.ui.component.Layout(a),new rhizo.ui.component.SelectionManager(a),b]};rhizo.ui.component.StandardTemplate.prototype.defaultRightComponents=function(a){return[new rhizo.ui.component.Actions(a)]};
rhizo.ui.component.StandardTemplate.prototype.addComponent=function(a){this.addtoLeftBar(a);return null};rhizo.ui.component.StandardTemplate.prototype.addtoLeftBar=function(a){(a=this.leftbox_.addComponent(a))&&this.gui_.container.append(a)};rhizo.ui.component.StandardTemplate.prototype.addToRightBar=function(a){(a=this.rightbox_.addComponent(a))&&this.gui_.container.append(a)};
rhizo.ui.component.templates={bare:function(a){return new rhizo.ui.component.BareTemplate(a,"bare")},bottom:function(a){return new rhizo.ui.component.BottomTemplate(a,"bottom")},"default":function(a){return new rhizo.ui.component.StandardTemplate(a,"default")}};namespace("rhizo.broadcast");rhizo.broadcast.BaseComponent=function(a){rhizo.ui.component.Component.call(this,a,"rhizo.broadcast.BaseComponent");this.specialized_component_=null};rhizo.inherits(rhizo.broadcast.BaseComponent,rhizo.ui.component.Component);
rhizo.broadcast.BaseComponent.prototype.title=function(){return"Broadcast"};
rhizo.broadcast.BaseComponent.prototype.render=function(){var a=$("<div />",{"class":"rhizo-broadcast"});if(!rhizo.broadcast.globalTransmitter()){this.project_.logger().warn("Channels API not loaded. Broadcasting is disabled");return a.get(0)}var b=rhizo.util.urlParams();this.specialized_component_="follow"in b&&b.pid==this.project_.uuid()?new rhizo.broadcast.FollowComponent(this.project_,b.follow):new rhizo.broadcast.BroadcastComponent(this.project_);a.append(this.specialized_component_.render());
return a.get(0)};rhizo.broadcast.BaseComponent.prototype.metaReady=function(){this.specialized_component_.metaReady()};rhizo.broadcast.BaseComponent.prototype.ready=function(){this.specialized_component_.ready()};rhizo.broadcast.FollowComponent=function(a,b){rhizo.ui.component.Component.call(this,a);this.followed_channel_uuid_=b;this.following_=false};rhizo.inherits(rhizo.broadcast.FollowComponent,rhizo.ui.component.Component);
rhizo.broadcast.FollowComponent.prototype.render=function(){this.follow_=$("<button />",{disabled:"disabled"}).text("Initializing");this.tip_=$("<p />");return[this.follow_.get(0),this.tip_.get(0)]};rhizo.broadcast.FollowComponent.prototype.ready=function(){this.resumeFollowing_();this.follow_.removeAttr("disabled").click(jQuery.proxy(function(){this.following_?this.stopFollowing_():this.resumeFollowing_()},this))};
rhizo.broadcast.FollowComponent.prototype.resumeFollowing_=function(){this.follow_.text("Wait ...");this.tip_.text("Connecting to the remote visualization...");rhizo.broadcast.globalTransmitter().follow(this.followed_channel_uuid_,true,jQuery.proxy(function(a,b,c){if(a){a=rhizo.state.getMasterOverlord().projectOverlord(this.project_);b=new rhizo.broadcast.FollowStateBinder(a,rhizo.broadcast.globalTransmitter());a.addBinding(b);c&&c.state&&rhizo.state.getMasterOverlord().setInitialState(rhizo.broadcast.BINDER_KEY,
c.state,true);this.follow_.text("Stop");this.tip_.text("You are following a remote visualization.");this.following_=true}else{this.follow_.text("Retry");this.tip_.text(b)}},this))};
rhizo.broadcast.FollowComponent.prototype.stopFollowing_=function(){this.follow_.text("Wait ...");this.tip_.text("Disconnecting from remote visualization...");rhizo.broadcast.globalTransmitter().follow(this.followed_channel_uuid_,false,jQuery.proxy(function(a,b){if(a){rhizo.state.getMasterOverlord().projectOverlord(this.project_).removeBinding(rhizo.broadcast.BINDER_KEY).unlisten();this.follow_.text("Resume");this.tip_.text("Resume following the visualization.");this.following_=false}else{this.follow_.text("Retry");
this.tip_.text(b)}},this))};rhizo.broadcast.BroadcastComponent=function(a){rhizo.ui.component.Component.call(this,a);this.broadcasting_=false};rhizo.inherits(rhizo.broadcast.BroadcastComponent,rhizo.ui.component.Component);
rhizo.broadcast.BroadcastComponent.prototype.render=function(){this.share_=$("<button />",{disabled:"disabled"}).text("Broadcast");this.tip_=$("<p />").text("Let others follow this visualization.");this.shareUrl_=$("<input />",{type:"text","class":"rhizo-broadcast-url"});return[this.share_.get(0),this.tip_.get(0),this.shareUrl_.get(0)]};
rhizo.broadcast.BroadcastComponent.prototype.ready=function(){this.share_.removeAttr("disabled").click(jQuery.proxy(function(){this.broadcasting_?this.stopBroadcasting_():this.startBroadcasting_()},this))};
rhizo.broadcast.BroadcastComponent.prototype.startBroadcasting_=function(){this.share_.text("Wait ...");rhizo.broadcast.globalTransmitter().open(jQuery.proxy(function(a,b){if(a){var c=rhizo.state.getMasterOverlord().projectOverlord(this.project_),d=new rhizo.broadcast.BroadcastStateBinder(c,rhizo.broadcast.globalTransmitter());c.addBinding(d);this.tip_.text("Share this URL for others to join.");this.share_.text("Stop");this.shareUrl_.val(rhizo.util.buildUrl(null,{follow:b,pid:this.project_.uuid()})).show("fast").focus().select();
this.broadcasting_=true}else{this.tip_.text(b);this.share_.text("Broadcast")}},this))};rhizo.broadcast.BroadcastComponent.prototype.stopBroadcasting_=function(){rhizo.state.getMasterOverlord().projectOverlord(this.project_).removeBinding(rhizo.broadcast.BINDER_KEY);this.tip_.text("Let others follow this visualization.");this.share_.text("Broadcast");this.shareUrl_.hide().val("");this.broadcasting_=false};rhizo.broadcast.BINDER_KEY="broadcast";
rhizo.broadcast.FollowStateBinder=function(a,b){rhizo.state.StateBinder.call(this,a,rhizo.broadcast.BINDER_KEY);this.transmitter_=b;this.transmitter_.listen("__binder__",jQuery.proxy(function(c){this.stateReceived_(c)},this))};rhizo.inherits(rhizo.broadcast.FollowStateBinder,rhizo.state.StateBinder);rhizo.broadcast.FollowStateBinder.prototype.stateReceived_=function(a){this.overlord_.transition(this.key(),a.delta,a.state,a.replace)};rhizo.broadcast.FollowStateBinder.prototype.unlisten=function(){this.transmitter_.unlisten("__binder__")};
rhizo.broadcast.FollowStateBinder.prototype.onTransition=function(){};rhizo.broadcast.BroadcastStateBinder=function(a,b){rhizo.state.StateBinder.call(this,a,rhizo.broadcast.BINDER_KEY);this.transmitter_=b};rhizo.inherits(rhizo.broadcast.BroadcastStateBinder,rhizo.state.StateBinder);rhizo.broadcast.BroadcastStateBinder.prototype.onTransition=function(a,b,c){this.transmitter_.publish({delta:a,state:b,replace:c||false})};
rhizo.broadcast.Transmitter=function(){this.channel_uuid_=this.socket_=this.channel_=null;this.listen_callbacks_={}};rhizo.broadcast.Transmitter.prototype.listen=function(a,b){this.listen_callbacks_[a]=b};rhizo.broadcast.Transmitter.prototype.unlisten=function(a){delete this.listen_callbacks_[a]};
rhizo.broadcast.Transmitter.prototype.follow=function(a,b,c){this.channel_uuid_?$.ajax({url:"/broadcast/follow",dataType:"json",type:"POST",data:{uuid:this.channel_uuid_,follow:a,enable:b?"1":"0"},error:function(){c(false,"Error changing follow status")},success:function(d){if(d.status!="ok")c(false,"Error changing follow status: "+d.status);else b?c(true,null,JSON.parse(d.initial)):c(true)}}):this.open(jQuery.proxy(function(d,e){d?this.follow(a,b,c):c(d,e)},this))};
rhizo.broadcast.Transmitter.prototype.publish=function(a,b){if(this.channel_uuid_)$.ajax({url:"/broadcast/publish",dataType:"json",type:"POST",data:{uuid:this.channel_uuid_,payload:JSON.stringify(a)},error:function(){b&&b(false,"Error publishing message")},success:function(c){if(c.status!="ok")b&&b(false,"Error publishing message: "+c.status);else b&&b(true)}});else b&&b(false,"Channel is not established yet.")};
rhizo.broadcast.Transmitter.prototype.open=function(a){this.channel_uuid_?a(true,this.channel_uuid_):$.ajax({url:"/broadcast/open",dataType:"json",type:"POST",error:function(){a(false,"Error opening channel.")},success:jQuery.proxy(function(b){b.status!="ok"?a(false,"Error opening channel: "+b.status):this.openChannel_(b.channel_token,b.channel_uuid,a)},this)})};rhizo.broadcast.Transmitter.prototype.messageReceived_=function(a){a=JSON.parse(a.data);for(var b in this.listen_callbacks_)this.listen_callbacks_[b](a)};
rhizo.broadcast.Transmitter.prototype.openChannel_=function(a,b,c){this.channel_=new goog.appengine.Channel(a);this.socket_=this.channel_.open();this.socket_.onopen=jQuery.proxy(function(){this.confirmOpenChannel_(b,c)},this);this.socket_.onmessage=jQuery.proxy(this.messageReceived_,this)};
rhizo.broadcast.Transmitter.prototype.confirmOpenChannel_=function(a,b){$.ajax({url:"/broadcast/connect",dataType:"json",data:{uuid:a},type:"POST",error:function(){b(false,"Error confirming channel opening.")},success:jQuery.proxy(function(c){if(c.status!="ok")b(false,"Error confirming channel opening: "+c.status);else{this.channel_uuid_=a;b(true,a)}},this)})};rhizo.broadcast.transmitter_=null;
if(typeof goog!="undefined"&&typeof goog.appengine!="undefined"&&typeof goog.appengine.Channel!="undefined")rhizo.broadcast.transmitter_=new rhizo.broadcast.Transmitter;rhizo.broadcast.globalTransmitter=function(){return rhizo.broadcast.transmitter_};namespace("rhizo.ui.gui");
rhizo.ui.gui.GUI=function(a,b,c){this.platform_=b;this.device_=c;this.container=$(a);this.is_small_container_=false;this.initContainer_();this.viewport=this.universe=null;this.noFx=false;this.lastViewportSize_=this.resizeTimeout_=this.trackResizeInterval_=null};rhizo.ui.gui.GUI.prototype.done=function(){var a=rhizo.util.urlParams().kb;a&&/true|yes|1/.test(a)&&this.activateOnscreenKeyboard()};
rhizo.ui.gui.GUI.prototype.trackViewportResize=function(a){this.trackResizeInterval_=window.setInterval(jQuery.proxy(function(){this.checkViewportSize_(a)},this),150)};
rhizo.ui.gui.GUI.prototype.checkViewportSize_=function(a){if(this.viewport)if(this.lastViewportSize_){var b={width:this.viewport.width(),height:this.viewport.height()};if(b.width!=this.lastViewportSize_.width||b.height!=this.lastViewportSize_.height){this.lastViewportSize_={width:this.viewport.width(),height:this.viewport.height()};this.resizeTimeout_&&window.clearTimeout(this.resizeTimeout_);this.resizeTimeout_=window.setTimeout(jQuery.proxy(function(){a.forceLayout()},this),200)}}else this.lastViewportSize_=
{width:this.viewport.width(),height:this.viewport.height()}};rhizo.ui.gui.GUI.prototype.destroy=function(){this.trackResizeInterval_&&window.clearInterval(this.trackResizeInterval_);this.resizeTimeout_&&window.clearTimeout(this.resizeTimeout_);for(var a=this.container.get(0).className.split(" "),b=0;b<a.length;b++)a[b].indexOf("rhizo")==0&&this.container.removeClass(a[b]);this.container.children().remove()};
rhizo.ui.gui.GUI.prototype.initContainer_=function(){this.container.addClass("rhizo").addClass("rhizo-device-"+this.device_).addClass("rhizo-platform-"+this.platform_);this.is_small_container_=this.container.width()<600||this.container.height()<250};rhizo.ui.gui.GUI.prototype.setViewport=function(a){this.viewport=a};rhizo.ui.gui.GUI.prototype.setUniverse=function(a){this.universe=a};rhizo.ui.gui.GUI.prototype.isSmall=function(){return this.is_small_container_};
rhizo.ui.gui.GUI.prototype.isMobile=function(){return this.platform_=="mobile"};rhizo.ui.gui.GUI.prototype.allRenderingHints=function(){return{small:this.isSmall(),mobile:this.isMobile()}};rhizo.ui.gui.GUI.prototype.disableFx=function(a){this.noFx=a};rhizo.ui.gui.GUI.prototype.activateOnscreenKeyboard=function(){rhizo.keyboard&&rhizo.keyboard.Keyboard&&new rhizo.keyboard.Keyboard(this.container)};namespace("rhizo.bootstrap");rhizo.bootstrap.uuids_=0;
rhizo.bootstrap.Bootstrap=function(a,b,c){this.container_=a;this.deployed_=false;var d=$(a).attr("id");if(!d||d.length==0)$(a).attr("id","rhizo-uuid-"+rhizo.bootstrap.uuids_++);this.options_=new rhizo.Options(b);this.callback_=c};rhizo.bootstrap.Bootstrap.prototype.isDeployed=function(){return this.deployed_};rhizo.bootstrap.Bootstrap.prototype.prepareAndDeploy=function(a){var b=this.prepare();this.deploy(a);return b};
rhizo.bootstrap.Bootstrap.prototype.prepare=function(){this.gui_=this.initGui_();this.project_=new rhizo.Project(this.gui_,this.options_);this.template_=this.initTemplate_(this.project_,this.gui_,this.options_);return this.project_.userAgent()};rhizo.bootstrap.Bootstrap.prototype.deploy=function(a){(a=a||this.tryInitResourceFromUrl_())?rhizo.model.loader.load(a,jQuery.proxy(this.deployExplicit,this),this.options_,this.project_.logger()):this.deployExplicit()};
rhizo.bootstrap.Bootstrap.prototype.deployWithLoader=function(a){a.load(jQuery.proxy(this.deployExplicit,this),this.options_,this.project_.logger())};
rhizo.bootstrap.Bootstrap.prototype.deployExplicit=function(a,b,c){this.project_.logger().time("Bootstrap::deployExplicit");var d={};if(b&&!this.options_.metamodel())d.metamodel=b;if(c&&!this.options_.renderer())d.renderer=c;this.options_.merge(d);if(this.options_.renderer()&&(this.options_.renderer().getSizeRange||this.options_.renderer().getColorRange))this.template_.addComponent(new rhizo.ui.component.Legend(this.project_,this.options_));b=this.project_.deploy();if(b.success){this.template_.metaReady();
if(a&&a.length>0){this.gui_.disableFx(true);this.project_.userAgent().addModels(a,jQuery.proxy(this.modelsAdded_,this))}else this.modelsAdded_(true)}else{this.project_.logger().error(b.details);this.template_.setProgressHandler(null);this.gui_.done();this.deployed_=true;this.callback_&&this.callback_(this.project_.userAgent(),b.success,b.details);this.project_.logger().timeEnd("Bootstrap::deployExplicit")}};
rhizo.bootstrap.Bootstrap.prototype.modelsAdded_=function(a,b){a||this.project_.logger().error(b);this.project_.alignFx();this.template_.ready();this.gui_.done();this.deployed_=true;this.callback_&&this.callback_(this.project_.userAgent(),a,b);this.project_.logger().timeEnd("Bootstrap::deployExplicit")};
rhizo.bootstrap.Bootstrap.prototype.identifyPlatformAndDevice_=function(){if(this.options_.platform()&&this.options_.device())return{platform:this.options_.platform(),device:this.options_.device()};var a=navigator.userAgent;if(a.toLowerCase().indexOf("ipad")!=-1)return{platform:"mobile",device:"ipad"};else if(a.toLowerCase().indexOf("iphone")!=-1)return{platform:"mobile",device:"iphone"};else if(a.toLowerCase().indexOf("android")!=-1)return{platform:"mobile",device:"android"};return{platform:"default",
device:"default"}};rhizo.bootstrap.Bootstrap.prototype.identifyTemplate_=function(a,b){var c=b.template();if(c&&c in rhizo.ui.component.templates)return rhizo.ui.component.templates[c];if(a.isMobile()||a.isSmall())return rhizo.ui.component.templates.bottom;return rhizo.ui.component.templates["default"]};
rhizo.bootstrap.Bootstrap.prototype.initGui_=function(){var a=this.identifyPlatformAndDevice_();a=new rhizo.ui.gui.GUI(this.container_,a.platform,a.device);a.disableFx(!this.options_.areAnimationsEnabled());rhizo.jquery.init(a,this.options_.areAnimationsEnabled(),true);return a};rhizo.bootstrap.Bootstrap.prototype.initTemplate_=function(a,b,c){a=this.identifyTemplate_(b,c)(a);a.render();return a};
rhizo.bootstrap.Bootstrap.prototype.tryInitResourceFromUrl_=function(){if(!this.options_.allowConfigFromUrl()){this.project_.logger().warn("Sources extraction from url is disabled");return null}var a=rhizo.util.urlParams();a=a.source||a.src;if(!a){this.project_.logger().error("Unable to identify datasource from location");return null}return decodeURIComponent(a)};
