<!doctype html>
<html>
  <head>
    <title>Rhizosphere : History test</title>

    <!-- Rhizosphere libraries and styles -->
    {% include "rhizo_head.html" %}
    {% include "ga.html" %}
  </head>
  <body>
    <h1>History Test</h1>
    <p>
      This page tests interaction between Rhizosphere HTML5 history management
      and other history events (HTML5 or not) that might be generated by the
      surrounding context.
    </p>
    <div id="rhizo-pangea" style="position: relative; width: 600px; height: 600px">
    </div>
    <ul>
      <li><a href="/history_test_intro.html">Navigate away</a></li>
      <li><a href="#hist1">Generate local history event (1)</a></li>
      <li><a href="#hist2">Generate local history event (2)</a></li>
      <li><a href="#" id="hist3">Generate local history event via location.hash</a></li>
      <li><a href="#" id="hist4">Generate a local html5 history event</a></li>
      <li><a href="#" id="hist5">Generate a null html5 history event</a></li>
    </ul>
    <textarea id="output" style="width: 100%; height: 200px"></textarea>

    <script type="text/javascript">
      // Expose the visualization user-agent as a global variable, to let the
      // user programmatically drive the visualization via the browser
      // javascript console.
      var ua;
      $(document).ready(function() {
        $('#hist3').click(function(evt) {
          window.location.hash = '#hist3';
          evt.preventDefault();
          return false;
        });

        $('#hist4').click(function(evt) {
          window.history.pushState({'custom': 'state'}, /* empty title */ '');
          evt.preventDefault();
          return false;
        });

        $('#hist5').click(function(evt) {
          window.history.pushState(null, /* empty title */ '');
          evt.preventDefault();
          return false;
        });

        $(window).bind('popstate', function(evt) {
          $('#output').val(
            $('#output').val() + 'evt:' + JSON.stringify(evt.originalEvent.state) + '\n');
        });

        $('#output').val($('#output').val() + 'onload\n');

        var options = {
          logLevel: {% if logLevel %}'{{ logLevel }}'{% else %}null{% endif %},
          allowConfigFromUrl: false
          {% if template %}
          ,template: '{{template}}'
          {% endif %}
          {% if platform %}
          ,platform: '{{platform}}'
          {% endif %}
          {% if device %}
          ,device: '{{device}}'
          {% endif %}
        };
        var bootstrapper = new rhizo.bootstrap.Bootstrap(
            $('#rhizo-pangea'), options);
        ua = bootstrapper.prepareAndDeploy('/sample/people.js');
      });
    </script>
  </body>
</html>